prod@raspberrypi:~ $ sudo bash /media/prod/USBTOOL/usbb.sh
============================================================
 DEBUG MQTT USB - Sat 21 Jun 11:38:29 CEST 2025
============================================================

1. VÉRIFICATION DES TOPICS MQTT ACTIFS
------------------------------------------------------------
Écoute de TOUS les topics système pendant 5 secondes...
(Pour voir ce qui est réellement publié)

11:38:30 rpi/system/cpu/core1 {"timestamp": "2025-06-21T09:38:30.858763Z", "value": 1.0, "unit": "%"}
11:38:30 rpi/system/cpu/core2 {"timestamp": "2025-06-21T09:38:30.858914Z", "value": 1.0, "unit": "%"}
11:38:30 rpi/system/cpu/core3 {"timestamp": "2025-06-21T09:38:30.858972Z", "value": 4.0, "unit": "%"}
11:38:30 rpi/system/cpu/core4 {"timestamp": "2025-06-21T09:38:30.859016Z", "value": 1.0, "unit": "%"}
11:38:30 rpi/system/frequency/cpu {"timestamp": "2025-06-21T09:38:30.859334Z", "value": 1.5, "unit": "GHz"}
11:38:30 rpi/system/frequency/gpu {"timestamp": "2025-06-21T09:38:30.859491Z", "value": 1500.0, "unit": "MHz"}
11:38:30 rpi/system/memory/ram {"timestamp": "2025-06-21T09:38:30.859667Z", "value": 4.0, "unit": "%"}
11:38:30 rpi/system/memory/swap {"timestamp": "2025-06-21T09:38:30.859877Z", "value": 0.0, "unit": "%"}
11:38:31 rpi/system/cpu/core1 {"timestamp": "2025-06-21T09:38:31.861023Z", "value": 3.0, "unit": "%"}
11:38:31 rpi/system/cpu/core2 {"timestamp": "2025-06-21T09:38:31.861186Z", "value": 0.0, "unit": "%"}
11:38:31 rpi/system/cpu/core3 {"timestamp": "2025-06-21T09:38:31.861262Z", "value": 1.0, "unit": "%"}
11:38:31 rpi/system/cpu/core4 {"timestamp": "2025-06-21T09:38:31.861320Z", "value": 0.0, "unit": "%"}
11:38:31 rpi/system/frequency/cpu {"timestamp": "2025-06-21T09:38:31.862346Z", "value": 1.5, "unit": "GHz"}
11:38:31 rpi/system/frequency/gpu {"timestamp": "2025-06-21T09:38:31.862890Z", "value": 1500.0, "unit": "MHz"}
11:38:31 rpi/system/memory/ram {"timestamp": "2025-06-21T09:38:31.863341Z", "value": 4.1, "unit": "%"}
11:38:31 rpi/system/memory/swap {"timestamp": "2025-06-21T09:38:31.863597Z", "value": 0.0, "unit": "%"}
11:38:32 rpi/system/cpu/core1 {"timestamp": "2025-06-21T09:38:32.864762Z", "value": 3.0, "unit": "%"}
11:38:32 rpi/system/cpu/core2 {"timestamp": "2025-06-21T09:38:32.864916Z", "value": 0.0, "unit": "%"}
11:38:32 rpi/system/cpu/core3 {"timestamp": "2025-06-21T09:38:32.865023Z", "value": 1.0, "unit": "%"}
11:38:32 rpi/system/cpu/core4 {"timestamp": "2025-06-21T09:38:32.865091Z", "value": 0.0, "unit": "%"}
11:38:32 rpi/system/frequency/cpu {"timestamp": "2025-06-21T09:38:32.865618Z", "value": 1.5, "unit": "GHz"}
11:38:32 rpi/system/frequency/gpu {"timestamp": "2025-06-21T09:38:32.865840Z", "value": 1500.0, "unit": "MHz"}
11:38:32 rpi/system/memory/ram {"timestamp": "2025-06-21T09:38:32.866067Z", "value": 4.1, "unit": "%"}
11:38:32 rpi/system/memory/swap {"timestamp": "2025-06-21T09:38:32.866303Z", "value": 0.0, "unit": "%"}
11:38:33 rpi/system/cpu/core1 {"timestamp": "2025-06-21T09:38:33.867503Z", "value": 0.0, "unit": "%"}
11:38:33 rpi/system/cpu/core2 {"timestamp": "2025-06-21T09:38:33.867650Z", "value": 3.0, "unit": "%"}
11:38:33 rpi/system/cpu/core3 {"timestamp": "2025-06-21T09:38:33.867725Z", "value": 0.0, "unit": "%"}
11:38:33 rpi/system/cpu/core4 {"timestamp": "2025-06-21T09:38:33.867792Z", "value": 1.0, "unit": "%"}
11:38:33 rpi/system/frequency/cpu {"timestamp": "2025-06-21T09:38:33.868541Z", "value": 1.5, "unit": "GHz"}
11:38:33 rpi/system/frequency/gpu {"timestamp": "2025-06-21T09:38:33.868774Z", "value": 1500.0, "unit": "MHz"}
11:38:33 rpi/system/memory/ram {"timestamp": "2025-06-21T09:38:33.868990Z", "value": 4.1, "unit": "%"}
11:38:33 rpi/system/memory/swap {"timestamp": "2025-06-21T09:38:33.869237Z", "value": 0.0, "unit": "%"}
11:38:34 rpi/system/cpu/core1 {"timestamp": "2025-06-21T09:38:34.870468Z", "value": 1.0, "unit": "%"}
11:38:34 rpi/system/cpu/core2 {"timestamp": "2025-06-21T09:38:34.870622Z", "value": 1.0, "unit": "%"}
11:38:34 rpi/system/cpu/core3 {"timestamp": "2025-06-21T09:38:34.870684Z", "value": 3.0, "unit": "%"}
11:38:34 rpi/system/cpu/core4 {"timestamp": "2025-06-21T09:38:34.870728Z", "value": 0.0, "unit": "%"}
11:38:34 rpi/system/frequency/cpu {"timestamp": "2025-06-21T09:38:34.871052Z", "value": 1.5, "unit": "GHz"}
11:38:34 rpi/system/frequency/gpu {"timestamp": "2025-06-21T09:38:34.871213Z", "value": 1500.0, "unit": "MHz"}
11:38:34 rpi/system/memory/ram {"timestamp": "2025-06-21T09:38:34.871384Z", "value": 4.1, "unit": "%"}
11:38:34 rpi/system/memory/swap {"timestamp": "2025-06-21T09:38:34.871585Z", "value": 0.0, "unit": "%"}
11:38:34 rpi/system/temperature/cpu {"timestamp": "2025-06-21T09:38:34.871821Z", "value": 34.8, "unit": "u00b0C"}
11:38:34 rpi/system/temperature/gpu {"timestamp": "2025-06-21T09:38:34.871878Z", "value": 34.8, "unit": "u00b0C"}

2. TEST DE PUBLICATION MANUELLE
------------------------------------------------------------
Test de publication sur le topic USB...
✅ Publication réussie

Vérification de la réception...
❌ Pas de message

3. VÉRIFICATION DU COLLECTEUR PYTHON
------------------------------------------------------------
Recherche de logs d'erreur liés à l'USB dans le service...

Jun 21 11:26:23 raspberrypi python3[1417]: 2025-06-21 11:26:23,025 - servermonitoring - INFO - Clé USB MAXLINKSAVE trouvée : /media/prod/MAXLINKSAVE
Jun 21 11:27:53 raspberrypi python3[1417]: 2025-06-21 11:27:53,251 - servermonitoring - INFO - Clé USB MAXLINKSAVE trouvée : /media/prod/MAXLINKSAVE
Jun 21 11:28:53 raspberrypi python3[1417]: 2025-06-21 11:28:53,403 - servermonitoring - INFO - Clé USB MAXLINKSAVE trouvée : /media/prod/MAXLINKSAVE
Jun 21 11:29:53 raspberrypi python3[1417]: 2025-06-21 11:29:53,556 - servermonitoring - INFO - Clé USB MAXLINKSAVE trouvée : /media/prod/MAXLINKSAVE
Jun 21 11:30:53 raspberrypi python3[1417]: 2025-06-21 11:30:53,704 - servermonitoring - INFO - Clé USB MAXLINKSAVE trouvée : /media/prod/MAXLINKSAVE
Jun 21 11:31:53 raspberrypi python3[1417]: 2025-06-21 11:31:53,856 - servermonitoring - INFO - Clé USB MAXLINKSAVE trouvée : /media/prod/MAXLINKSAVE
Jun 21 11:32:54 raspberrypi python3[1417]: 2025-06-21 11:32:54,025 - servermonitoring - INFO - Clé USB MAXLINKSAVE trouvée : /media/prod/MAXLINKSAVE
Jun 21 11:33:54 raspberrypi python3[1417]: 2025-06-21 11:33:54,165 - servermonitoring - INFO - Clé USB MAXLINKSAVE trouvée : /media/prod/MAXLINKSAVE
Jun 21 11:34:54 raspberrypi python3[1417]: 2025-06-21 11:34:54,320 - servermonitoring - INFO - Clé USB MAXLINKSAVE trouvée : /media/prod/MAXLINKSAVE
Jun 21 11:35:54 raspberrypi python3[1417]: 2025-06-21 11:35:54,475 - servermonitoring - INFO - Clé USB MAXLINKSAVE trouvée : /media/prod/MAXLINKSAVE
Jun 21 11:36:54 raspberrypi python3[1417]: 2025-06-21 11:36:54,622 - servermonitoring - INFO - Clé USB MAXLINKSAVE trouvée : /media/prod/MAXLINKSAVE
Jun 21 11:37:54 raspberrypi python3[1417]: 2025-06-21 11:37:54,768 - servermonitoring - INFO - Clé USB MAXLINKSAVE trouvée : /media/prod/MAXLINKSAVE

4. TEST DIRECT DU COLLECTEUR
------------------------------------------------------------
Exécution directe du collecteur pour voir les erreurs...
(Arrêter avec Ctrl+C après quelques secondes)

Service arrêté. Lancement du collecteur en mode debug...
Attendre 35 secondes pour voir la publication USB (intervalle slow=30s)...

2025-06-21 11:38:37,629 - servermonitoring - INFO - Clé USB MAXLINKSAVE trouvée : /media/prod/MAXLINKSAVE
2025-06-21 11:39:07,608 - servermonitoring - INFO - Stats - Runtime: 0h 0m | Messages: 284 | Erreurs: 0 | Échecs connexion: 0

Redémarrage du service...

5. VÉRIFICATION DE L'USAGE DISQUE
------------------------------------------------------------
Usage actuel de la clé USB:
Filesystem      Size  Used Avail Use% Mounted on
/dev/sda1       3.8G   16K  3.8G   1% /media/prod/MAXLINKSAVE

Test avec Python et psutil:
Pourcentage utilisé: 0.0%
Total: 3.74 GB
Libre: 3.74 GB

============================================================
ANALYSE
============================================================

Si le collecteur trouve la clé mais ne publie pas sur MQTT,
c'est probablement que la fonction publish_metric() pour l'USB
n'est pas appelée ou échoue silencieusement.