prod@raspberrypi:~ $ sudo bash /media/prod/USBTOOL/test.sh
========================================================================
🔍 DIAGNOSTIC SYSTÈME TÉLÉCHARGEMENT ARCHIVES - PHP PUR
========================================================================

🔧 VÉRIFICATIONS SYSTÈME DE BASE
   ✅ Privilèges root confirmés
   ✅ Nginx actif
   ❌ PHP non installé
/media/prod/USBTOOL/test.sh: line 82: php: command not found
   ❌ Extension PHP zip manquante

📁 FICHIERS DU SYSTÈME DE TÉLÉCHARGEMENT
   ❌ archives-list.php MANQUANT
   ❌ download-archive.php MANQUANT
   ✅ downloadbutton.js présent
   ✅ downloadbutton.js configuré pour PHP

📂 DOSSIERS DE TRAÇABILITÉ
   ✅ Dossier traçabilité présent (/home/prod/Documents/traçabilité)
   ✅ Propriétaire: root:root
   ✅ Dossier Archives présent
   ✅ Nombre d'années archivées: 0
   ⚠️  www-data n'a pas accès au groupe prod (à configurer)
   ✅ www-data ajouté au groupe prod

🌐 TESTS HTTP
   🔍 Test HTTP archives-list.php...
   ❌ archives-list.php erreur HTTP 404
   🔍 Test HTTP download-archive.php...
   ❌ download-archive.php erreur HTTP 404

🧪 CRÉATION DE DONNÉES DE TEST
   📝 Création d'archives de test...
   ✅ Fichiers de test créés pour S28 2025
   ✅ Fichiers de test créés pour S50-S52 2024

🎯 TESTS AVEC DONNÉES DE TEST
   🔍 Test archives-list.php avec données...
   ❌ archives-list.php erreur avec données

   🔍 Test téléchargement S28 2025...
   ❌ Téléchargement S28 2025 erreur HTTP 404

   🔍 Test téléchargement semaine inexistante...
   ✅ Téléchargement semaine inexistante retourne 404 (correct)

========================================================================
📊 RÉSUMÉ DU DIAGNOSTIC
========================================================================

❌ PROBLÈMES IMPORTANTS DÉTECTÉS

Tests réussis: 12/21
Tests échoués: 8

Le système nécessite des corrections avant d'être utilisable.

===============================================================
🔧 COMMANDES UTILES POUR DEBUG
===============================================================

• Tester archives-list.php:
  curl http://localhost/archives-list.php | jq .

• Tester téléchargement:
  curl -o test.zip 'http://localhost/download-archive.php?year=2025&week=28'

• Vérifier logs Nginx:
  tail -f /var/log/nginx/maxlink-error.log

• Vérifier permissions traçabilité:
  ls -la /home/prod/Documents/traçabilité/

• Nettoyer les données de test:
  rm -rf /home/prod/Documents/traçabilité/Archives/202*

prod@raspberrypi:~ $ 
