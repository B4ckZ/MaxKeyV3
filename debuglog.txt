Console pr√™te - Mode Privil√©gi√©: ACTIF


======================================================================
D√âMARRAGE: Installation compl√®te de MaxLink
Script: /media/prod/USBTOOL/scripts/install/full_install_install.sh
======================================================================

[INFO] Script full_install_install initialis√©
[H[2J[3J
========================================================================
 MAXLINK‚Ñ¢ - INSTALLATION COMPL√àTE V3
 ¬© 2025 WERIT. Tous droits r√©serv√©s.
========================================================================

Installation automatique de tous les composants MaxLink :

  ‚Ä¢ Mise √† jour syst√®me et cache
  ‚Ä¢ Point d'acc√®s WiFi
  ‚Ä¢ Serveur Web et Dashboard
  ‚Ä¢ Correctif NCSI Windows
  ‚Ä¢ Broker MQTT
  ‚Ä¢ Widgets MQTT
  ‚Ä¢ Systeme php
  ‚Ä¢ Orchestrateur et finalisation

L'installation compl√®te prendra environ 10 minutes.

D√©marrage de l'installation...

[INFO] ========== D√âBUT DE L'INSTALLATION COMPL√àTE MAXLINK ==========

========================================================================
√âTAPE 1/8 : Mise √† jour syst√®me et cache
========================================================================

‚ó¶ Ex√©cution de update_install.sh...

[INFO] Ex√©cution de update_install.sh
[INFO] Script update_install initialis√©
[INFO] ========== D√âBUT DE LA MISE √Ä JOUR SYST√àME V11 ==========
========================================================================
√âTAPE 1 : PR√âPARATION DU SYST√àME
========================================================================

‚ó¶ Stabilisation du syst√®me apr√®s d√©marrage...
  ‚Ü¶ Initialisation des services r√©seau...
[INFO] Stabilisation du syst√®me - attente 10s pour OS frais

‚ó¶ D√©sactivation temporaire des mises √† jour automatiques...
[INFO] D√©sactivation des mises √† jour automatiques
  ‚Ü¶ Mises √† jour automatiques suspendues ‚úì
[INFO] Sauvegarde de l'√©tat r√©seau actuel
[INFO] Mode AP non actif

‚ó¶ V√©rification de l'interface WiFi...
  ‚Ü¶ Interface WiFi d√©tect√©e ‚úì
[INFO] Interface WiFi wlan0 d√©tect√©e
[CMD] Ex√©cution: Activation WiFi
[CMD] Commande: nmcli radio wifi on >/dev/null 2>&1
[CMD] Code de sortie: 0
  ‚Ü¶ WiFi activ√© ‚úì

========================================================================
√âTAPE 2 : CONNEXION R√âSEAU
========================================================================

[INFO] V√©rification et √©tablissement de la connexion internet
[INFO] Sauvegarde de l'√©tat r√©seau actuel
[INFO] Mode AP non actif
‚ó¶ Connexion automatique au r√©seau pour t√©l√©chargement...
[INFO] Connexion automatique requise pour t√©l√©charger les paquets
  ‚Ü¶ Connexion au r√©seau "!"...
[INFO] Tentative de connexion √† !
  ‚Ü¶ Connexion √©tablie ‚úì
[SUCCESS] Connexion WiFi √©tablie
  ‚Ü¶ Connectivit√© internet confirm√©e ‚úì
[SUCCESS] Connectivit√© internet confirm√©e
  ‚Ü¶ Stabilisation de la connexion (5s)...
[INFO] Stabilisation de la connexion - attente 5s

========================================================================
√âTAPE 3 : SYNCHRONISATION HORLOGE
========================================================================

‚ó¶ Synchronisation de l'horloge syst√®me...
[INFO] Synchronisation NTP
[CMD] Ex√©cution: Activation NTP
[CMD] Commande: timedatectl set-ntp true
[CMD] Code de sortie: 0
  ‚Ü¶ Attente de la synchronisation NTP...
[INFO] Attente synchronisation NTP - 15s
  ‚Ü¶ Date/Heure: 19/07/2025 14:24:19
[INFO] Heure synchronis√©e: Sat 19 Jul 14:24:19 CEST 2025

========================================================================
√âTAPE 4 : MISE √Ä JOUR DE S√âCURIT√â
========================================================================

‚ó¶ Nettoyage s√©curis√© du syst√®me de paquets...
[INFO] D√©but du nettoyage APT s√©curis√©
‚ó¶ V√©rification de l'√©tat d'APT...
[INFO] V√©rification de l'√©tat d'APT
  ‚Ü¶ APT est occup√©, attente qu'il termine...
[INFO] APT occup√© d√©tect√©, attente
.............................
  ‚Ü¶ Timeout: APT toujours occup√© apr√®s 300s ‚ö†
[WARN] Timeout APT apr√®s 300s
  ‚Ü¶ For√ßage du nettoyage APT...
[WARN] For√ßage du nettoyage APT n√©cessaire
  ‚Ü¶ Nettoyage des processus zombies...
[INFO] Nettoyage des processus zombies
  ‚Ü¶ V√©rification des verrous orphelins...
[INFO] V√©rification des verrous orphelins
    ‚Ä¢ Suppression du verrou orphelin: /var/lib/dpkg/lock
[INFO] Suppression verrou orphelin: /var/lib/dpkg/lock
    ‚Ä¢ Suppression du verrou orphelin: /var/lib/dpkg/lock-frontend
[INFO] Suppression verrou orphelin: /var/lib/dpkg/lock-frontend
    ‚Ä¢ Suppression du verrou orphelin: /var/cache/apt/archives/lock
[INFO] Suppression verrou orphelin: /var/cache/apt/archives/lock
  ‚Ü¶ Reconfiguration de dpkg...
[CMD] Ex√©cution: Configuration dpkg
[CMD] Commande: dpkg --configure -a
[CMD] Code de sortie: 0
  ‚Ü¶ Nettoyage des fichiers partiels corrompus (29 fichiers)...
[INFO] Nettoyage de 29 fichiers partiels
  ‚Ü¶ Syst√®me de paquets nettoy√© ‚úì
[SUCCESS] Nettoyage APT termin√©
  ‚Ü¶ Stabilisation apr√®s nettoyage (3s)...
[INFO] Stabilisation apr√®s nettoyage - attente 3s
‚ó¶ Mise √† jour de la liste des paquets...
[INFO] D√©but de la mise √† jour APT
  ‚Ü¶ Tentative 1/3...
[INFO] Tentative APT update 1/3
    ‚Ä¢ Reconstruction compl√®te du cache APT...
[INFO] Reconstruction compl√®te du cache APT
Get:1 http://deb.debian.org/debian bookworm InRelease [151 kB]
Get:2 http://deb.debian.org/debian-security bookworm-security InRelease [48.0 kB]
Get:3 http://deb.debian.org/debian bookworm-updates InRelease [55.4 kB]
Get:4 http://archive.raspberrypi.com/debian bookworm InRelease [55.0 kB]
Get:5 http://archive.raspberrypi.com/debian bookworm/main arm64 Packages [547 kB]
Get:6 http://deb.debian.org/debian bookworm/main armhf Packages [8,508 kB]
Get:7 http://archive.raspberrypi.com/debian bookworm/main armhf Packages [550 kB]
Get:8 http://deb.debian.org/debian bookworm/main arm64 Packages [8,693 kB]
Get:9 http://deb.debian.org/debian bookworm/main Translation-en [6,109 kB]
Get:10 http://deb.debian.org/debian bookworm/contrib arm64 Packages [45.7 kB]
Get:11 http://deb.debian.org/debian bookworm/contrib armhf Packages [42.9 kB]
Get:11 http://deb.debian.org/debian bookworm/contrib armhf Packages [42.9 kB]
Get:11 http://deb.debian.org/debian bookworm/contrib armhf Packages [42.9 kB]
Get:14 http://deb.debian.org/debian bookworm/contrib Translation-en [48.4 kB]
Get:15 http://deb.debian.org/debian bookworm/non-free armhf Packages [55.9 kB]
Get:16 http://deb.debian.org/debian bookworm/non-free arm64 Packages [75.8 kB]
Get:17 http://deb.debian.org/debian bookworm/non-free Translation-en [68.1 kB]
Get:18 http://deb.debian.org/debian bookworm/non-free-firmware armhf Packages [5,480 B]
Get:19 http://deb.debian.org/debian bookworm/non-free-firmware arm64 Packages [5,832 B]
Get:20 http://deb.debian.org/debian bookworm/non-free-firmware Translation-en [20.9 kB]
Get:21 http://deb.debian.org/debian-security bookworm-security/main arm64 Packages [268 kB]
Get:22 http://deb.debian.org/debian-security bookworm-security/contrib armhf Packages [504 B]
Get:23 http://deb.debian.org/debian-security bookworm-security/contrib arm64 Packages [508 B]
Get:24 http://deb.debian.org/debian-security bookworm-security/contrib Translation-en [652 B]
Get:25 http://deb.debian.org/debian-security bookworm-security/non-free-firmware Translation-en [472 B]
Hit:26 http://deb.debian.org/debian bookworm-updates/main arm64 Packages
Hit:27 http://deb.debian.org/debian bookworm-updates/main armhf Packages
Hit:28 http://deb.debian.org/debian bookworm-updates/main Translation-en
Fetched 25.4 MB in 1min 9s (367 kB/s)
Reading package lists...
E: Failed to stat /var/lib/apt/lists/partial/deb.debian.org_debian_dists_bookworm_InRelease - pkgAcqTransactionItem::TransactionState-stat (2: No such file or directory)
E: Failed to stat /var/lib/apt/lists/partial/deb.debian.org_debian_dists_bookworm-updates_InRelease - pkgAcqTransactionItem::TransactionState-stat (2: No such file or directory)
E: Failed to stat /var/lib/apt/lists/partial/archive.raspberrypi.com_debian_dists_bookworm_InRelease - pkgAcqTransactionItem::TransactionState-stat (2: No such file or directory)
E: Failed to stat /var/lib/apt/lists/partial/archive.raspberrypi.com_debian_dists_bookworm_main_binary-arm64_Packages - pkgAcqTransactionItem::TransactionState-stat (2: No such file or directory)
  ‚Ü¶ Des erreurs ont √©t√© d√©tect√©es dans la mise √† jour ‚ö†
[WARN] Erreurs d√©tect√©es dans APT update
  ‚Ü¶ √âchec, nouvelle tentative dans 10 secondes...
[INFO] √âchec APT update, attente avant retry
  ‚Ü¶ Tentative 2/3...
[INFO] Tentative APT update 2/3
    ‚Ä¢ Reconstruction compl√®te du cache APT...
[INFO] Reconstruction compl√®te du cache APT
Get:1 http://deb.debian.org/debian bookworm InRelease [151 kB]
Get:2 http://archive.raspberrypi.com/debian bookworm InRelease [55.0 kB]
Get:3 http://deb.debian.org/debian-security bookworm-security InRelease [48.0 kB]
Get:4 http://deb.debian.org/debian bookworm-updates InRelease [55.4 kB]
Get:5 http://deb.debian.org/debian bookworm/main armhf Packages [8,508 kB]
Get:6 http://archive.raspberrypi.com/debian bookworm/main armhf Packages [550 kB]
Get:7 http://archive.raspberrypi.com/debian bookworm/main arm64 Packages [547 kB]
Get:8 http://deb.debian.org/debian bookworm/main arm64 Packages [8,693 kB]
Get:9 http://deb.debian.org/debian bookworm/main Translation-en [6,109 kB]
Get:10 http://deb.debian.org/debian bookworm/contrib arm64 Packages [45.7 kB]
Get:11 http://deb.debian.org/debian bookworm/contrib armhf Packages [42.9 kB]
Get:12 http://deb.debian.org/debian bookworm/contrib Translation-en [48.4 kB]
Get:13 http://deb.debian.org/debian bookworm/non-free arm64 Packages [75.8 kB]
Get:14 http://deb.debian.org/debian bookworm/non-free armhf Packages [55.9 kB]
Get:15 http://deb.debian.org/debian bookworm/non-free Translation-en [68.1 kB]
Get:16 http://deb.debian.org/debian bookworm/non-free-firmware arm64 Packages [5,832 B]
Get:17 http://deb.debian.org/debian bookworm/non-free-firmware armhf Packages [5,480 B]
Get:18 http://deb.debian.org/debian bookworm/non-free-firmware Translation-en [20.9 kB]
Get:19 http://deb.debian.org/debian-security bookworm-security/main arm64 Packages [268 kB]
Get:20 http://deb.debian.org/debian-security bookworm-security/main armhf Packages [253 kB]
Get:21 http://deb.debian.org/debian-security bookworm-security/main Translation-en [163 kB]
Get:22 http://deb.debian.org/debian-security bookworm-security/contrib arm64 Packages [508 B]
Get:23 http://deb.debian.org/debian-security bookworm-security/contrib armhf Packages [504 B]
Get:24 http://deb.debian.org/debian-security bookworm-security/contrib Translation-en [652 B]
Get:25 http://deb.debian.org/debian-security bookworm-security/non-free-firmware Translation-en [472 B]
Get:26 http://deb.debian.org/debian bookworm-updates/main arm64 Packages [756 B]
Get:27 http://deb.debian.org/debian bookworm-updates/main armhf Packages [756 B]
Get:28 http://deb.debian.org/debian bookworm-updates/main Translation-en [664 B]
Fetched 25.8 MB in 26s (983 kB/s)
Reading package lists...
  ‚Ü¶ Liste des paquets mise √† jour ‚úì
[SUCCESS] APT update r√©ussi

‚ó¶ Installation des mises √† jour de s√©curit√© critiques...
[INFO] Installation des paquets critiques uniquement
[CMD] Ex√©cution: Mise √† jour s√©curit√©
[CMD] Commande: DEBIAN_FRONTEND=noninteractive apt-get install -y --only-upgrade --allow-unauthenticated openssl libssl* sudo systemd apt dpkg libc6 libpam* ca-certificates tzdata
[OUT] Reading package lists...
[OUT] Building dependency tree...
[OUT] Reading state information...
[OUT] openssl is already the newest version (3.0.16-1~deb12u1+rpt1).
[OUT] libssl3 is already the newest version (3.0.16-1~deb12u1+rpt1).
[OUT] Skipping libssl-dev, it is not installed and only upgrades are requested.
[OUT] Skipping libssl-ocaml, it is not installed and only upgrades are requested.
[OUT] Skipping libssl-ocaml-dev, it is not installed and only upgrades are requested.
[OUT] Skipping libssl-doc, it is not installed and only upgrades are requested.
[OUT] Skipping libssl-utils-clojure, it is not installed and only upgrades are requested.
[OUT] Skipping libssl-ocaml:armhf, it is not installed and only upgrades are requested.
[OUT] Skipping libssl-ocaml-dev:armhf, it is not installed and only upgrades are requested.
[OUT] Skipping libssl1.1, it is not installed and only upgrades are requested.
[OUT] Skipping libssl1.1-dbgsym, it is not installed and only upgrades are requested.
[OUT] Skipping libssl3-dbgsym, it is not installed and only upgrades are requested.
[OUT] apt is already the newest version (2.6.1).
[OUT] dpkg is already the newest version (1.22.6~bpo12+rpt3).
[OUT] libpam0g is already the newest version (1.5.2-6+rpt2+deb12u1).
[OUT] Skipping libpam-apparmor, it is not installed and only upgrades are requested.
[OUT] libpam-runtime is already the newest version (1.5.2-6+rpt2+deb12u1).
[OUT] libpam-modules is already the newest version (1.5.2-6+rpt2+deb12u1).
[OUT] Skipping libpam-barada, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-sss, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-gnome-keyring, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-tmpdir, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-krb5, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-ccreds, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-mount, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-mklocaluser, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-python, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-duo, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-fprintd, it is not installed and only upgrades are requested.
[OUT] Skipping libpam0g-dev, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-elogind, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-ldapd, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-abl, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-fscrypt, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-pkcs11, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-google-authenticator, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-kwallet-common, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-kwallet5, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-mount-bin, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-cap, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-cgroup, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-afs-session, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-heimdal, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-alreadyloggedin, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-chroot, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-encfs, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-freerdp2, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-freerdp2-dev, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-net, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-pwdfile, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-radius-auth, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-script, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-ufpidentity, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-x2go, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-x2go-dev, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-pwquality, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-cgfs, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-malcontent, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-oath, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-ocaml, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-ocaml-dev, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-otpw, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-doc, it is not installed and only upgrades are requested.
[OUT] libpam-modules-bin is already the newest version (1.5.2-6+rpt2+deb12u1).
[OUT] Skipping libpam-geoip, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-krb5-migrate-heimdal, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-krb5-migrate-mit, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-mysql, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-p11, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-python-doc, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-shield, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-ssh-agent-auth, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-u2f, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-wrapper, it is not installed and only upgrades are requested.
[OUT] Skipping libpamtest0, it is not installed and only upgrades are requested.
[OUT] Skipping libpamtest0-dev, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-passwdqc, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-poldi, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-winbind, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-shishi, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-slurm, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-slurm-adopt, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-snapper, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-biometric, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-yubico, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-ocaml:armhf, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-ocaml-dev:armhf, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-zfs, it is not installed and only upgrades are requested.
[OUT] libpam-chksshpwd is already the newest version (1.5.2-6+rpt2+deb12u1).
[OUT] Skipping libpam-chksshpwd-dbgsym, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-cracklib, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-cracklib-dbgsym, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-modules-bin-dbgsym, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-modules-dbgsym, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-zfs-dbgsym, it is not installed and only upgrades are requested.
[OUT] Skipping libpam0g-dbgsym, it is not installed and only upgrades are requested.
[OUT] tzdata is already the newest version (2025b-0+deb12u1).
[OUT] The following additional packages will be installed:
[OUT]   libc-bin libc-dev-bin libc-devtools libc-l10n libc6-dbg libc6-dev
[OUT]   libsystemd-shared libsystemd0 libudev1 locales systemd-sysv
[OUT]   systemd-timesyncd udev
[OUT] Suggested packages:
[OUT]   glibc-doc libnss-nis libnss-nisplus systemd-container systemd-homed
[OUT]   systemd-userdbd systemd-boot systemd-resolved libtss2-esys-3.0.2-0
[OUT]   libtss2-mu0 libtss2-rc0
[OUT] Recommended packages:
[OUT]   libnss-systemd
[OUT] The following packages will be upgraded:
[OUT]   ca-certificates libc-bin libc-dev-bin libc-devtools libc-l10n libc6
[OUT]   libc6-dbg libc6-dev libpam-systemd libsystemd-shared libsystemd0 libudev1
[OUT]   locales sudo systemd systemd-sysv systemd-timesyncd udev
[OUT] 18 upgraded, 0 newly installed, 0 to remove and 168 not upgraded.
[OUT] Need to get 31.4 MB of archives.
[OUT] After this operation, 242 kB of additional disk space will be used.
[OUT] Get:1 http://deb.debian.org/debian-security bookworm-security/main arm64 systemd-timesyncd arm64 252.38-1~deb12u1 [61.8 kB]
[OUT] Get:2 http://deb.debian.org/debian-security bookworm-security/main arm64 libpam-systemd arm64 252.38-1~deb12u1 [209 kB]
[OUT] Get:3 http://deb.debian.org/debian-security bookworm-security/main arm64 systemd arm64 252.38-1~deb12u1 [2,839 kB]
[OUT] Get:4 http://archive.raspberrypi.com/debian bookworm/main arm64 libc6-dbg arm64 2.36-9+rpt2+deb12u12 [8,131 kB]
[OUT] Get:5 http://deb.debian.org/debian-security bookworm-security/main arm64 libsystemd-shared arm64 252.38-1~deb12u1 [1,507 kB]
[OUT] Get:6 http://deb.debian.org/debian-security bookworm-security/main arm64 systemd-sysv arm64 252.38-1~deb12u1 [42.6 kB]
[OUT] Get:7 http://deb.debian.org/debian-security bookworm-security/main arm64 libsystemd0 arm64 252.38-1~deb12u1 [308 kB]
[OUT] Get:8 http://deb.debian.org/debian-security bookworm-security/main arm64 sudo arm64 1.9.13p3-1+deb12u2 [1,827 kB]
[OUT] Get:9 http://deb.debian.org/debian-security bookworm-security/main arm64 udev arm64 252.38-1~deb12u1 [1,641 kB]
[OUT] Get:10 http://deb.debian.org/debian-security bookworm-security/main arm64 libudev1 arm64 252.38-1~deb12u1 [103 kB]
[OUT] Get:11 http://deb.debian.org/debian bookworm-updates/main arm64 ca-certificates all 20230311+deb12u1 [155 kB]
[OUT] Get:12 http://archive.raspberrypi.com/debian bookworm/main arm64 libc-devtools arm64 2.36-9+rpt2+deb12u12 [61.4 kB]
[OUT] Get:13 http://archive.raspberrypi.com/debian bookworm/main arm64 libc6-dev arm64 2.36-9+rpt2+deb12u12 [2,102 kB]
[OUT] Get:14 http://archive.raspberrypi.com/debian bookworm/main arm64 libc-dev-bin arm64 2.36-9+rpt2+deb12u12 [49.9 kB]
[OUT] Get:15 http://archive.raspberrypi.com/debian bookworm/main arm64 libc6 arm64 2.36-9+rpt2+deb12u12 [5,001 kB]
[OUT] Get:16 http://archive.raspberrypi.com/debian bookworm/main arm64 libc-bin arm64 2.36-9+rpt2+deb12u12 [753 kB]
[OUT] Get:17 http://archive.raspberrypi.com/debian bookworm/main arm64 libc-l10n all 2.36-9+rpt2+deb12u12 [1,541 kB]
[OUT] Get:18 http://archive.raspberrypi.com/debian bookworm/main arm64 locales all 2.36-9+rpt2+deb12u12 [5,086 kB]
[OUT] apt-listchanges: Reading changelogs...
[OUT] Preconfiguring packages ...
[OUT] Fetched 31.4 MB in 44s (706 kB/s)
[OUT] (Reading database ... 
(Reading database ... 5%
(Reading database ... 10%
(Reading database ... 15%
(Reading database ... 20%
(Reading database ... 25%
(Reading database ... 30%
(Reading database ... 35%
(Reading database ... 40%
(Reading database ... 45%
(Reading database ... 50%
(Reading database ... 55%
(Reading database ... 60%
(Reading database ... 65%
(Reading database ... 70%
(Reading database ... 75%
(Reading database ... 80%
(Reading database ... 85%
(Reading database ... 90%
(Reading database ... 95%
(Reading database ... 100%
(Reading database ... 129085 files and directories currently installed.)
[OUT] Preparing to unpack .../libc6-dbg_2.36-9+rpt2+deb12u12_arm64.deb ...
[OUT] Unpacking libc6-dbg:arm64 (2.36-9+rpt2+deb12u12) over (2.36-9+rpt2+deb12u10) ...
[OUT] Preparing to unpack .../libc-devtools_2.36-9+rpt2+deb12u12_arm64.deb ...
[OUT] Unpacking libc-devtools (2.36-9+rpt2+deb12u12) over (2.36-9+rpt2+deb12u10) ...
[OUT] Preparing to unpack .../libc6-dev_2.36-9+rpt2+deb12u12_arm64.deb ...
[OUT] Unpacking libc6-dev:arm64 (2.36-9+rpt2+deb12u12) over (2.36-9+rpt2+deb12u10) ...
[OUT] Preparing to unpack .../libc-dev-bin_2.36-9+rpt2+deb12u12_arm64.deb ...
[OUT] Unpacking libc-dev-bin (2.36-9+rpt2+deb12u12) over (2.36-9+rpt2+deb12u10) ...
[OUT] Preparing to unpack .../libc6_2.36-9+rpt2+deb12u12_arm64.deb ...
[OUT] Unpacking libc6:arm64 (2.36-9+rpt2+deb12u12) over (2.36-9+rpt2+deb12u10) ...
[OUT] Setting up libc6:arm64 (2.36-9+rpt2+deb12u12) ...
[OUT] (Reading database ... 
(Reading database ... 5%
(Reading database ... 10%
(Reading database ... 15%
(Reading database ... 20%
(Reading database ... 25%
(Reading database ... 30%
(Reading database ... 35%
(Reading database ... 40%
(Reading database ... 45%
(Reading database ... 50%
(Reading database ... 55%
(Reading database ... 60%
(Reading database ... 65%
(Reading database ... 70%
(Reading database ... 75%
(Reading database ... 80%
(Reading database ... 85%
(Reading database ... 90%
(Reading database ... 95%
(Reading database ... 100%
(Reading database ... 129084 files and directories currently installed.)
[OUT] Preparing to unpack .../libc-bin_2.36-9+rpt2+deb12u12_arm64.deb ...
[OUT] Unpacking libc-bin (2.36-9+rpt2+deb12u12) over (2.36-9+rpt2+deb12u10) ...
[OUT] Setting up libc-bin (2.36-9+rpt2+deb12u12) ...
[OUT] (Reading database ... 
(Reading database ... 5%
(Reading database ... 10%
(Reading database ... 15%
(Reading database ... 20%
(Reading database ... 25%
(Reading database ... 30%
(Reading database ... 35%
(Reading database ... 40%
(Reading database ... 45%
(Reading database ... 50%
(Reading database ... 55%
(Reading database ... 60%
(Reading database ... 65%
(Reading database ... 70%
(Reading database ... 75%
(Reading database ... 80%
(Reading database ... 85%
(Reading database ... 90%
(Reading database ... 95%
(Reading database ... 100%
(Reading database ... 129084 files and directories currently installed.)
[OUT] Preparing to unpack .../systemd-timesyncd_252.38-1~deb12u1_arm64.deb ...
[OUT] Unpacking systemd-timesyncd (252.38-1~deb12u1) over (252.36-1~deb12u1) ...
[OUT] Preparing to unpack .../libpam-systemd_252.38-1~deb12u1_arm64.deb ...
[OUT] Unpacking libpam-systemd:arm64 (252.38-1~deb12u1) over (252.36-1~deb12u1) ...
[OUT] Preparing to unpack .../systemd_252.38-1~deb12u1_arm64.deb ...
[OUT] Unpacking systemd (252.38-1~deb12u1) over (252.36-1~deb12u1) ...
[OUT] Preparing to unpack .../libsystemd-shared_252.38-1~deb12u1_arm64.deb ...
[OUT] Unpacking libsystemd-shared:arm64 (252.38-1~deb12u1) over (252.36-1~deb12u1) ...
[OUT] Preparing to unpack .../libsystemd0_252.38-1~deb12u1_arm64.deb ...
[OUT] Unpacking libsystemd0:arm64 (252.38-1~deb12u1) over (252.36-1~deb12u1) ...
[OUT] Setting up libsystemd0:arm64 (252.38-1~deb12u1) ...
[OUT] Setting up libsystemd-shared:arm64 (252.38-1~deb12u1) ...
[OUT] Setting up systemd (252.38-1~deb12u1) ...
[OUT] (Reading database ... 
(Reading database ... 5%
(Reading database ... 10%
(Reading database ... 15%
(Reading database ... 20%
(Reading database ... 25%
(Reading database ... 30%
(Reading database ... 35%
(Reading database ... 40%
(Reading database ... 45%
(Reading database ... 50%
(Reading database ... 55%
(Reading database ... 60%
(Reading database ... 65%
(Reading database ... 70%
(Reading database ... 75%
(Reading database ... 80%
(Reading database ... 85%
(Reading database ... 90%
(Reading database ... 95%
(Reading database ... 100%
(Reading database ... 129085 files and directories currently installed.)
[OUT] Preparing to unpack .../systemd-sysv_252.38-1~deb12u1_arm64.deb ...
[OUT] Unpacking systemd-sysv (252.38-1~deb12u1) over (252.36-1~deb12u1) ...
[OUT] Preparing to unpack .../sudo_1.9.13p3-1+deb12u2_arm64.deb ...
[OUT] Unpacking sudo (1.9.13p3-1+deb12u2) over (1.9.13p3-1+deb12u1) ...
[OUT] Preparing to unpack .../udev_252.38-1~deb12u1_arm64.deb ...
[OUT] Unpacking udev (252.38-1~deb12u1) over (252.36-1~deb12u1) ...
[OUT] Preparing to unpack .../libudev1_252.38-1~deb12u1_arm64.deb ...
[OUT] Unpacking libudev1:arm64 (252.38-1~deb12u1) over (252.36-1~deb12u1) ...
[OUT] Setting up libudev1:arm64 (252.38-1~deb12u1) ...
[OUT] (Reading database ... 
(Reading database ... 5%
(Reading database ... 10%
(Reading database ... 15%
(Reading database ... 20%
(Reading database ... 25%
(Reading database ... 30%
(Reading database ... 35%
(Reading database ... 40%
(Reading database ... 45%
(Reading database ... 50%
(Reading database ... 55%
(Reading database ... 60%
(Reading database ... 65%
(Reading database ... 70%
(Reading database ... 75%
(Reading database ... 80%
(Reading database ... 85%
(Reading database ... 90%
(Reading database ... 95%
(Reading database ... 100%
(Reading database ... 129085 files and directories currently installed.)
[OUT] Preparing to unpack .../ca-certificates_20230311+deb12u1_all.deb ...
[OUT] Unpacking ca-certificates (20230311+deb12u1) over (20230311) ...
[OUT] Preparing to unpack .../libc-l10n_2.36-9+rpt2+deb12u12_all.deb ...
[OUT] Unpacking libc-l10n (2.36-9+rpt2+deb12u12) over (2.36-9+rpt2+deb12u10) ...
[OUT] Preparing to unpack .../locales_2.36-9+rpt2+deb12u12_all.deb ...
[OUT] Unpacking locales (2.36-9+rpt2+deb12u12) over (2.36-9+rpt2+deb12u10) ...
[OUT] Setting up systemd-sysv (252.38-1~deb12u1) ...
[OUT] Setting up libc-l10n (2.36-9+rpt2+deb12u12) ...
[OUT] Setting up locales (2.36-9+rpt2+deb12u12) ...
[OUT] Generating locales (this might take a while)...
[OUT]   en_GB.UTF-8... done
[OUT] Generation complete.
[OUT] Setting up libc6-dbg:arm64 (2.36-9+rpt2+deb12u12) ...
[OUT] Setting up ca-certificates (20230311+deb12u1) ...
[OUT] Updating certificates in /etc/ssl/certs...
[OUT] rehash: warning: skipping ca-certificates.crt,it does not contain exactly one certificate or CRL
[OUT] 2 added, 0 removed; done.
[OUT] Setting up systemd-timesyncd (252.38-1~deb12u1) ...
[OUT] Setting up udev (252.38-1~deb12u1) ...
[OUT] Setting up sudo (1.9.13p3-1+deb12u2) ...
[OUT] Setting up libpam-systemd:arm64 (252.38-1~deb12u1) ...
[OUT] Setting up libc-dev-bin (2.36-9+rpt2+deb12u12) ...
[OUT] Setting up libc-devtools (2.36-9+rpt2+deb12u12) ...
[OUT] Setting up libc6-dev:arm64 (2.36-9+rpt2+deb12u12) ...
[OUT] Processing triggers for libc-bin (2.36-9+rpt2+deb12u12) ...
[OUT] Processing triggers for man-db (2.11.2-2) ...
[OUT] Processing triggers for dbus (1.14.10-1~deb12u1) ...
[OUT] Processing triggers for initramfs-tools (0.142+rpt3+deb12u3) ...
[OUT] update-initramfs: Generating /boot/initrd.img-6.12.25+rpt-rpi-v8
[OUT] '/boot/initrd.img-6.12.25+rpt-rpi-v8' -> '/boot/firmware/initramfs8'
[OUT] update-initramfs: Generating /boot/initrd.img-6.12.25+rpt-rpi-2712
[OUT] '/boot/initrd.img-6.12.25+rpt-rpi-2712' -> '/boot/firmware/initramfs_2712'
[OUT] Processing triggers for ca-certificates (20230311+deb12u1) ...
[OUT] Updating certificates in /etc/ssl/certs...
[OUT] 0 added, 0 removed; done.
[OUT] Running hooks in /etc/ca-certificates/update.d...
[OUT] done.
[CMD] Code de sortie: 0
  ‚Ü¶ Mises √† jour de s√©curit√© install√©es ‚úì
[SUCCESS] Mises √† jour de s√©curit√© install√©es
  ‚Ü¶ Stabilisation apr√®s mises √† jour (5s)...
[INFO] Stabilisation apr√®s mises √† jour - attente 5s

========================================================================
√âTAPE 5 : CR√âATION DU CACHE DE PAQUETS
========================================================================

‚ó¶ Initialisation du syst√®me de cache...
[INFO] Initialisation du cache de paquets
[INFO] Initialisation du cache des paquets
[SUCCESS] Cache initialis√©: /var/cache/maxlink/packages
  ‚Ü¶ Cache initialis√© ‚úì
[SUCCESS] Cache initialis√© avec succ√®s
  ‚Ü¶ Pr√©paration du t√©l√©chargement (3s)...
[INFO] Pr√©paration du t√©l√©chargement - attente 3s

‚ó¶ T√©l√©chargement de tous les paquets MaxLink...
  ‚Ü¶ Cette op√©ration peut prendre quelques minutes...
[INFO] T√©l√©chargement de tous les paquets requis
[INFO] Mise √† jour des listes de paquets APT
‚ó¶ T√©l√©chargement [1/28]: git
[INFO] T√©l√©chargement du paquet: git (cat√©gorie: base)
  ‚Ü¶ git t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: git
‚ó¶ T√©l√©chargement [2/28]: curl
[INFO] T√©l√©chargement du paquet: curl (cat√©gorie: base)
  ‚Ü¶ curl t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: curl
‚ó¶ T√©l√©chargement [3/28]: wget
[INFO] T√©l√©chargement du paquet: wget (cat√©gorie: base)
  ‚Ü¶ wget t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: wget
‚ó¶ T√©l√©chargement [4/28]: ca-certificates
[INFO] T√©l√©chargement du paquet: ca-certificates (cat√©gorie: base)
  ‚Ü¶ ca-certificates t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: ca-certificates
‚ó¶ T√©l√©chargement [5/28]: apt-transport-https
[INFO] T√©l√©chargement du paquet: apt-transport-https (cat√©gorie: base)
  ‚Ü¶ apt-transport-https t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: apt-transport-https
‚ó¶ T√©l√©chargement [6/28]: gnupg
[INFO] T√©l√©chargement du paquet: gnupg (cat√©gorie: base)
  ‚Ü¶ gnupg t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: gnupg
‚ó¶ T√©l√©chargement [7/28]: lsb-release
[INFO] T√©l√©chargement du paquet: lsb-release (cat√©gorie: base)
  ‚Ü¶ lsb-release t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: lsb-release
‚ó¶ T√©l√©chargement [8/28]: nginx
[INFO] T√©l√©chargement du paquet: nginx (cat√©gorie: nginx)
  ‚Ü¶ nginx t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: nginx
‚ó¶ T√©l√©chargement [9/28]: nginx-common
[INFO] T√©l√©chargement du paquet: nginx-common (cat√©gorie: nginx)
  ‚Ü¶ nginx-common t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: nginx-common
‚ó¶ T√©l√©chargement [10/28]: mosquitto
[INFO] T√©l√©chargement du paquet: mosquitto (cat√©gorie: mqtt)
  ‚Ü¶ mosquitto t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: mosquitto
‚ó¶ T√©l√©chargement [11/28]: mosquitto-clients
[INFO] T√©l√©chargement du paquet: mosquitto-clients (cat√©gorie: mqtt)
  ‚Ü¶ mosquitto-clients t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: mosquitto-clients
‚ó¶ T√©l√©chargement [12/28]: libmosquitto1
[INFO] T√©l√©chargement du paquet: libmosquitto1 (cat√©gorie: mqtt)
  ‚Ü¶ libmosquitto1 t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: libmosquitto1
‚ó¶ T√©l√©chargement [13/28]: libdlt2
[INFO] T√©l√©chargement du paquet: libdlt2 (cat√©gorie: mqtt)
  ‚Ü¶ libdlt2 t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: libdlt2
‚ó¶ T√©l√©chargement [14/28]: dnsmasq
[INFO] T√©l√©chargement du paquet: dnsmasq (cat√©gorie: ap)
  ‚Ü¶ dnsmasq t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: dnsmasq
‚ó¶ T√©l√©chargement [15/28]: iptables
[INFO] T√©l√©chargement du paquet: iptables (cat√©gorie: ap)
  ‚Ü¶ iptables t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: iptables
‚ó¶ T√©l√©chargement [16/28]: python3-psutil
[INFO] T√©l√©chargement du paquet: python3-psutil (cat√©gorie: python)
  ‚Ü¶ python3-psutil t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: python3-psutil
‚ó¶ T√©l√©chargement [17/28]: python3-paho-mqtt
[INFO] T√©l√©chargement du paquet: python3-paho-mqtt (cat√©gorie: python)
  ‚Ü¶ python3-paho-mqtt t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: python3-paho-mqtt
‚ó¶ T√©l√©chargement [18/28]: python3-pip
[INFO] T√©l√©chargement du paquet: python3-pip (cat√©gorie: python)
  ‚Ü¶ python3-pip t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: python3-pip
‚ó¶ T√©l√©chargement [19/28]: python3-setuptools
[INFO] T√©l√©chargement du paquet: python3-setuptools (cat√©gorie: python)
  ‚Ü¶ python3-setuptools t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: python3-setuptools
‚ó¶ T√©l√©chargement [20/28]: i2c-tools
[INFO] T√©l√©chargement du paquet: i2c-tools (cat√©gorie: system)
  ‚Ü¶ i2c-tools t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: i2c-tools
‚ó¶ T√©l√©chargement [21/28]: php
[INFO] T√©l√©chargement du paquet: php (cat√©gorie: php)
  ‚Ü¶ php t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: php
‚ó¶ T√©l√©chargement [22/28]: php-cli
[INFO] T√©l√©chargement du paquet: php-cli (cat√©gorie: php)
  ‚Ü¶ php-cli t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: php-cli
‚ó¶ T√©l√©chargement [23/28]: php-fpm
[INFO] T√©l√©chargement du paquet: php-fpm (cat√©gorie: php)
  ‚Ü¶ php-fpm t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: php-fpm
‚ó¶ T√©l√©chargement [24/28]: htop
[INFO] T√©l√©chargement du paquet: htop (cat√©gorie: tools)
  ‚Ü¶ htop t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: htop
‚ó¶ T√©l√©chargement [25/28]: iotop
[INFO] T√©l√©chargement du paquet: iotop (cat√©gorie: tools)
  ‚Ü¶ iotop t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: iotop
‚ó¶ T√©l√©chargement [26/28]: net-tools
[INFO] T√©l√©chargement du paquet: net-tools (cat√©gorie: tools)
  ‚Ü¶ net-tools t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: net-tools
‚ó¶ T√©l√©chargement [27/28]: dnsutils
[INFO] T√©l√©chargement du paquet: dnsutils (cat√©gorie: tools)
  ‚Ü¶ dnsutils t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: dnsutils
‚ó¶ T√©l√©chargement [28/28]: python3-pil
[INFO] T√©l√©chargement du paquet: python3-pil (cat√©gorie: tools)
  ‚Ü¶ python3-pil t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: python3-pil

‚ó¶ T√©l√©chargement termin√©
  ‚Ü¶ Paquets t√©l√©charg√©s: 694
[INFO] Total paquets t√©l√©charg√©s: 694

  ‚Ü¶ Cache de paquets cr√©√© avec succ√®s ‚úì
[SUCCESS] Tous les paquets ont √©t√© t√©l√©charg√©s
=== Statistiques du cache ===
Emplacement : /var/cache/maxlink/packages
Taille      : 356M
Paquets     : 694
√Çge         : 0 jours
==========================

‚ó¶ T√©l√©chargement du dashboard MaxLink V3...
[INFO] D√©but du t√©l√©chargement du dashboard V3
  ‚Ü¶ Tentative 1/3...
[INFO] Tentative t√©l√©chargement dashboard 1/3
    ‚Ä¢ T√©l√©chargement termin√© (curl)
[INFO] T√©l√©chargement curl termin√©
    ‚Ä¢ Taille du fichier: 114 KB
    ‚Ä¢ V√©rification de l'archive...
  ‚Ü¶ Archive dashboard valide ‚úì
[SUCCESS] Archive dashboard valide
  ‚Ü¶ Dashboard t√©l√©charg√© avec succ√®s ‚úì
[SUCCESS] Dashboard t√©l√©charg√© apr√®s 1 tentative(s)

‚ó¶ Nettoyage du syst√®me...
[CMD] Ex√©cution: APT autoremove
[CMD] Commande: apt-get autoremove -y >/dev/null 2>&1
[CMD] Code de sortie: 0
[CMD] Ex√©cution: APT autoclean
[CMD] Commande: apt-get autoclean >/dev/null 2>&1
[CMD] Code de sortie: 0
  ‚Ü¶ Syst√®me nettoy√© ‚úì

========================================================================
√âTAPE 6 : CONFIGURATION DU SYST√àME
========================================================================

‚ó¶ Configuration du ventilateur...
[INFO] Configuration du ventilateur
  ‚Ü¶ Configuration ajout√©e ‚úì
[SUCCESS] Configuration ventilateur ajout√©e

‚ó¶ Personnalisation de l'interface...
[INFO] Installation du fond d'√©cran personnalis√©
[INFO] Ajout de la version MaxLink v3 sur l'image de fond
Erreur: name 'dest_image' is not defined
[SUCCESS] Version ajout√©e sur l'image
  ‚Ü¶ Fond d'√©cran install√© ‚úì
  ‚Ü¶ Bureau configur√© ‚úì
[SUCCESS] Configuration bureau LXDE appliqu√©e

========================================================================
√âTAPE 7 : FINALISATION
========================================================================

‚ó¶ R√©activation des mises √† jour automatiques...
  ‚Ü¶ Services de mise √† jour r√©activ√©s ‚úì
[INFO] Services de mise √† jour r√©activ√©s

‚ó¶ Restauration de l'√©tat r√©seau...
[INFO] Restauration de l'√©tat r√©seau
[INFO] D√©connexion du WiFi !
  ‚Ü¶ √âtat r√©seau restaur√© ‚úì

‚ó¶ Mise √† jour du statut du service...
Statut update mis √† jour: active
  ‚Ü¶ Statut du service update mis √† jour: active
  ‚Ü¶ Statut du service mis √† jour ‚úì
[INFO] Statut du service update mis √† jour: active

‚ó¶ Mise √† jour termin√©e avec succ√®s !
  ‚Ü¶ Version: v3
  ‚Ü¶ Syst√®me √† jour et configur√©
  ‚Ü¶ Cache de paquets cr√©√© pour installation offline
  ‚Ü¶ Dashboard V3 t√©l√©charg√©
[SUCCESS] Mise √† jour syst√®me termin√©e - Version: v3

‚ó¶ R√©sum√© du cache cr√©√© :
=== Statistiques du cache ===
Emplacement : /var/cache/maxlink/packages
Taille      : 356M
Paquets     : 694
√Çge         : 0 jours
==========================

  ‚Ü¶ Red√©marrage diff√©r√© (installation compl√®te en cours)

[INFO] Red√©marrage diff√©r√© - SKIP_REBOOT=true
[INFO] Script update_install termin√© avec le code 0

[SUCCESS] update_install.sh install√© avec succ√®s

  ‚Ü¶ Pause avant l'√©tape suivante... 10 9 8 7 6 5 4 3 2 1 ‚úì

========================================================================
√âTAPE 2/8 : Point d'acc√®s WiFi
========================================================================

‚ó¶ Ex√©cution de ap_install.sh...

[INFO] Ex√©cution de ap_install.sh
[INFO] Script ap_install initialis√©
[INFO] ========== D√âBUT DE L'INSTALLATION AP ==========
========================================================================
√âTAPE 1 : V√âRIFICATIONS
========================================================================

[INFO] Privil√®ges root confirm√©s
‚ó¶ V√©rification de l'interface WiFi...
  ‚Ü¶ Interface wlan0 disponible ‚úì
[INFO] Interface wlan0 disponible

‚ó¶ V√©rification de NetworkManager...
  ‚Ü¶ NetworkManager actif ‚úì
[INFO] NetworkManager actif

========================================================================
√âTAPE 2 : INSTALLATION DES PAQUETS
========================================================================

‚ó¶ Installation de Point d'acc√®s...
[INFO] Installation hybride de Point d'acc√®s
  ‚Ü¶ D√©j√† install√© ‚úì
[INFO] Point d'acc√®s d√©j√† install√©

[SUCCESS] Tous les paquets AP install√©s

========================================================================
√âTAPE 3 : PR√âPARATION DU SYST√àME
========================================================================

‚ó¶ Configuration du resolv.conf...
[INFO] Configuration du resolv.conf
[CMD] Ex√©cution: Protection du resolv.conf
[CMD] Commande: chattr +i /etc/resolv.conf 2>/dev/null || true
[CMD] Code de sortie: 0
  ‚Ü¶ resolv.conf configur√© et prot√©g√© ‚úì
[INFO] resolv.conf configur√© avec succ√®s

‚ó¶ Nettoyage des services DNS conflictuels...
[INFO] D√©sactivation des services DNS conflictuels

‚ó¶ D√©sactivation des connexions WiFi existantes...
[INFO] Nettoyage des connexions WiFi existantes
[CMD] Ex√©cution: D√©connexion interface
[CMD] Commande: nmcli device disconnect wlan0 2>/dev/null || true
[CMD] Code de sortie: 0
[CMD] Ex√©cution: Suppression ancienne config AP
[CMD] Commande: nmcli connection delete 'MaxLink-NETWORK' 2>/dev/null || true
[CMD] Code de sortie: 0
  ‚Ü¶ Connexions nettoy√©es ‚úì

‚ó¶ Configuration de NetworkManager...
[INFO] Configuration de NetworkManager pour dnsmasq
[CMD] Ex√©cution: Sauvegarde config NetworkManager
[CMD] Commande: cp /etc/NetworkManager/NetworkManager.conf /etc/NetworkManager/NetworkManager.conf.original
[CMD] Code de sortie: 0
  ‚Ü¶ NetworkManager configur√© pour dnsmasq ‚úì
[INFO] NetworkManager configur√© avec succ√®s

========================================================================
√âTAPE 4 : CONFIGURATION DU POINT D'ACC√àS
========================================================================

‚ó¶ Cr√©ation du profil Access Point...
  ‚Ü¶ SSID: MaxLink-NETWORK
  ‚Ü¶ IP: 192.168.4.1/24
  ‚Ü¶ Canal: 6 (2.4GHz)
[INFO] Configuration AP - SSID: MaxLink-NETWORK, IP: 192.168.4.1/24, Canal: 6
[CMD] Ex√©cution: Cr√©ation profil AP
[CMD] Commande: nmcli connection add     type wifi     ifname wlan0     con-name 'MaxLink-NETWORK'     autoconnect yes     ssid 'MaxLink-NETWORK'     mode ap     802-11-wireless.band bg     802-11-wireless.channel 6     802-11-wireless-security.key-mgmt wpa-psk 	802-11-wireless-security.proto rsn 	802-11-wireless-security.pairwise ccmp 	802-11-wireless-security.group ccmp     802-11-wireless-security.psk 'MDPsupersecret007'     ipv4.method shared     ipv4.addresses '192.168.4.1/24'     ipv6.method disabled
[OUT] Connection 'MaxLink-NETWORK' (ecade7a2-256c-4f2d-9af7-95595df6f33c) successfully added.
[CMD] Code de sortie: 0
  ‚Ü¶ Profil AP cr√©√© ‚úì
[SUCCESS] Profil AP cr√©√© avec succ√®s

‚ó¶ Configuration DHCP et DNS...
[INFO] Configuration DHCP/DNS pour l'AP
  ‚Ü¶ Configuration DHCP/DNS cr√©√©e ‚úì
[INFO] Configuration dnsmasq cr√©√©e dans /etc/NetworkManager/dnsmasq-shared.d/
  ‚Ü¶ Configuration DNS suppl√©mentaire ajout√©e ‚úì
[INFO] Configuration DNS suppl√©mentaire cr√©√©e

========================================================================
√âTAPE 5 : CONFIGURATION DU PARE-FEU
========================================================================

‚ó¶ Configuration des r√®gles de pare-feu...
[INFO] Configuration des r√®gles iptables

========================================================================
√âTAPE 6 : ACTIVATION DU POINT D'ACC√àS
========================================================================

‚ó¶ D√©marrage du point d'acc√®s...
[INFO] Activation du point d'acc√®s
[CMD] Ex√©cution: Red√©marrage NetworkManager
[CMD] Commande: systemctl restart NetworkManager
[CMD] Code de sortie: 0
[CMD] Ex√©cution: Activation connexion AP
[CMD] Commande: nmcli connection up 'MaxLink-NETWORK'
[OUT] Connection successfully activated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/3)
[CMD] Code de sortie: 0
  ‚Ü¶ Point d'acc√®s activ√© ‚úì
[SUCCESS] Point d'acc√®s activ√© avec succ√®s

‚ó¶ V√©rification de l'√©tat...
[INFO] V√©rification de l'√©tat du point d'acc√®s
  ‚Ü¶ Point d'acc√®s op√©rationnel ‚úì
[SUCCESS] Point d'acc√®s op√©rationnel
  ‚Ü¶ Service DNS actif ‚úì
[INFO] Service dnsmasq actif

========================================================================
√âTAPE 7 : FINALISATION
========================================================================

‚ó¶ Configuration de d√©marrage automatique...
  ‚Ü¶ Le point d'acc√®s d√©marrera automatiquement ‚úì
[INFO] Configuration de d√©marrage automatique activ√©e

‚ó¶ Mise √† jour du statut du service...
Statut ap mis √† jour: active
  ‚Ü¶ Statut du service ap mis √† jour: active
  ‚Ü¶ Statut du service mis √† jour ‚úì
[INFO] Statut du service ap mis √† jour: active

‚ó¶ Informations de connexion :
  ‚Ü¶ Nom du r√©seau : MaxLink-NETWORK
  ‚Ü¶ Mot de passe  : MDPsupersecret007
  ‚Ü¶ Adresse IP    : 192.168.4.1
  ‚Ü¶ Plage DHCP    : 192.168.4.10 - 192.168.4.100

‚ó¶ Acc√®s au dashboard :
  ‚Ü¶ http://192.168.4.1
  ‚Ü¶ http://maxlink-dashboard.local
  ‚Ü¶ http://dashboard.local
[INFO] Configuration finale:
[INFO]   - SSID: MaxLink-NETWORK
[INFO]   - IP: 192.168.4.1
[INFO]   - DHCP: 192.168.4.10 - 192.168.4.100

‚ó¶ Installation termin√©e avec succ√®s !

‚ó¶ IMPORTANT : L'orchestrateur doit √™tre install√© pour g√©rer le d√©marrage ordonn√©

‚ó¶ Test rapide de la r√©solution DNS...
  ‚Ü¶ DNS non fonctionnel - Un red√©marrage peut √™tre n√©cessaire ‚ö†
[WARN] Test DNS final √©chou√© - red√©marrage recommand√©

  ‚Ü¶ Red√©marrage diff√©r√© (installation compl√®te en cours)

[INFO] Red√©marrage diff√©r√© - SKIP_REBOOT=true
[INFO] Script ap_install termin√© avec le code 0

[SUCCESS] ap_install.sh install√© avec succ√®s

  ‚Ü¶ Pause avant l'√©tape suivante... 10 9 8 7 6 5 4 3 2 1 ‚úì

========================================================================
√âTAPE 3/8 : Serveur Web et Dashboard
========================================================================

‚ó¶ Ex√©cution de nginx_install.sh...

[INFO] Ex√©cution de nginx_install.sh
[INFO] Script nginx_install initialis√©
[INFO] ========== D√âBUT DE L'INSTALLATION NGINX ET DASHBOARD (OFFLINE) ==========
========================================================================
√âTAPE 1 : V√âRIFICATIONS
========================================================================

[INFO] Privil√®ges root confirm√©s
  ‚Ü¶ Privil√®ges root confirm√©s ‚úì

‚ó¶ V√©rification du cache local...
[INFO] V√©rification du cache dashboard
  ‚Ü¶ Dashboard trouv√© dans le cache ‚úì
[INFO] Dashboard valide trouv√© dans le cache

========================================================================
√âTAPE 2 : INSTALLATION DE NGINX
========================================================================

‚ó¶ Installation de Nginx depuis le cache...
[INFO] Installation de Nginx depuis le cache local
[INFO] Installation des paquets de la cat√©gorie: nginx
  ‚Ü¶ Installation de nginx...
[INFO] Installation du paquet depuis le cache: nginx
[INFO] Fichiers .deb trouv√©s pour nginx: 2 fichier(s)
[INFO] Fichiers: /var/cache/maxlink/packages/nginx-common_1.22.1-9+deb12u2_all.deb
/var/cache/maxlink/packages/nginx_1.22.1-9+deb12u2_arm64.deb
[SUCCESS] Paquet install√© depuis le cache: nginx
    ‚úì nginx install√©
  ‚Ü¶ Installation de nginx-common...
[INFO] Installation du paquet depuis le cache: nginx-common
[INFO] Fichiers .deb trouv√©s pour nginx-common: 1 fichier(s)
[INFO] Fichiers: /var/cache/maxlink/packages/nginx-common_1.22.1-9+deb12u2_all.deb
[SUCCESS] Paquet install√© depuis le cache: nginx-common
    ‚úì nginx-common install√©
  ‚Ü¶ Nginx install√© depuis le cache ‚úì
[SUCCESS] Nginx install√© avec succ√®s depuis le cache

‚ó¶ Pr√©paration de Nginx...
[CMD] Ex√©cution: Arr√™t Nginx
[CMD] Commande: systemctl stop nginx >/dev/null 2>&1
[CMD] Code de sortie: 0
  ‚Ü¶ Service Nginx arr√™t√© ‚úì

========================================================================
√âTAPE 3 : INSTALLATION DU DASHBOARD
========================================================================


‚ó¶ Extraction du dashboard depuis le cache...
[INFO] R√©pertoire temporaire: /tmp/maxlink-dashboard-1752928836
  ‚Ü¶ Extraction de l'archive...
[CMD] Ex√©cution: Extraction archive
[CMD] Commande: tar -xzf '/var/cache/maxlink/dashboard/dashboard.tar.gz' -C '/tmp/maxlink-dashboard-1752928836'
[CMD] Code de sortie: 0
  ‚Ü¶ Archive extraite ‚úì
[SUCCESS] Archive extraite avec succ√®s
[INFO] Dossier racine de l'archive: /tmp/maxlink-dashboard-1752928836/DashboardV3-main
[INFO] Recherche du dashboard dans: /tmp/maxlink-dashboard-1752928836/DashboardV3-main
  ‚Ü¶ Dossier dashboard trouv√© ‚úì
[INFO] Dossier dashboard trouv√©: /tmp/maxlink-dashboard-1752928836/DashboardV3-main
  ‚Ü¶ Cr√©ation du r√©pertoire destination...
[INFO] R√©pertoire destination cr√©√©: /var/www/maxlink-dashboard
[CMD] Ex√©cution: Copie dashboard
[CMD] Commande: cp -r '/tmp/maxlink-dashboard-1752928836/DashboardV3-main'/* '/var/www/maxlink-dashboard'/
[CMD] Code de sortie: 0
  ‚Ü¶ Dashboard install√© ‚úì
[SUCCESS] Dashboard install√© avec succ√®s
[INFO] Nettoyage du r√©pertoire temporaire

‚ó¶ Configuration des permissions...
[CMD] Ex√©cution: Application propri√©taire
[CMD] Commande: chown -R www-data:www-data '/var/www/maxlink-dashboard'
[CMD] Code de sortie: 0
[CMD] Ex√©cution: Permissions standard
[CMD] Commande: chmod -R 755 '/var/www/maxlink-dashboard'
[CMD] Code de sortie: 0
  ‚Ü¶ Permissions configur√©es ‚úì
[INFO] Permissions appliqu√©es au dashboard

========================================================================
√âTAPE 4 : CONFIGURATION DE NGINX
========================================================================

‚ó¶ Cr√©ation de la configuration du site...
[INFO] Cr√©ation de la configuration Nginx
  ‚Ü¶ Configuration cr√©√©e ‚úì
[SUCCESS] Configuration Nginx cr√©√©e

‚ó¶ Activation du site...
[CMD] Ex√©cution: Suppression site par d√©faut
[CMD] Commande: rm -f /etc/nginx/sites-enabled/default 2>/dev/null || true
[CMD] Code de sortie: 0
[CMD] Ex√©cution: Suppression ancien lien
[CMD] Commande: rm -f /etc/nginx/sites-enabled/maxlink-dashboard 2>/dev/null || true
[CMD] Code de sortie: 0
[CMD] Ex√©cution: Cr√©ation lien symbolique
[CMD] Commande: ln -s /etc/nginx/sites-available/maxlink-dashboard /etc/nginx/sites-enabled/
[CMD] Code de sortie: 0
  ‚Ü¶ Site activ√© ‚úì
[INFO] Site Nginx activ√©
[CMD] Ex√©cution: Test configuration Nginx
[CMD] Commande: nginx -t >/dev/null 2>&1
[CMD] Code de sortie: 0
  ‚Ü¶ Configuration valid√©e ‚úì
[SUCCESS] Configuration Nginx valide

‚ó¶ D√©marrage de Nginx...
[CMD] Ex√©cution: Activation au d√©marrage
[CMD] Commande: systemctl enable nginx >/dev/null 2>&1
[CMD] Code de sortie: 0
[CMD] Ex√©cution: D√©marrage Nginx
[CMD] Commande: systemctl start nginx >/dev/null 2>&1
[CMD] Code de sortie: 0
  ‚Ü¶ Nginx d√©marr√© et activ√© ‚úì
[SUCCESS] Nginx d√©marr√© avec succ√®s

========================================================================
√âTAPE 5 : CONFIGURATION DNS
========================================================================

[INFO] V√©rification de la configuration AP existante
‚ó¶ Mode AP d√©tect√©, mise √† jour de la configuration DNS...
[INFO] Mode AP d√©tect√©, mise √† jour DNS n√©cessaire
  ‚Ü¶ Configuration DNS d√©j√† pr√©sente ‚úì
[INFO] Configuration DNS d√©j√† pr√©sente

‚ó¶ Mise √† jour du statut du service...
Statut nginx mis √† jour: active
  ‚Ü¶ Statut du service nginx mis √† jour: active
  ‚Ü¶ Statut du service mis √† jour ‚úì
[INFO] Statut du service nginx mis √† jour: active

‚ó¶ Installation termin√©e avec succ√®s !
  ‚Ü¶ Dashboard install√© dans : /var/www/maxlink-dashboard
  ‚Ü¶ Accessible via :
    ‚Ä¢ http://192.168.4.1
    ‚Ä¢ http://maxlink-dashboard.local
    ‚Ä¢ http://maxlink-dashboard.local
    ‚Ä¢ http://dashboard.local
[INFO] Installation termin√©e avec succ√®s
[INFO] Dashboard accessible √†: http://192.168.4.1 et http://maxlink-dashboard.local

  ‚Ü¶ Red√©marrage diff√©r√© (installation compl√®te en cours)

[INFO] Red√©marrage diff√©r√© - SKIP_REBOOT=true
[INFO] Script nginx_install termin√© avec le code 0

[SUCCESS] nginx_install.sh install√© avec succ√®s

  ‚Ü¶ Pause avant l'√©tape suivante... 10 9 8 7 6 5 4 3 2 1 ‚úì

========================================================================
√âTAPE 4/8 : Correctif NCSI Windows
========================================================================

‚ó¶ Ex√©cution de fake_ncsi_install.sh...

[INFO] Ex√©cution de fake_ncsi_install.sh
[INFO] Script fake_ncsi_install initialis√©
[INFO] ========== D√âBUT DE L'INSTALLATION FAKE NCSI ==========
========================================================================
INSTALLATION FAKE NCSI - CORRECTIF WINDOWS
========================================================================

[INFO] Privil√®ges root confirm√©s
Cette correction utilise UNIQUEMENT nginx, AUCUNE modification DNS

========================================================================
√âTAPE 1 : V√âRIFICATION DE L'√âTAT MAXLINK
========================================================================

[INFO] V√©rification de l'√©tat MaxLink
  ‚Ü¶ MaxLink-NETWORK actif ‚úì
[INFO] MaxLink-NETWORK actif
  ‚Ü¶ dnsmasq NetworkManager actif ‚úì
[INFO] dnsmasq NetworkManager actif
  ‚Ü¶ nginx actif ‚úì
[INFO] nginx actif
  ‚Ü¶ IP AP 192.168.4.1 configur√©e ‚úì
  ‚Ü¶ √âtat MaxLink valid√© ‚úì
[SUCCESS] √âtat MaxLink valid√© avec succ√®s

========================================================================
√âTAPE 2 : CONFIGURATION NGINX POUR WINDOWS NCSI
========================================================================

[INFO] Configuration nginx pour Windows NCSI
  ‚Ü¶ Sauvegarde nginx cr√©√©e: maxlink-dashboard.backup.20250719_144058 ‚úì
[INFO] Sauvegarde nginx cr√©√©e: /etc/nginx/sites-available/maxlink-dashboard.backup.20250719_144058
  ‚Ü¶ Ajout des endpoints Windows NCSI...
[INFO] Ajout des endpoints Windows NCSI
  ‚Ü¶ Endpoints Windows NCSI ajout√©s ‚úì
[SUCCESS] Endpoints Windows NCSI ajout√©s avec succ√®s

========================================================================
√âTAPE 3 : CONFIGURATION DHCP POUR GUIDER WINDOWS
========================================================================

[INFO] Configuration DHCP pour guider Windows
  ‚Ü¶ Cr√©ation du fichier d'aide Windows...
[INFO] Cr√©ation du fichier d'aide Windows
  ‚Ü¶ Fichier d'aide Windows cr√©√© ‚úì
[SUCCESS] Fichier d'aide Windows cr√©√©

========================================================================
√âTAPE 4 : TESTS ET APPLICATION
========================================================================

[INFO] Tests et application des configurations
  ‚Ü¶ Test de la configuration nginx...
  ‚Ü¶ Configuration nginx valide ‚úì
[SUCCESS] Configuration nginx valide
  ‚Ü¶ Rechargement nginx...
  ‚Ü¶ Nginx recharg√© ‚úì
[SUCCESS] Nginx recharg√© avec succ√®s
  ‚Ü¶ Rechargement de la configuration dnsmasq...
  ‚Ü¶ Configuration dnsmasq recharg√©e ‚úì
[SUCCESS] Configuration dnsmasq recharg√©e

========================================================================
√âTAPE 5 : TESTS DE VALIDATION
========================================================================

[INFO] Tests de validation
  ‚Ü¶ V√©rification AP apr√®s modifications...
  ‚Ü¶ MaxLink-NETWORK toujours actif ‚úì
[SUCCESS] MaxLink-NETWORK toujours actif
  ‚Ü¶ Test des endpoints Windows...
[INFO] Test des endpoints Windows
  ‚Ü¶ Endpoint connecttest.txt fonctionnel ‚úì
[SUCCESS] Endpoint connecttest.txt fonctionnel
  ‚Ü¶ Endpoint generate_204 fonctionnel ‚úì
[SUCCESS] Endpoint generate_204 fonctionnel
  ‚Ü¶ Service dnsmasq toujours actif ‚úì
[SUCCESS] Service dnsmasq toujours actif

========================================================================
√âTAPE 6 : SURVEILLANCE DE LA STABILIT√â
========================================================================

[INFO] Surveillance de la stabilit√© (30 secondes)
Surveillance de la stabilit√© MaxLink...
  14:41:06: Stable ‚úì
  14:41:08: Stable ‚úì
  14:41:10: Stable ‚úì
  14:41:12: Stable ‚úì
  14:41:14: Stable ‚úì
  14:41:16: Stable ‚úì
  14:41:18: Stable ‚úì
  14:41:20: Stable ‚úì
  14:41:22: Stable ‚úì
  14:41:24: Stable ‚úì
  14:41:26: Stable ‚úì
  14:41:28: Stable ‚úì
  14:41:30: Stable ‚úì
  14:41:32: Stable ‚úì
  14:41:34: Stable ‚úì
[SUCCESS] Surveillance compl√®te - syst√®me stable

========================================================================
CORRECTION WINDOWS NCSI APPLIQU√âE AVEC SUCC√àS
========================================================================

‚úì Endpoints nginx Windows NCSI configur√©s
‚úì Message personnalis√© appliqu√©
‚úì Options DHCP d'aide ajout√©es
‚úì Configuration MaxLink pr√©serv√©e
‚úì Aucune modification DNS (pas de boucle)

PRINCIPE DE FONCTIONNEMENT:
  ‚Üí Windows teste la connectivit√©
  ‚Üí DHCP lui sugg√®re d'utiliser 192.168.4.1
  ‚Üí nginx r√©pond avec votre message personnalis√©
  ‚Üí Windows consid√®re le r√©seau comme 'Connect√©'
  ‚Üí Raspberry Pi reste stable (pas de redirection DNS)

TESTS MANUELS:
  ‚Üí curl http://192.168.4.1/connecttest.txt
  ‚Üí curl http://192.168.4.1/generate_204
  ‚Üí Connecter un PC Windows et observer le statut

SURVEILLANCE:
  ‚Üí Surveillez pendant 5-10 minutes
  ‚Üí Red√©marrage test: sudo reboot

Sauvegarde disponible: /etc/nginx/sites-available/maxlink-dashboard.backup.20250719_144058

[SUCCESS] Installation Fake NCSI termin√©e avec succ√®s
[INFO] ========== FIN DE L'INSTALLATION FAKE NCSI ==========
[INFO] Red√©marrage ignor√© (SKIP_REBOOT=true)
[INFO] Script fake_ncsi_install termin√© avec le code 0

[SUCCESS] fake_ncsi_install.sh install√© avec succ√®s

  ‚Ü¶ Pause avant l'√©tape suivante... 10 9 8 7 6 5 4 3 2 1 ‚úì

========================================================================
√âTAPE 5/8 : Broker MQTT
========================================================================

‚ó¶ Ex√©cution de mqtt_install.sh...

[INFO] Ex√©cution de mqtt_install.sh
[INFO] Script mqtt_install initialis√©
[INFO] ========== D√âBUT DE L'INSTALLATION MQTT BROKER ==========

========================================================================
INSTALLATION DU BROKER MQTT (MOSQUITTO)
========================================================================

Configuration : utilisateur 'mosquitto' / mot de passe 'mqtt'

[INFO] Privil√®ges root confirm√©s
√âTAPE 1 : PR√âPARATION DU SYST√àME
========================================================================

‚ó¶ Nettoyage du syst√®me de paquets...
  ‚Ü¶ Syst√®me de paquets pr√™t ‚úì
[INFO] Syst√®me de paquets nettoy√©

========================================================================
√âTAPE 2 : INSTALLATION DES PAQUETS
========================================================================

‚ó¶ Installation de Mosquitto et d√©pendances...
[INFO] Installation hybride de Mosquitto et d√©pendances
  ‚Ü¶ Recherche dans le cache local...
[INFO] Tentative d'installation depuis le cache
  ‚Ü¶ Install√© depuis le cache ‚úì
[SUCCESS] Mosquitto et d√©pendances install√© depuis le cache

[SUCCESS] Tous les paquets install√©s avec succ√®s
  ‚Ü¶ Mosquitto install√© ‚úì
[INFO] Mosquitto install√© avec succ√®s

========================================================================
√âTAPE 3 : CONFIGURATION SYST√àME
========================================================================

‚ó¶ V√©rification de l'utilisateur syst√®me...
  ‚Ü¶ Utilisateur syst√®me existant ‚úì

‚ó¶ Cr√©ation des r√©pertoires...
  ‚Ü¶ R√©pertoires cr√©√©s et permissions appliqu√©es ‚úì
[INFO] R√©pertoires Mosquitto cr√©√©s

‚ó¶ Mise √† jour du cache des biblioth√®ques...
  ‚Ü¶ Cache des biblioth√®ques mis √† jour ‚úì
[INFO] ldconfig ex√©cut√©

========================================================================
√âTAPE 4 : CONFIGURATION DE MOSQUITTO
========================================================================

‚ó¶ Cr√©ation de l'utilisateur MQTT...
[CMD] Ex√©cution: Cr√©ation utilisateur MQTT
[CMD] Commande: /usr/bin/mosquitto_passwd -b -c '/etc/mosquitto/passwords' 'mosquitto' 'mqtt'
[CMD] Code de sortie: 0
  ‚Ü¶ Utilisateur 'mosquitto' cr√©√© ‚úì
[INFO] Utilisateur MQTT cr√©√©: mosquitto

‚ó¶ Cr√©ation du fichier de configuration avec statistiques...
[INFO] Ancienne configuration sauvegard√©e
  ‚Ü¶ Configuration cr√©√©e avec statistiques activ√©es ‚úì
[SUCCESS] Configuration Mosquitto cr√©√©e avec topics syst√®me

‚ó¶ Configuration des permissions ACL...
  ‚Ü¶ Permissions ACL configur√©es ‚úì
[INFO] Fichier ACL cr√©√©

========================================================================
√âTAPE 5 : D√âMARRAGE DU SERVICE
========================================================================

‚ó¶ Activation du service au d√©marrage...
[CMD] Ex√©cution: Activation au d√©marrage
[CMD] Commande: systemctl enable mosquitto >/dev/null 2>&1
[CMD] Code de sortie: 0
  ‚Ü¶ Service activ√© ‚úì

‚ó¶ D√©marrage de Mosquitto...
[CMD] Ex√©cution: D√©marrage Mosquitto
[CMD] Commande: systemctl start mosquitto
[CMD] Code de sortie: 0
  ‚Ü¶ Mosquitto d√©marr√© ‚úì
[SUCCESS] Mosquitto d√©marr√© avec succ√®s
  ‚Ü¶ Service actif et fonctionnel ‚úì
[INFO] Service Mosquitto actif

========================================================================
√âTAPE 6 : TESTS DE CONNEXION
========================================================================

‚ó¶ Test de connexion MQTT (port 1883)...
  ‚Ü¶ Connexion MQTT r√©ussie ‚úì
[SUCCESS] Test de connexion MQTT r√©ussi

‚ó¶ Test du port WebSocket (9001)...
  ‚Ü¶ Port WebSocket non accessible ‚ö†
[WARN] Port WebSocket non accessible imm√©diatement

‚ó¶ Test des topics syst√®me ()...
mosquitto version 2.0.11
  ‚Ü¶ Topics syst√®me accessibles ‚úì
[SUCCESS] Topics syst√®me  accessibles

‚ó¶ Mise √† jour du statut du service...
Statut mqtt mis √† jour: active
  ‚Ü¶ Statut du service mqtt mis √† jour: active
  ‚Ü¶ Statut du service mis √† jour ‚úì
[INFO] Statut du service mqtt mis √† jour: active

========================================================================
INSTALLATION TERMIN√âE AVEC SUCC√àS !
========================================================================

‚ó¶ Broker MQTT Mosquitto install√© et configur√©
‚ó¶ Topics syst√®me () activ√©s pour les statistiques

‚ó¶ Informations de connexion :
  ‚Ä¢ Serveur      : localhost (ou IP du Raspberry Pi)
  ‚Ä¢ Port MQTT    : 1883
  ‚Ä¢ Port WebSocket : 9001
  ‚Ä¢ Utilisateur  : mosquitto
  ‚Ä¢ Mot de passe : mqtt

‚ó¶ Commandes utiles :
  ‚Ä¢ √âtat : systemctl status mosquitto
  ‚Ä¢ Logs : journalctl -u mosquitto -f
  ‚Ä¢ Test : mosquitto_sub -h localhost -u mosquitto -P mqtt -t '#' -v

‚ó¶ IMPORTANT : L'orchestrateur doit √™tre install√© pour g√©rer le d√©marrage

[SUCCESS] Installation MQTT Broker termin√©e
[INFO] Configuration: mosquitto/mqtt sur ports 1883 et 9001

  ‚Ü¶ Red√©marrage diff√©r√© (installation compl√®te en cours)

[INFO] Red√©marrage diff√©r√© - SKIP_REBOOT=true
[INFO] Script mqtt_install termin√© avec le code 0

[SUCCESS] mqtt_install.sh install√© avec succ√®s

  ‚Ü¶ Pause avant l'√©tape suivante... 10 9 8 7 6 5 4 3 2 1 ‚úì

========================================================================
√âTAPE 6/8 : Widgets MQTT
========================================================================

‚ó¶ Ex√©cution de mqtt_wgs_install.sh...

[INFO] Ex√©cution de mqtt_wgs_install.sh
[INFO] Script mqtt_wgs_install initialis√©
[INFO] ========== D√âBUT DE L'INSTALLATION DES WIDGETS MQTT ==========

========================================================================
INSTALLATION DES WIDGETS MQTT (WGS)
========================================================================

‚ó¶ V√©rification du broker MQTT...
  ‚Ü¶ Broker MQTT actif ‚úì

‚ó¶ Recherche des widgets disponibles...
  ‚Ü¶ 7 widget(s) trouv√©(s) ‚úì

Widgets disponibles :
  ‚Ä¢ mqttstats
  ‚Ä¢ rebootbutton
  ‚Ä¢ servermonitoring
  ‚Ä¢ testpersist
  ‚Ä¢ timesync
  ‚Ä¢ uptime
  ‚Ä¢ wifistats

[INFO] Installation des d√©pendances Python
‚ó¶ V√©rification des paquets Python...
  ‚Ü¶ Installation des paquets manquants...
[INFO] Installation des paquets de la cat√©gorie: python
  ‚Ü¶ Installation de python3-psutil...
[INFO] Installation du paquet depuis le cache: python3-psutil
[INFO] Fichiers .deb trouv√©s pour python3-psutil: 1 fichier(s)
[INFO] Fichiers: /var/cache/maxlink/packages/python3-psutil_5.9.4-1+b1_arm64.deb
[SUCCESS] Paquet install√© depuis le cache: python3-psutil
    ‚úì python3-psutil install√©
  ‚Ü¶ Installation de python3-paho-mqtt...
[INFO] Installation du paquet depuis le cache: python3-paho-mqtt
[INFO] Fichiers .deb trouv√©s pour python3-paho-mqtt: 1 fichier(s)
[INFO] Fichiers: /var/cache/maxlink/packages/python3-paho-mqtt_1.6.1-1_all.deb
[SUCCESS] Paquet install√© depuis le cache: python3-paho-mqtt
    ‚úì python3-paho-mqtt install√©
  ‚Ü¶ Installation de python3-pip...
[INFO] Installation du paquet depuis le cache: python3-pip
[INFO] Fichiers .deb trouv√©s pour python3-pip: 1 fichier(s)
[INFO] Fichiers: /var/cache/maxlink/packages/python3-pip_23.0.1+dfsg-1+rpt1_all.deb
[SUCCESS] Paquet install√© depuis le cache: python3-pip
    ‚úì python3-pip install√©
  ‚Ü¶ Installation de python3-setuptools...
[INFO] Installation du paquet depuis le cache: python3-setuptools
[INFO] Fichiers .deb trouv√©s pour python3-setuptools: 1 fichier(s)
[INFO] Fichiers: /var/cache/maxlink/packages/python3-setuptools_66.1.1-1+deb12u1_all.deb
[SUCCESS] Paquet install√© depuis le cache: python3-setuptools
    ‚úì python3-setuptools install√©
  ‚Ü¶ D√©pendances Python install√©es ‚úì

========================================================================
INSTALLATION DES WIDGETS
========================================================================

Installation du widget: mqttstats
------------------------------------
[SUCCESS] Widget mqttstats valid√©
  ‚Ü¶ Copie du core des widgets...
[INFO] V√©rification des d√©pendances Python pour mqttstats
[INFO] D√©pendances Python v√©rifi√©es (install√©es via le cache)
[INFO] Cr√©ation du service maxlink-widget-mqttstats
[INFO] Copie des fichiers du widget vers /opt/maxlink
[INFO] Service cr√©√© : maxlink-widget-mqttstats.service
[SUCCESS] Service activ√©: maxlink-widget-mqttstats
[SUCCESS] Service d√©marr√©: maxlink-widget-mqttstats
[SUCCESS] Widget mqttstats enregistr√©
  ‚Ü¶ Widget mqttstats install√© ‚úì
  ‚Ü¶ Note : L'orchestrateur g√®re le d√©marrage ordonn√©

Installation du widget: rebootbutton
------------------------------------
[SUCCESS] Widget rebootbutton valid√©
[INFO] V√©rification des d√©pendances Python pour rebootbutton
[INFO] D√©pendances Python v√©rifi√©es (install√©es via le cache)
[INFO] Cr√©ation du service maxlink-widget-rebootbutton
[INFO] Copie des fichiers du widget vers /opt/maxlink
[INFO] Service cr√©√© : maxlink-widget-rebootbutton.service
[SUCCESS] Service activ√©: maxlink-widget-rebootbutton
[SUCCESS] Service d√©marr√©: maxlink-widget-rebootbutton
[SUCCESS] Widget rebootbutton enregistr√©
  ‚Ü¶ Widget rebootbutton install√© ‚úì
  ‚Ü¶ Note : L'orchestrateur g√®re le d√©marrage ordonn√©

Installation du widget: servermonitoring
------------------------------------
[SUCCESS] Widget servermonitoring valid√©
[INFO] V√©rification des d√©pendances Python pour servermonitoring
[INFO] D√©pendances Python v√©rifi√©es (install√©es via le cache)
[INFO] Cr√©ation du service maxlink-widget-servermonitoring
[INFO] Copie des fichiers du widget vers /opt/maxlink
[INFO] Service cr√©√© : maxlink-widget-servermonitoring.service
[SUCCESS] Service activ√©: maxlink-widget-servermonitoring
[SUCCESS] Service d√©marr√©: maxlink-widget-servermonitoring
[SUCCESS] Widget servermonitoring enregistr√©
  ‚Ü¶ Widget servermonitoring install√© ‚úì
  ‚Ü¶ Note : L'orchestrateur g√®re le d√©marrage ordonn√©

Installation du widget: testpersist
------------------------------------
[SUCCESS] Widget testpersist valid√©
[INFO] V√©rification des d√©pendances Python pour testpersist
[INFO] D√©pendances Python v√©rifi√©es (install√©es via le cache)
[INFO] Cr√©ation du service maxlink-widget-testpersist
[INFO] Copie des fichiers du widget vers /opt/maxlink
[INFO] Service cr√©√© : maxlink-widget-testpersist.service
[SUCCESS] Service activ√©: maxlink-widget-testpersist
[SUCCESS] Service d√©marr√©: maxlink-widget-testpersist
[SUCCESS] Widget testpersist enregistr√©
  ‚Ü¶ Widget testpersist install√© ‚úì
  ‚Ü¶ Note : L'orchestrateur g√®re le d√©marrage ordonn√©

Installation du widget: timesync
------------------------------------
[SUCCESS] Widget timesync valid√©
[INFO] V√©rification des d√©pendances Python pour timesync
[INFO] D√©pendances Python v√©rifi√©es (install√©es via le cache)
[INFO] Cr√©ation du service maxlink-widget-timesync
[INFO] Copie des fichiers du widget vers /opt/maxlink
[INFO] Service cr√©√© : maxlink-widget-timesync.service
[SUCCESS] Service activ√©: maxlink-widget-timesync
[SUCCESS] Service d√©marr√©: maxlink-widget-timesync
[SUCCESS] Widget timesync enregistr√©
  ‚Ü¶ Widget timesync install√© ‚úì
  ‚Ü¶ Note : L'orchestrateur g√®re le d√©marrage ordonn√©

Installation du widget: uptime
------------------------------------
[SUCCESS] Widget uptime valid√©
[INFO] V√©rification des d√©pendances Python pour uptime
[INFO] Aucune d√©pendance Python pour uptime
  ‚Ü¶ Widget passif (pas de collector)
[SUCCESS] Widget uptime enregistr√©
  ‚Ü¶ Widget uptime install√© ‚úì

Installation du widget: wifistats
------------------------------------
[SUCCESS] Widget wifistats valid√©
[INFO] V√©rification des d√©pendances Python pour wifistats
[INFO] D√©pendances Python v√©rifi√©es (install√©es via le cache)
[INFO] Cr√©ation du service maxlink-widget-wifistats
[INFO] Copie des fichiers du widget vers /opt/maxlink
[INFO] Service cr√©√© : maxlink-widget-wifistats.service
[SUCCESS] Service activ√©: maxlink-widget-wifistats
[SUCCESS] Service d√©marr√©: maxlink-widget-wifistats
[SUCCESS] Widget wifistats enregistr√©
  ‚Ü¶ Widget wifistats install√© ‚úì
  ‚Ü¶ Note : L'orchestrateur g√®re le d√©marrage ordonn√©

========================================================================
V√âRIFICATION FINALE
========================================================================

‚ó¶ √âtat des services :
  ‚Ü¶ mqttstats : ‚úì actif
  ‚Ü¶ rebootbutton : ‚úì actif
  ‚Ü¶ servermonitoring : ‚úì actif
  ‚Ü¶ testpersist : ‚úì actif
  ‚Ü¶ timesync : ‚úì actif
  ‚Ü¶ uptime : ‚úó inactif
  ‚Ü¶ wifistats : ‚úì actif

‚ó¶ Test de r√©ception MQTT...
  ‚Ü¶ Messages MQTT re√ßus ‚úì

‚ó¶ Mise √† jour du statut du service...
Statut mqtt_wgs mis √† jour: active
  ‚Ü¶ Statut du service mqtt_wgs mis √† jour: active
  ‚Ü¶ Statut du service mis √† jour : active ‚úì
[INFO] Statut du service mqtt_wgs mis √† jour: active

========================================================================
R√âSUM√â
========================================================================

‚ó¶ Widgets trouv√©s    : 7
‚ó¶ Widgets install√©s  : 7
‚ó¶ Widgets √©chou√©s    : 0

‚úì Installation termin√©e avec succ√®s !
[SUCCESS] Tous les widgets install√©s avec succ√®s
Commandes utiles :
  ‚Ä¢ Voir tous les logs    : journalctl -u 'maxlink-widget-*' -f
  ‚Ä¢ Voir tous les topics  : mosquitto_sub -h localhost -u mosquitto -P mqtt -t '#' -v
  ‚Ä¢ √âtat des services     : systemctl status 'maxlink-widget-*'

[INFO] Installation termin√©e - Install√©s: 7/7

  ‚Ü¶ Red√©marrage diff√©r√© (installation compl√®te en cours)

[INFO] Red√©marrage diff√©r√© - SKIP_REBOOT=true
[INFO] Script mqtt_wgs_install termin√© avec le code 0

[SUCCESS] mqtt_wgs_install.sh install√© avec succ√®s

  ‚Ü¶ Pause avant l'√©tape suivante... 10 9 8 7 6 5 4 3 2 1 ‚úì

========================================================================
√âTAPE 7/8 : Systeme php
========================================================================

‚ó¶ Ex√©cution de php_archives_install.sh...

[INFO] Ex√©cution de php_archives_install.sh
[INFO] Script php_archives_install initialis√©
[INFO] ========== D√âBUT DE L'INSTALLATION PHP Archives System ==========

========================================================================
INSTALLATION PHP Archives System (VERSION FINALE 100%)
========================================================================

üîç V√©rifications initiales...
   ‚úÖ Privil√®ges root confirm√©s
[SUCCESS] Privil√®ges root confirm√©s

========================================================================
√âTAPE 1 : V√âRIFICATION DES PR√âREQUIS
========================================================================

[INFO] V√©rification des pr√©requis pour PHP Archives System
[SUCCESS] Pr√©requis valid√©s
   ‚úÖ Tous les pr√©requis sont satisfaits

========================================================================
√âTAPE 2 : INSTALLATION PHP
========================================================================

   ‚Ü¶ PHP non install√© - installation compl√®te n√©cessaire
‚ó¶ Installation de PHP depuis le cache...
[INFO] Installation de PHP depuis le cache local
  ‚Ü¶ V√©rification du cache PHP...
[INFO] V√©rification compl√®te du cache pour la cat√©gorie: php
  ‚Ü¶ V√©rification de la pr√©sence de tous les paquets php...
    ‚úì Pr√©sent: php (11 fichier(s))
[SUCCESS] Paquet trouv√© dans cache: php
    ‚úì Pr√©sent: php-cli (1 fichier(s))
[SUCCESS] Paquet trouv√© dans cache: php-cli
    ‚úì Pr√©sent: php-fpm (1 fichier(s))
[SUCCESS] Paquet trouv√© dans cache: php-fpm
  ‚Ü¶ R√©sum√©: 3/3 paquets pr√©sents
  ‚Ü¶ ‚úÖ Tous les paquets php sont pr√©sents dans le cache
[SUCCESS] Cache complet pour php
  ‚Ü¶ ‚úÖ Cache PHP v√©rifi√© et complet
  ‚Ü¶ V√©rification des installations existantes...
  ‚Ü¶ Installation PHP compl√®te n√©cessaire
[INFO] Installation PHP compl√®te n√©cessaire
  ‚Ü¶ Installation simultan√©e de tous les paquets PHP...
[INFO] Lancement de l'installation simultan√©e PHP
[INFO] Installation simultan√©e des paquets de la cat√©gorie: php
  ‚Ü¶ Collecte des fichiers .deb pour installation simultan√©e...
    ‚úì Fichier trouv√©: php
    ‚úì Fichier trouv√©: php-cli
    ‚úì Fichier trouv√©: php-fpm
  ‚Ü¶ Fichiers collect√©s: 3 paquets pr√™ts
[INFO] Fichiers .deb collect√©s pour installation:  /var/cache/maxlink/packages/php8.2-common_8.2.28-1~deb12u1_arm64.deb
/var/cache/maxlink/packages/php8.2_8.2.28-1~deb12u1_all.deb
/var/cache/maxlink/packages/php-common_2%3a93_all.deb
/var/cache/maxlink/packages/php8.2-opcache_8.2.28-1~deb12u1_arm64.deb
/var/cache/maxlink/packages/php8.2-cgi_8.2.28-1~deb12u1_arm64.deb
/var/cache/maxlink/packages/php_2%3a8.2+93_all.deb
/var/cache/maxlink/packages/php8.2-readline_8.2.28-1~deb12u1_arm64.deb
/var/cache/maxlink/packages/php8.2-fpm_8.2.28-1~deb12u1_arm64.deb
/var/cache/maxlink/packages/php8.2-cli_8.2.28-1~deb12u1_arm64.deb
/var/cache/maxlink/packages/php-fpm_2%3a8.2+93_all.deb
/var/cache/maxlink/packages/php-cli_2%3a8.2+93_all.deb /var/cache/maxlink/packages/php-cli_2%3a8.2+93_all.deb /var/cache/maxlink/packages/php-fpm_2%3a8.2+93_all.deb
  ‚Ü¶ Installation simultan√©e de tous les paquets php...
[INFO] Lancement installation dpkg simultan√©e
    ‚úì Tous les paquets php install√©s simultan√©ment
[SUCCESS] Installation simultan√©e r√©ussie pour php
  ‚Ü¶ ‚úÖ PHP install√© avec succ√®s depuis le cache
[SUCCESS] PHP install√© avec succ√®s
  ‚Ü¶ V√©rification post-installation...
    ‚úì php v√©rifi√©
    ‚úì php-cli v√©rifi√©
    ‚úì php-fpm v√©rifi√©
  ‚Ü¶ ‚úÖ V√©rification post-installation r√©ussie
[SUCCESS] V√©rification post-installation PHP r√©ussie
   ‚úÖ PHP install√© avec succ√®s

========================================================================
√âTAPE 3 : ACTIVATION PHP-FPM
========================================================================

[INFO] Activation du service PHP-FPM
  ‚Ü¶ Activation de PHP-FPM...
    ‚úì PHP-FPM d√©j√† actif
[INFO] PHP-FPM d√©j√† actif
   ‚úÖ PHP-FPM activ√© avec succ√®s

========================================================================
√âTAPE 4 : INSTALLATION DES FICHIERS
========================================================================

[INFO] Installation des fichiers PHP et JavaScript
  ‚Ü¶ Copie des fichiers PHP et JavaScript...
    ‚úì archives-list.php copi√©
[SUCCESS] Fichier copi√©: archives-list.php
    ‚úì download-archive.php copi√©
[SUCCESS] Fichier copi√©: download-archive.php
    ‚úì download-manager.js copi√©
[SUCCESS] Fichier copi√©: download-manager.js
[SUCCESS] Fichiers PHP et JavaScript install√©s

========================================================================
√âTAPE 5 : CONFIGURATION NGINX S√âCURIS√âE POUR PHP
========================================================================

[INFO] Configuration nginx pour PHP avec s√©curit√© renforc√©e
  ‚Ü¶ V√©rification de la configuration nginx...
  ‚Ü¶ Ajout de la configuration PHP s√©curis√©e √† nginx...
[INFO] Modification de la configuration nginx pour PHP
    ‚úì Backup cr√©√©: maxlink-dashboard.backup.php.20250719_144334
[INFO] Backup configuration nginx cr√©√©
    ‚úì Configuration PHP s√©curis√©e ajout√©e
[SUCCESS] Configuration PHP s√©curis√©e ajout√©e √† nginx
  ‚Ü¶ Test de la configuration nginx...
    ‚úì Configuration nginx valid√©e
[SUCCESS] Configuration nginx valide
  ‚Ü¶ Red√©marrage de nginx...
    ‚úì Nginx red√©marr√© avec succ√®s
[SUCCESS] Nginx red√©marr√© avec configuration PHP s√©curis√©e
   ‚úÖ Nginx configur√© avec s√©curit√© renforc√©e

========================================================================
√âTAPE 6 : PERMISSIONS STRICTES (644 FORC√â)
========================================================================

[INFO] Configuration STRICTE des permissions (644 forc√©)
  ‚Ü¶ Arr√™t temporaire nginx pour permissions strictes...
  ‚Ü¶ Application FORC√âE des permissions s√©curis√©es...
    ‚Üí S√©curisation de archives-list.php...
    ‚úì archives-list.php s√©curis√© (644)
[SUCCESS] Permissions strictes: archives-list.php (644)
    ‚Üí S√©curisation de download-archive.php...
    ‚úì download-archive.php s√©curis√© (644)
[SUCCESS] Permissions strictes: download-archive.php (644)
    ‚Üí S√©curisation de download-manager.js...
    ‚úì download-manager.js s√©curis√© (644)
[SUCCESS] Permissions strictes: download-manager.js (644)
    ‚úì R√©pertoire archives configur√© (755)
  ‚Ü¶ Red√©marrage nginx...
[SUCCESS] Permissions strictes configur√©es
   ‚úÖ Permissions strictes (644) appliqu√©es

========================================================================
√âTAPE 7 : OPTIMISATION S√âCURIT√â PHP
========================================================================

[INFO] Optimisation de la s√©curit√© PHP
  ‚Ü¶ Configuration de la s√©curit√© PHP...
    ‚úì Configuration s√©curit√© PHP cr√©√©e
    ‚úì PHP-FPM red√©marr√© avec nouvelle configuration
[SUCCESS] S√©curit√© PHP optimis√©e
   ‚úÖ S√©curit√© PHP optimis√©e

========================================================================
√âTAPE 8 : CR√âATION ARCHIVES DE TEST
========================================================================

[INFO] Cr√©ation des archives de test
  ‚Ü¶ V√©rification du r√©pertoire de donn√©es...
  ‚Ü¶ Archives existantes trouv√©es (3 fichiers CSV) ‚úì
[INFO] Archives existantes: 3 fichiers
   ‚úÖ Archives de test cr√©√©es

========================================================================
√âTAPE 9 : PR√âPARATION DIAGNOSTIC
========================================================================

[INFO] Cr√©ation du lien pour diagnostic
  ‚Ü¶ Cr√©ation du lien symbolique pour le log d'installation...
   ‚úÖ Diagnostic pr√©par√©

========================================================================
√âTAPE 10 : VALIDATION FINALE COMPL√àTE
========================================================================

[INFO] Test complet du service PHP
  ‚Ü¶ Test de PHP CLI...
    ‚úì PHP CLI fonctionnel (version 8.2.28)
[SUCCESS] PHP CLI v√©rifi√©: 8.2.28
  ‚Ü¶ Test de PHP-FMP...
    ‚úì PHP-FPM actif et fonctionnel
[SUCCESS] PHP-FPM v√©rifi√© actif
  ‚Ü¶ Test HTTP et JSON des scripts...
    ‚úì archives-list.php ‚Üí JSON valide (HTTP 200)
[SUCCESS] archives-list.php op√©rationnel
    ‚úì download-archive.php ‚Üí JSON valide (HTTP 200)
[SUCCESS] download-archive.php op√©rationnel
    ‚úì download-manager.js ‚Üí accessible (HTTP 200)
[SUCCESS] download-manager.js accessible
  ‚Ü¶ Test de protection injection SQL...
    ‚úì Protection injection SQL ‚Üí Bloqu√© (HTTP 400)
[SUCCESS] S√©curit√© injection SQL valid√©e

========================================================================
INSTALLATION TERMIN√âE - OPTIMISATION MAXIMALE 100%
========================================================================

Statut php_archives mis √† jour: active
  ‚Ü¶ Statut du service php_archives mis √† jour: active
üéâ PHP Archives System install√© avec optimisation MAXIMALE !

üîó URLs disponibles :
  ‚Ä¢ Liste des archives : http://localhost/archives-list.php
  ‚Ä¢ T√©l√©chargement fichier : http://localhost/download-archive.php?file=S01_2025_machine1.csv&year=2025
  ‚Ä¢ Liste semaine : http://localhost/download-archive.php?week=1&year=2025
  ‚Ä¢ Gestionnaire JavaScript : http://localhost/download-manager.js

üõ°Ô∏è S√©curit√© appliqu√©e :
  ‚Ä¢ ‚úÖ Permissions strictes (644 pour fichiers)
  ‚Ä¢ ‚úÖ Protection injection SQL nginx
  ‚Ä¢ ‚úÖ Configuration PHP s√©curis√©e
  ‚Ä¢ ‚úÖ Headers s√©curit√© HTTP
  ‚Ä¢ ‚úÖ Validation JSON stricte

üìä Test recommand√© :
  sudo ./diagnostic_php_archives.sh

üéØ Score attendu: 100% !
[SUCCESS] Installation PHP Archives System termin√©e avec succ√®s - OPTIMISATION MAXIMALE
[INFO] Script php_archives termin√© avec le code 0
[INFO] Script php_archives_install termin√© avec le code 0

[SUCCESS] php_archives_install.sh install√© avec succ√®s

  ‚Ü¶ Pause avant l'√©tape suivante... 10 9 8 7 6 5 4 3 2 1 ‚úì

========================================================================
√âTAPE 8/8 : Orchestrateur et finalisation
========================================================================

‚ó¶ Ex√©cution de orchestrator_install.sh...

[INFO] Ex√©cution de orchestrator_install.sh
[INFO] Script orchestrator_install initialis√©

========================================================================
ORCHESTRATEUR MAXLINK - INSTALLATION
========================================================================

‚ó¶ Premi√®re installation d√©tect√©e
[INFO] Premi√®re installation de l'orchestrateur

========================================================================
COPIE DES WIDGETS
========================================================================
‚ö† R√©pertoire des widgets non trouv√© : /media/prod/USBTOOL/widgets
[ERROR] R√©pertoire widgets non trouv√©
‚ö† Erreur lors de la copie des widgets
[ERROR] √âchec de la copie des widgets

========================================================================
CONFIGURATION DES PERMISSIONS SSH POUR L'UTILISATEUR PROD
========================================================================
‚ó¶ Activation du support ACL sur le syst√®me de fichiers...
  ‚Ü¶ ACL activ√© ‚úì
‚ó¶ Configuration des permissions ACL pour l'utilisateur prod...
‚ó¶ R√©initialisation du masque ACL...
  ‚Ü¶ Masque ACL r√©initialis√© √† rwx ‚úì
  ‚Ü¶ Permissions ACL configur√©es ‚úì
  ‚Ü¶ Script de maintenance cr√©√© : /usr/local/bin/maxlink-fix-prod-permissions

‚ó¶ V√©rification des permissions...
  ‚Ü¶ Permissions ACL v√©rifi√©es ‚úì
  ‚ö† Masque ACL incorrect (r-x), correction...
  ‚Ü¶ Masque corrig√© ‚úì
[SUCCESS] Permissions SSH configur√©es pour l'utilisateur prod

========================================================================
CONFIGURATION DU MODULE RTC
========================================================================
‚ó¶ D√©tection du module RTC...
  ‚Ü¶ Module RTC d√©j√† configur√© ‚úì
  ‚Ü¶ RTC fonctionnel : 2025-07-19 14:44:04.002257+02:00
  ‚Ü¶ Type d√©tect√©/suppos√© : ds3231
  ‚Ü¶ Module RTC d√©tect√© : ds3231 ‚úì
[INFO] Module RTC ds3231 d√©tect√©
‚ó¶ Configuration du device tree overlay...
  ‚Ü¶ Overlay ajout√© au fichier de configuration ‚úì
[SUCCESS] Overlay RTC configur√© dans /boot/firmware/config.txt
‚ó¶ V√©rification des outils RTC...
  ‚Ü¶ Outils RTC disponibles ‚úì
‚ó¶ Cr√©ation du service de synchronisation RTC...
  ‚Ü¶ Service de synchronisation cr√©√© ‚úì
[SUCCESS] Service RTC configur√©
‚ó¶ D√©sactivation de fake-hwclock...
  ‚Ü¶ fake-hwclock d√©sactiv√© ‚úì
‚ó¶ D√©sactivation des services NTP (serveur hors ligne)...
  ‚Ü¶ systemd-timesyncd d√©sactiv√© ‚úì
  ‚Ü¶ Synchronisation temps r√©seau compl√®tement d√©sactiv√©e ‚úì

‚úì Configuration RTC termin√©e
  Module : ds3231
  Service : maxlink-rtc-sync.service
  Services NTP : d√©sactiv√©s
[SUCCESS] Configuration RTC compl√®te pour module ds3231 avec NTP d√©sactiv√©

========================================================================
INFRASTRUCTURE D'ORCHESTRATION
========================================================================
‚ó¶ Cr√©ation des scripts de v√©rification...
  ‚Ü¶ Scripts de v√©rification cr√©√©s ‚úì
[SUCCESS] Scripts healthcheck cr√©√©s
‚ó¶ Cr√©ation des services systemd...
  ‚Ü¶ Services systemd cr√©√©s ‚úì
[SUCCESS] Services systemd cr√©√©s
‚ó¶ Cr√©ation des targets systemd...
  ‚Ü¶ Targets systemd cr√©√©s ‚úì
[SUCCESS] Targets systemd cr√©√©s
‚ó¶ Configuration des d√©pendances des services...
  ‚Ü¶ D√©pendances configur√©es ‚úì
[SUCCESS] Overrides systemd configur√©s
‚ó¶ Cr√©ation du script orchestrateur...
  ‚Ü¶ Script orchestrateur cr√©√© ‚úì
[SUCCESS] Script de gestion cr√©√©

========================================================================
CONFIGURATION SYSTEMD
========================================================================
‚ó¶ Rechargement de la configuration systemd...
  ‚Ü¶ Configuration recharg√©e ‚úì
[SUCCESS] Systemd daemon-reload effectu√©

========================================================================
CORRECTION FINALE DES PERMISSIONS
========================================================================
‚ó¶ Correction du masque ACL apr√®s les installations...
  ‚Ü¶ Dashboard d√©tect√©, correction des permissions...
  ‚Ü¶ Permissions du dashboard corrig√©es ‚úì
[SUCCESS] Permissions du dashboard corrig√©es apr√®s installation
  ‚Ü¶ Masque ACL global corrig√© ‚úì

‚ó¶ √âtat final des permissions:
# owner: www-data
# group: www-data
user:prod:rwx
group::r-x
mask::rwx
default:user:prod:rwx
default:group::r-x
default:mask::rwx

========================================================================
ACTIVATION DE L'ORCHESTRATEUR
========================================================================
[2025-07-19 14:44:10] Activation des services MaxLink...
[2025-07-19 14:44:11] Services activ√©s
[SUCCESS] Services de l'orchestrateur activ√©s

========================================================================
INSTALLATION TERMIN√âE
========================================================================

‚úì L'orchestrateur MaxLink a √©t√© install√© avec succ√®s !

Commandes disponibles :
  maxlink-orchestrator start    - D√©marrer tous les services
  maxlink-orchestrator stop     - Arr√™ter tous les services
  maxlink-orchestrator status   - Voir l'√©tat des services
  maxlink-orchestrator restart  - Red√©marrer tous les services

Script de maintenance des permissions :
  /usr/local/bin/maxlink-fix-prod-permissions
[SUCCESS] Installation de l'orchestrateur termin√©e
[INFO] Script orchestrator_install termin√© avec le code 0

[SUCCESS] orchestrator_install.sh install√© avec succ√®s

========================================================================
INSTALLATION TERMIN√âE
========================================================================

Dur√©e totale : 20m 44s


========================================================================
STATUT DE L'INSTALLATION
========================================================================
  ‚úì update: active
  ‚úì ap: active
  ‚úì nginx: active
  ‚úì fake_ncsi: active
  ‚úì mqtt: active
  ‚úì mqtt_wgs: active
  ‚úì php_archives: active
  ‚úì orchestrator: active
========================================================================

‚úì Tous les composants ont √©t√© install√©s avec succ√®s !

MaxLink est maintenant op√©rationnel. Les fonctionnalit√©s suivantes sont disponibles :
  ‚Ä¢ Point d'acc√®s WiFi : MaxLink-NETWORK
  ‚Ä¢ Dashboard Web : http://192.168.4.1 ou http://maxlink-dashboard.local
  ‚Ä¢ Broker MQTT : mosquitto@localhost:1883
  ‚Ä¢ Widgets de monitoring actifs
  ‚Ä¢ Orchestrateur pour la gestion des services

Commandes utiles :
  ‚Ä¢ √âtat du syst√®me : sudo /usr/local/bin/maxlink-orchestrator status
  ‚Ä¢ V√©rification : sudo /usr/local/bin/maxlink-orchestrator check
  ‚Ä¢ Diagnostic : sudo /media/prod/USBTOOL/diag.sh

[SUCCESS] Installation compl√®te r√©ussie - 0 erreur

Un red√©marrage est n√©cessaire pour finaliser l'installation.

  ‚Ü¶ Red√©marrage du syst√®me dans 30 secondes...