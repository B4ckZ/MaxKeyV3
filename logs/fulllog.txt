onsole pr√™te - Mode Privil√©gi√©: ACTIF


======================================================================
D√âMARRAGE: Installation compl√®te de MaxLink
Script: /media/prod/WERIT/scripts/install/full_install_install.sh
======================================================================

[INFO] Initialisation du logging pour full_install_install
[INFO] Installation compl√®te MaxLink
[H[2J[3J
========================================================================
 MAXLINK‚Ñ¢ - INSTALLATION COMPL√àTE V3
 ¬© 2025 WERIT. Tous droits r√©serv√©s.
========================================================================

Installation automatique de tous les composants MaxLink :

  ‚Ä¢ Mise √† jour syst√®me et cache
  ‚Ä¢ Point d'acc√®s WiFi
  ‚Ä¢ Serveur Web et Dashboard
  ‚Ä¢ Broker MQTT
  ‚Ä¢ Widgets MQTT
  ‚Ä¢ Orchestrateur et finalisation

L'installation compl√®te prendra environ 10-15 minutes.

D√©marrage de l'installation...

[INFO] ========== D√âBUT DE L'INSTALLATION COMPL√àTE MAXLINK ==========

========================================================================
√âTAPE 1/6 : Mise √† jour syst√®me et cache
========================================================================

‚ó¶ Ex√©cution de update_install.sh...

[INFO] Ex√©cution de update_install.sh
[INFO] Initialisation du logging pour update_install
[INFO] Mise √† jour syst√®me MaxLink
[INFO] ========== D√âBUT DE LA MISE √Ä JOUR SYST√àME V11 ==========
========================================================================
√âTAPE 1 : PR√âPARATION DU SYST√àME
========================================================================

[INFO] Progression: 5% - Pr√©paration du syst√®me...
‚ó¶ Stabilisation du syst√®me apr√®s d√©marrage...
  ‚Ü¶ Initialisation des services r√©seau...
[INFO] Stabilisation du syst√®me - attente 10s pour OS frais

‚ó¶ D√©sactivation temporaire des mises √† jour automatiques...
[INFO] D√©sactivation des mises √† jour automatiques
  ‚Ü¶ Mises √† jour automatiques suspendues ‚úì
[INFO] Sauvegarde de l'√©tat r√©seau actuel
[INFO] Mode AP non actif

‚ó¶ V√©rification de l'interface WiFi...
  ‚Ü¶ Interface WiFi d√©tect√©e ‚úì
[INFO] Interface WiFi wlan0 d√©tect√©e
[INFO] Activation WiFi
[CMD] Ex√©cution: nmcli radio wifi on >/dev/null 2>&1
[SUCCESS] Commande r√©ussie (code: 0)
  ‚Ü¶ WiFi activ√© ‚úì
[INFO] Progression: 10% - WiFi pr√©par√©

========================================================================
√âTAPE 2 : CONNEXION R√âSEAU
========================================================================

[INFO] Progression: 15% - Connexion au r√©seau...
[INFO] V√©rification et √©tablissement de la connexion internet
[INFO] Sauvegarde de l'√©tat r√©seau actuel
[INFO] Mode AP non actif
[DEBUG] V√©rification de la connectivit√© internet
[DEBUG] Pas de connectivit√© internet
‚ó¶ Connexion automatique au r√©seau pour t√©l√©chargement...
[INFO] Connexion automatique requise pour t√©l√©charger les paquets
  ‚Ü¶ Connexion au r√©seau "Max"...
[INFO] Tentative de connexion √† Max
  ‚Ü¶ Connexion √©tablie ‚úì
[SUCCESS] Connexion WiFi √©tablie
[DEBUG] V√©rification de la connectivit√© internet
[DEBUG] Connectivit√© internet OK
  ‚Ü¶ Connectivit√© internet confirm√©e ‚úì
[SUCCESS] Connectivit√© internet confirm√©e
  ‚Ü¶ Stabilisation de la connexion (5s)...
[INFO] Stabilisation de la connexion - attente 5s
[INFO] Progression: 30% - Connexion √©tablie

========================================================================
√âTAPE 3 : SYNCHRONISATION HORLOGE
========================================================================

[INFO] Progression: 35% - Synchronisation de l'horloge...
‚ó¶ Synchronisation de l'horloge syst√®me...
[INFO] Synchronisation NTP
[INFO] Activation NTP
[CMD] Ex√©cution: timedatectl set-ntp true
[SUCCESS] Commande r√©ussie (code: 0)
  ‚Ü¶ Attente de la synchronisation NTP...
[INFO] Attente synchronisation NTP - 15s
  ‚Ü¶ Date/Heure: 16/06/2025 13:19:30
[INFO] Heure synchronis√©e: Mon 16 Jun 13:19:30 CEST 2025
[INFO] Progression: 40% - Horloge synchronis√©e

========================================================================
√âTAPE 4 : MISE √Ä JOUR DE S√âCURIT√â
========================================================================

[INFO] Progression: 45% - Pr√©paration des mises √† jour...
‚ó¶ Nettoyage s√©curis√© du syst√®me de paquets...
[INFO] D√©but du nettoyage APT s√©curis√©
‚ó¶ V√©rification de l'√©tat d'APT...
[INFO] V√©rification de l'√©tat d'APT
  ‚Ü¶ APT est libre ‚úì
[INFO] APT libre imm√©diatement
  ‚Ü¶ Nettoyage des processus zombies...
[INFO] Nettoyage des processus zombies
  ‚Ü¶ V√©rification des verrous orphelins...
[INFO] V√©rification des verrous orphelins
    ‚Ä¢ Suppression du verrou orphelin: /var/lib/dpkg/lock
[INFO] Suppression verrou orphelin: /var/lib/dpkg/lock
    ‚Ä¢ Suppression du verrou orphelin: /var/lib/dpkg/lock-frontend
[INFO] Suppression verrou orphelin: /var/lib/dpkg/lock-frontend
    ‚Ä¢ Suppression du verrou orphelin: /var/lib/apt/lists/lock
[INFO] Suppression verrou orphelin: /var/lib/apt/lists/lock
    ‚Ä¢ Suppression du verrou orphelin: /var/cache/apt/archives/lock
[INFO] Suppression verrou orphelin: /var/cache/apt/archives/lock
  ‚Ü¶ Reconfiguration de dpkg...
[INFO] Configuration dpkg
[CMD] Ex√©cution: dpkg --configure -a
[SUCCESS] Commande r√©ussie (code: 0)
  ‚Ü¶ Syst√®me de paquets nettoy√© ‚úì
[SUCCESS] Nettoyage APT termin√©
  ‚Ü¶ Stabilisation apr√®s nettoyage (3s)...
[INFO] Stabilisation apr√®s nettoyage - attente 3s
‚ó¶ Mise √† jour de la liste des paquets...
[INFO] D√©but de la mise √† jour APT
  ‚Ü¶ Tentative 1/3...
[INFO] Tentative APT update 1/3
Hit:1 http://deb.debian.org/debian bookworm InRelease
Hit:2 http://archive.raspberrypi.com/debian bookworm InRelease
Hit:3 http://deb.debian.org/debian-security bookworm-security InRelease
Hit:4 http://deb.debian.org/debian bookworm-updates InRelease
Reading package lists...
  ‚Ü¶ Liste des paquets mise √† jour ‚úì
[SUCCESS] APT update r√©ussi
[INFO] Progression: 55% - Installation des mises √† jour critiques...

‚ó¶ Installation des mises √† jour de s√©curit√© critiques...
[INFO] Installation des paquets critiques uniquement
[INFO] Mise √† jour s√©curit√©
[CMD] Ex√©cution: DEBIAN_FRONTEND=noninteractive apt-get install -y --only-upgrade --allow-unauthenticated openssl libssl* sudo systemd apt dpkg libc6 libpam* ca-certificates tzdata
[OUT] Reading package lists...
[OUT] Building dependency tree...
[OUT] Reading state information...
[OUT] openssl is already the newest version (3.0.16-1~deb12u1+rpt1).
[OUT] libssl3 is already the newest version (3.0.16-1~deb12u1+rpt1).
[OUT] Skipping libssl-dev, it is not installed and only upgrades are requested.
[OUT] Skipping libssl-ocaml, it is not installed and only upgrades are requested.
[OUT] Skipping libssl-ocaml-dev, it is not installed and only upgrades are requested.
[OUT] Skipping libssl-doc, it is not installed and only upgrades are requested.
[OUT] Skipping libssl-utils-clojure, it is not installed and only upgrades are requested.
[OUT] Skipping libssl-ocaml:armhf, it is not installed and only upgrades are requested.
[OUT] Skipping libssl-ocaml-dev:armhf, it is not installed and only upgrades are requested.
[OUT] Skipping libssl1.1, it is not installed and only upgrades are requested.
[OUT] Skipping libssl1.1-dbgsym, it is not installed and only upgrades are requested.
[OUT] Skipping libssl3-dbgsym, it is not installed and only upgrades are requested.
[OUT] sudo is already the newest version (1.9.13p3-1+deb12u1).
[OUT] apt is already the newest version (2.6.1).
[OUT] dpkg is already the newest version (1.22.6~bpo12+rpt3).
[OUT] libc6 is already the newest version (2.36-9+rpt2+deb12u10).
[OUT] libpam0g is already the newest version (1.5.2-6+rpt2+deb12u1).
[OUT] Skipping libpam-apparmor, it is not installed and only upgrades are requested.
[OUT] libpam-runtime is already the newest version (1.5.2-6+rpt2+deb12u1).
[OUT] libpam-modules is already the newest version (1.5.2-6+rpt2+deb12u1).
[OUT] Skipping libpam-barada, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-sss, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-gnome-keyring, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-tmpdir, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-krb5, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-ccreds, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-mount, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-mklocaluser, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-python, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-duo, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-fprintd, it is not installed and only upgrades are requested.
[OUT] Skipping libpam0g-dev, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-elogind, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-ldapd, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-abl, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-fscrypt, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-pkcs11, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-google-authenticator, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-kwallet-common, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-kwallet5, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-mount-bin, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-cap, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-cgroup, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-afs-session, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-heimdal, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-alreadyloggedin, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-chroot, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-encfs, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-freerdp2, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-freerdp2-dev, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-net, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-pwdfile, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-radius-auth, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-script, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-ufpidentity, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-x2go, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-x2go-dev, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-pwquality, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-cgfs, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-malcontent, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-oath, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-ocaml, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-ocaml-dev, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-otpw, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-doc, it is not installed and only upgrades are requested.
[OUT] libpam-modules-bin is already the newest version (1.5.2-6+rpt2+deb12u1).
[OUT] Skipping libpam-geoip, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-krb5-migrate-heimdal, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-krb5-migrate-mit, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-mysql, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-p11, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-python-doc, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-shield, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-ssh-agent-auth, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-u2f, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-wrapper, it is not installed and only upgrades are requested.
[OUT] Skipping libpamtest0, it is not installed and only upgrades are requested.
[OUT] Skipping libpamtest0-dev, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-passwdqc, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-poldi, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-winbind, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-shishi, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-slurm, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-slurm-adopt, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-snapper, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-biometric, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-yubico, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-ocaml:armhf, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-ocaml-dev:armhf, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-zfs, it is not installed and only upgrades are requested.
[OUT] libpam-chksshpwd is already the newest version (1.5.2-6+rpt2+deb12u1).
[OUT] Skipping libpam-chksshpwd-dbgsym, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-cracklib, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-cracklib-dbgsym, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-modules-bin-dbgsym, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-modules-dbgsym, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-zfs-dbgsym, it is not installed and only upgrades are requested.
[OUT] Skipping libpam0g-dbgsym, it is not installed and only upgrades are requested.
[OUT] tzdata is already the newest version (2025b-0+deb12u1).
[OUT] The following additional packages will be installed:
[OUT]   libsystemd-shared libsystemd0 libudev1 systemd-sysv systemd-timesyncd udev
[OUT] Suggested packages:
[OUT]   systemd-container systemd-homed systemd-userdbd systemd-boot
[OUT]   systemd-resolved libtss2-esys-3.0.2-0 libtss2-mu0 libtss2-rc0
[OUT] Recommended packages:
[OUT]   libnss-systemd
[OUT] The following packages will be upgraded:
[OUT]   ca-certificates libpam-systemd libsystemd-shared libsystemd0 libudev1
[OUT]   systemd systemd-sysv systemd-timesyncd udev
[OUT] 9 upgraded, 0 newly installed, 0 to remove and 101 not upgraded.
[OUT] Need to get 6,868 kB of archives.
[OUT] After this operation, 205 kB of additional disk space will be used.
[OUT] Get:1 http://deb.debian.org/debian-security bookworm-security/main arm64 systemd-timesyncd arm64 252.38-1~deb12u1 [61.8 kB]
[OUT] Get:2 http://deb.debian.org/debian-security bookworm-security/main arm64 libpam-systemd arm64 252.38-1~deb12u1 [209 kB]
[OUT] Get:3 http://deb.debian.org/debian-security bookworm-security/main arm64 systemd arm64 252.38-1~deb12u1 [2,839 kB]
[OUT] Get:4 http://deb.debian.org/debian-security bookworm-security/main arm64 libsystemd-shared arm64 252.38-1~deb12u1 [1,507 kB]
[OUT] Get:5 http://deb.debian.org/debian-security bookworm-security/main arm64 systemd-sysv arm64 252.38-1~deb12u1 [42.6 kB]
[OUT] Get:6 http://deb.debian.org/debian-security bookworm-security/main arm64 libsystemd0 arm64 252.38-1~deb12u1 [308 kB]
[OUT] Get:7 http://deb.debian.org/debian-security bookworm-security/main arm64 udev arm64 252.38-1~deb12u1 [1,641 kB]
[OUT] Get:8 http://deb.debian.org/debian-security bookworm-security/main arm64 libudev1 arm64 252.38-1~deb12u1 [103 kB]
[OUT] Get:9 http://deb.debian.org/debian bookworm-updates/main arm64 ca-certificates all 20230311+deb12u1 [155 kB]
[OUT] apt-listchanges: Reading changelogs...
[OUT] Preconfiguring packages ...
[OUT] Fetched 6,868 kB in 4s (1,936 kB/s)
[OUT] (Reading database ... 
(Reading database ... 5%
(Reading database ... 10%
(Reading database ... 15%
(Reading database ... 20%
(Reading database ... 25%
(Reading database ... 30%
(Reading database ... 35%
(Reading database ... 40%
(Reading database ... 45%
(Reading database ... 50%
(Reading database ... 55%
(Reading database ... 60%
(Reading database ... 65%
(Reading database ... 70%
(Reading database ... 75%
(Reading database ... 80%
(Reading database ... 85%
(Reading database ... 90%
(Reading database ... 95%
(Reading database ... 100%
(Reading database ... 129085 files and directories currently installed.)
[OUT] Preparing to unpack .../systemd-timesyncd_252.38-1~deb12u1_arm64.deb ...
[OUT] Unpacking systemd-timesyncd (252.38-1~deb12u1) over (252.36-1~deb12u1) ...
[OUT] Preparing to unpack .../libpam-systemd_252.38-1~deb12u1_arm64.deb ...
[OUT] Unpacking libpam-systemd:arm64 (252.38-1~deb12u1) over (252.36-1~deb12u1) ...
[OUT] Preparing to unpack .../systemd_252.38-1~deb12u1_arm64.deb ...
[OUT] Unpacking systemd (252.38-1~deb12u1) over (252.36-1~deb12u1) ...
[OUT] Preparing to unpack .../libsystemd-shared_252.38-1~deb12u1_arm64.deb ...
[OUT] Unpacking libsystemd-shared:arm64 (252.38-1~deb12u1) over (252.36-1~deb12u1) ...
[OUT] Preparing to unpack .../libsystemd0_252.38-1~deb12u1_arm64.deb ...
[OUT] Unpacking libsystemd0:arm64 (252.38-1~deb12u1) over (252.36-1~deb12u1) ...
[OUT] Setting up libsystemd0:arm64 (252.38-1~deb12u1) ...
[OUT] Setting up libsystemd-shared:arm64 (252.38-1~deb12u1) ...
[OUT] Setting up systemd (252.38-1~deb12u1) ...
[OUT] (Reading database ... 
(Reading database ... 5%
(Reading database ... 10%
(Reading database ... 15%
(Reading database ... 20%
(Reading database ... 25%
(Reading database ... 30%
(Reading database ... 35%
(Reading database ... 40%
(Reading database ... 45%
(Reading database ... 50%
(Reading database ... 55%
(Reading database ... 60%
(Reading database ... 65%
(Reading database ... 70%
(Reading database ... 75%
(Reading database ... 80%
(Reading database ... 85%
(Reading database ... 90%
(Reading database ... 95%
(Reading database ... 100%
(Reading database ... 129086 files and directories currently installed.)
[OUT] Preparing to unpack .../systemd-sysv_252.38-1~deb12u1_arm64.deb ...
[OUT] Unpacking systemd-sysv (252.38-1~deb12u1) over (252.36-1~deb12u1) ...
[OUT] Preparing to unpack .../udev_252.38-1~deb12u1_arm64.deb ...
[OUT] Unpacking udev (252.38-1~deb12u1) over (252.36-1~deb12u1) ...
[OUT] Preparing to unpack .../libudev1_252.38-1~deb12u1_arm64.deb ...
[OUT] Unpacking libudev1:arm64 (252.38-1~deb12u1) over (252.36-1~deb12u1) ...
[OUT] Setting up libudev1:arm64 (252.38-1~deb12u1) ...
[OUT] (Reading database ... 
(Reading database ... 5%
(Reading database ... 10%
(Reading database ... 15%
(Reading database ... 20%
(Reading database ... 25%
(Reading database ... 30%
(Reading database ... 35%
(Reading database ... 40%
(Reading database ... 45%
(Reading database ... 50%
(Reading database ... 55%
(Reading database ... 60%
(Reading database ... 65%
(Reading database ... 70%
(Reading database ... 75%
(Reading database ... 80%
(Reading database ... 85%
(Reading database ... 90%
(Reading database ... 95%
(Reading database ... 100%
(Reading database ... 129086 files and directories currently installed.)
[OUT] Preparing to unpack .../ca-certificates_20230311+deb12u1_all.deb ...
[OUT] Unpacking ca-certificates (20230311+deb12u1) over (20230311) ...
[OUT] Setting up systemd-sysv (252.38-1~deb12u1) ...
[OUT] Setting up ca-certificates (20230311+deb12u1) ...
[OUT] Updating certificates in /etc/ssl/certs...
[OUT] rehash: warning: skipping ca-certificates.crt,it does not contain exactly one certificate or CRL
[OUT] 2 added, 0 removed; done.
[OUT] Setting up systemd-timesyncd (252.38-1~deb12u1) ...
[OUT] Setting up udev (252.38-1~deb12u1) ...
[OUT] Setting up libpam-systemd:arm64 (252.38-1~deb12u1) ...
[OUT] Processing triggers for libc-bin (2.36-9+rpt2+deb12u10) ...
[OUT] Processing triggers for man-db (2.11.2-2) ...
[OUT] Processing triggers for dbus (1.14.10-1~deb12u1) ...
[OUT] Processing triggers for initramfs-tools (0.142+rpt3+deb12u3) ...
[OUT] update-initramfs: Generating /boot/initrd.img-6.12.25+rpt-rpi-v8
[OUT] '/boot/initrd.img-6.12.25+rpt-rpi-v8' -> '/boot/firmware/initramfs8'
[OUT] update-initramfs: Generating /boot/initrd.img-6.12.25+rpt-rpi-2712
[OUT] '/boot/initrd.img-6.12.25+rpt-rpi-2712' -> '/boot/firmware/initramfs_2712'
[OUT] Processing triggers for ca-certificates (20230311+deb12u1) ...
[OUT] Updating certificates in /etc/ssl/certs...
[OUT] 0 added, 0 removed; done.
[OUT] Running hooks in /etc/ca-certificates/update.d...
[OUT] done.
[SUCCESS] Commande r√©ussie (code: 0)
  ‚Ü¶ Mises √† jour de s√©curit√© install√©es ‚úì
[SUCCESS] Mises √† jour de s√©curit√© install√©es
  ‚Ü¶ Stabilisation apr√®s mises √† jour (5s)...
[INFO] Stabilisation apr√®s mises √† jour - attente 5s
[INFO] Progression: 65% - Cr√©ation du cache de paquets...

========================================================================
√âTAPE 5 : CR√âATION DU CACHE DE PAQUETS
========================================================================

‚ó¶ Initialisation du syst√®me de cache...
[INFO] Initialisation du cache de paquets
[INFO] Initialisation du cache des paquets
[SUCCESS] Cache initialis√©: /var/cache/maxlink/packages
  ‚Ü¶ Cache initialis√© ‚úì
[SUCCESS] Cache initialis√© avec succ√®s
  ‚Ü¶ Pr√©paration du t√©l√©chargement (3s)...
[INFO] Pr√©paration du t√©l√©chargement - attente 3s

‚ó¶ T√©l√©chargement de tous les paquets MaxLink...
  ‚Ü¶ Cette op√©ration peut prendre quelques minutes...
[INFO] T√©l√©chargement de tous les paquets requis
[INFO] Mise √† jour des listes de paquets APT
‚ó¶ T√©l√©chargement [1/24]: git
[INFO] T√©l√©chargement du paquet: git
  ‚Ü¶ git t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: git
‚ó¶ T√©l√©chargement [2/24]: curl
[INFO] T√©l√©chargement du paquet: curl
  ‚Ü¶ curl t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: curl
‚ó¶ T√©l√©chargement [3/24]: wget
[INFO] T√©l√©chargement du paquet: wget
  ‚Ü¶ wget t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: wget
‚ó¶ T√©l√©chargement [4/24]: ca-certificates
[INFO] T√©l√©chargement du paquet: ca-certificates
  ‚Ü¶ ca-certificates t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: ca-certificates
‚ó¶ T√©l√©chargement [5/24]: apt-transport-https
[INFO] T√©l√©chargement du paquet: apt-transport-https
  ‚Ü¶ apt-transport-https t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: apt-transport-https
‚ó¶ T√©l√©chargement [6/24]: gnupg
[INFO] T√©l√©chargement du paquet: gnupg
  ‚Ü¶ gnupg t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: gnupg
‚ó¶ T√©l√©chargement [7/24]: lsb-release
[INFO] T√©l√©chargement du paquet: lsb-release
  ‚Ü¶ lsb-release t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: lsb-release
‚ó¶ T√©l√©chargement [8/24]: nginx
[INFO] T√©l√©chargement du paquet: nginx
  ‚Ü¶ nginx t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: nginx
‚ó¶ T√©l√©chargement [9/24]: nginx-common
[INFO] T√©l√©chargement du paquet: nginx-common
  ‚Ü¶ nginx-common t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: nginx-common
‚ó¶ T√©l√©chargement [10/24]: mosquitto
[INFO] T√©l√©chargement du paquet: mosquitto
  ‚Ü¶ mosquitto t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: mosquitto
‚ó¶ T√©l√©chargement [11/24]: mosquitto-clients
[INFO] T√©l√©chargement du paquet: mosquitto-clients
  ‚Ü¶ mosquitto-clients t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: mosquitto-clients
‚ó¶ T√©l√©chargement [12/24]: libmosquitto1
[INFO] T√©l√©chargement du paquet: libmosquitto1
  ‚Ü¶ libmosquitto1 t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: libmosquitto1
‚ó¶ T√©l√©chargement [13/24]: libdlt2
[INFO] T√©l√©chargement du paquet: libdlt2
  ‚Ü¶ libdlt2 t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: libdlt2
‚ó¶ T√©l√©chargement [14/24]: dnsmasq
[INFO] T√©l√©chargement du paquet: dnsmasq
  ‚Ü¶ dnsmasq t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: dnsmasq
‚ó¶ T√©l√©chargement [15/24]: iptables
[INFO] T√©l√©chargement du paquet: iptables
  ‚Ü¶ iptables t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: iptables
‚ó¶ T√©l√©chargement [16/24]: python3-psutil
[INFO] T√©l√©chargement du paquet: python3-psutil
  ‚Ü¶ python3-psutil t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: python3-psutil
‚ó¶ T√©l√©chargement [17/24]: python3-paho-mqtt
[INFO] T√©l√©chargement du paquet: python3-paho-mqtt
  ‚Ü¶ python3-paho-mqtt t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: python3-paho-mqtt
‚ó¶ T√©l√©chargement [18/24]: python3-pip
[INFO] T√©l√©chargement du paquet: python3-pip
  ‚Ü¶ python3-pip t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: python3-pip
‚ó¶ T√©l√©chargement [19/24]: python3-setuptools
[INFO] T√©l√©chargement du paquet: python3-setuptools
  ‚Ü¶ python3-setuptools t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: python3-setuptools
‚ó¶ T√©l√©chargement [20/24]: htop
[INFO] T√©l√©chargement du paquet: htop
  ‚Ü¶ htop t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: htop
‚ó¶ T√©l√©chargement [21/24]: iotop
[INFO] T√©l√©chargement du paquet: iotop
  ‚Ü¶ iotop t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: iotop
‚ó¶ T√©l√©chargement [22/24]: net-tools
[INFO] T√©l√©chargement du paquet: net-tools
  ‚Ü¶ net-tools t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: net-tools
‚ó¶ T√©l√©chargement [23/24]: dnsutils
[INFO] T√©l√©chargement du paquet: dnsutils
  ‚Ü¶ dnsutils t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: dnsutils
‚ó¶ T√©l√©chargement [24/24]: python3-pil
[INFO] T√©l√©chargement du paquet: python3-pil
  ‚Ü¶ python3-pil t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: python3-pil

‚ó¶ T√©l√©chargement termin√©
  ‚Ü¶ Paquets t√©l√©charg√©s: 656
[INFO] Total paquets t√©l√©charg√©s: 656

  ‚Ü¶ Cache de paquets cr√©√© avec succ√®s ‚úì
[SUCCESS] Tous les paquets ont √©t√© t√©l√©charg√©s
=== Statistiques du cache ===
Emplacement : /var/cache/maxlink/packages
Taille      : 342M
Paquets     : 656
√Çge         : 0 jours
==========================

‚ó¶ T√©l√©chargement du dashboard MaxLink V3...
  ‚Ü¶ T√©l√©chargement depuis GitHub...
[INFO] T√©l√©chargement du dashboard V3 depuis GitHub
[INFO] T√©l√©chargement dashboard (curl)
[CMD] Ex√©cution: curl -L -o '/var/cache/maxlink/dashboard/dashboard.tar.gz' 'https://github.com/B4ckZ/DashboardV3/archive/refs/heads/main.tar.gz'
[OUT]   % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
[OUT]                                  Dload  Upload   Total   Spent    Left  Speed
[OUT] 
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
[OUT] 
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
100  126k    0  126k    0     0   119k      0 --:--:--  0:00:01 --:--:--  373k
[SUCCESS] Commande r√©ussie (code: 0)
  ‚Ü¶ Dashboard t√©l√©charg√© ‚úì
[SUCCESS] Dashboard t√©l√©charg√© avec curl
  ‚Ü¶ Archive dashboard valide ‚úì
[SUCCESS] Archive dashboard valide

‚ó¶ Nettoyage du syst√®me...
[INFO] APT autoremove
[CMD] Ex√©cution: apt-get autoremove -y >/dev/null 2>&1
[SUCCESS] Commande r√©ussie (code: 0)
[INFO] APT autoclean
[CMD] Ex√©cution: apt-get autoclean >/dev/null 2>&1
[SUCCESS] Commande r√©ussie (code: 0)
  ‚Ü¶ Syst√®me nettoy√© ‚úì
[INFO] Progression: 75% - Cache cr√©√©

========================================================================
√âTAPE 6 : CONFIGURATION DU SYST√àME
========================================================================

[INFO] Progression: 80% - Configuration du syst√®me...
‚ó¶ Configuration du ventilateur...
[INFO] Configuration du ventilateur
  ‚Ü¶ Configuration ajout√©e ‚úì
[SUCCESS] Configuration ventilateur ajout√©e

‚ó¶ Personnalisation de l'interface...
[INFO] Installation du fond d'√©cran personnalis√©
  ‚Ü¶ Fond d'√©cran source non trouv√© ‚ö†
[WARN] Fond d'√©cran source non trouv√©: /media/prod/WERIT/assets/bg.jpg/fond_ecran_logo.png
  ‚Ü¶ Bureau configur√© ‚úì
[SUCCESS] Configuration bureau LXDE appliqu√©e
[INFO] Progression: 90% - Configuration termin√©e

========================================================================
√âTAPE 7 : FINALISATION
========================================================================

[INFO] Progression: 95% - Finalisation...
‚ó¶ R√©activation des mises √† jour automatiques...
  ‚Ü¶ Services de mise √† jour r√©activ√©s ‚úì
[INFO] Services de mise √† jour r√©activ√©s

‚ó¶ Restauration de l'√©tat r√©seau...
[INFO] Restauration de l'√©tat r√©seau
[INFO] D√©connexion du WiFi Max
  ‚Ü¶ √âtat r√©seau restaur√© ‚úì

‚ó¶ Mise √† jour du statut du service...
  ‚Ü¶ Statut du service mis √† jour ‚úì
[INFO] Statut du service update mis √† jour: active
[INFO] Progression: 100% - Mise √† jour termin√©e !

‚ó¶ Mise √† jour termin√©e avec succ√®s !
  ‚Ü¶ Version: v3
  ‚Ü¶ Syst√®me √† jour et configur√©
  ‚Ü¶ Cache de paquets cr√©√© pour installation offline
  ‚Ü¶ Dashboard V3 t√©l√©charg√©
[SUCCESS] Mise √† jour syst√®me termin√©e - Version: v3

‚ó¶ R√©sum√© du cache cr√©√© :
=== Statistiques du cache ===
Emplacement : /var/cache/maxlink/packages
Taille      : 342M
Paquets     : 656
√Çge         : 0 jours
==========================

  ‚Ü¶ Red√©marrage diff√©r√© (installation compl√®te en cours)

[INFO] Red√©marrage diff√©r√© - SKIP_REBOOT=true

[SUCCESS] update_install.sh install√© avec succ√®s

  ‚Ü¶ Pause avant l'√©tape suivante... 10 9 8 7 6 5 4 3 2 1 ‚úì

========================================================================
√âTAPE 2/6 : Point d'acc√®s WiFi
========================================================================

‚ó¶ Ex√©cution de ap_install.sh...

[INFO] Ex√©cution de ap_install.sh
[INFO] Initialisation du logging pour ap_install
[INFO] Installation du mode Access Point
[INFO] ========== D√âBUT DE L'INSTALLATION AP ==========
========================================================================
√âTAPE 1 : V√âRIFICATIONS
========================================================================

[INFO] Progression: 10% - V√©rifications initiales
[INFO] Privil√®ges root confirm√©s
‚ó¶ V√©rification de l'interface WiFi...
  ‚Ü¶ Interface wlan0 disponible ‚úì
[INFO] Interface wlan0 disponible

‚ó¶ V√©rification de NetworkManager...
  ‚Ü¶ NetworkManager actif ‚úì
[INFO] NetworkManager actif

========================================================================
√âTAPE 2 : INSTALLATION DES PAQUETS
========================================================================

[INFO] Progression: 25% - Installation des paquets
‚ó¶ Installation de Point d'acc√®s...
[INFO] Installation hybride de Point d'acc√®s
  ‚Ü¶ D√©j√† install√© ‚úì
[INFO] Point d'acc√®s d√©j√† install√©

[SUCCESS] Tous les paquets AP install√©s

========================================================================
√âTAPE 3 : PR√âPARATION DU SYST√àME
========================================================================

[INFO] Progression: 35% - Pr√©paration du syst√®me
‚ó¶ Configuration du resolv.conf...
[INFO] Configuration du resolv.conf
[INFO] Protection du resolv.conf
[CMD] Ex√©cution: chattr +i /etc/resolv.conf 2>/dev/null || true
[SUCCESS] Commande r√©ussie (code: 0)
  ‚Ü¶ resolv.conf configur√© et prot√©g√© ‚úì
[INFO] resolv.conf configur√© avec succ√®s

‚ó¶ Nettoyage des services DNS conflictuels...
[INFO] D√©sactivation des services DNS conflictuels

‚ó¶ D√©sactivation des connexions WiFi existantes...
[INFO] Nettoyage des connexions WiFi existantes
[INFO] D√©connexion interface
[CMD] Ex√©cution: nmcli device disconnect wlan0 2>/dev/null || true
[SUCCESS] Commande r√©ussie (code: 0)
[INFO] Suppression ancienne config AP
[CMD] Ex√©cution: nmcli connection delete 'MaxLink-NETWORK' 2>/dev/null || true
[SUCCESS] Commande r√©ussie (code: 0)
  ‚Ü¶ Connexions nettoy√©es ‚úì

‚ó¶ Configuration de NetworkManager...
[INFO] Configuration de NetworkManager pour dnsmasq
[INFO] Sauvegarde config NetworkManager
[CMD] Ex√©cution: cp /etc/NetworkManager/NetworkManager.conf /etc/NetworkManager/NetworkManager.conf.original
[SUCCESS] Commande r√©ussie (code: 0)
  ‚Ü¶ NetworkManager configur√© pour dnsmasq ‚úì
[INFO] NetworkManager configur√© avec succ√®s

========================================================================
√âTAPE 4 : CONFIGURATION DU POINT D'ACC√àS
========================================================================

[INFO] Progression: 50% - Configuration du point d'acc√®s
‚ó¶ Cr√©ation du profil Access Point...
  ‚Ü¶ SSID: MaxLink-NETWORK
  ‚Ü¶ IP: 192.168.4.1/24
  ‚Ü¶ Canal: 6 (2.4GHz)
[INFO] Configuration AP - SSID: MaxLink-NETWORK, IP: 192.168.4.1/24, Canal: 6
[INFO] Cr√©ation profil AP
[CMD] Ex√©cution: nmcli connection add     type wifi     ifname wlan0     con-name 'MaxLink-NETWORK'     autoconnect yes     ssid 'MaxLink-NETWORK'     mode ap     802-11-wireless.band bg     802-11-wireless.channel 6     802-11-wireless-security.key-mgmt wpa-psk 	802-11-wireless-security.proto rsn 	802-11-wireless-security.pairwise ccmp 	802-11-wireless-security.group ccmp     802-11-wireless-security.psk 'MDPsupersecret007'     ipv4.method shared     ipv4.addresses '192.168.4.1/24'     ipv6.method disabled
[OUT] Connection 'MaxLink-NETWORK' (eac7935b-be76-4fb2-a7d7-76093c879203) successfully added.
[SUCCESS] Commande r√©ussie (code: 0)
  ‚Ü¶ Profil AP cr√©√© ‚úì
[SUCCESS] Profil AP cr√©√© avec succ√®s

‚ó¶ Configuration DHCP et DNS...
[INFO] Configuration DHCP/DNS pour l'AP
  ‚Ü¶ Configuration DHCP/DNS cr√©√©e ‚úì
[INFO] Configuration dnsmasq cr√©√©e dans /etc/NetworkManager/dnsmasq-shared.d/
  ‚Ü¶ Configuration DNS suppl√©mentaire ajout√©e ‚úì
[INFO] Configuration DNS suppl√©mentaire cr√©√©e

========================================================================
√âTAPE 5 : CONFIGURATION DU PARE-FEU
========================================================================

[INFO] Progression: 70% - Configuration du pare-feu
‚ó¶ Configuration des r√®gles de pare-feu...
[INFO] Configuration des r√®gles iptables

========================================================================
√âTAPE 6 : ACTIVATION DU POINT D'ACC√àS
========================================================================

[INFO] Progression: 85% - Activation du point d'acc√®s
‚ó¶ D√©marrage du point d'acc√®s...
[INFO] Activation du point d'acc√®s
[INFO] Red√©marrage NetworkManager
[CMD] Ex√©cution: systemctl restart NetworkManager
[SUCCESS] Commande r√©ussie (code: 0)
[INFO] Activation connexion AP
[CMD] Ex√©cution: nmcli connection up 'MaxLink-NETWORK'
[OUT] Connection successfully activated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/3)
[SUCCESS] Commande r√©ussie (code: 0)
  ‚Ü¶ Point d'acc√®s activ√© ‚úì
[SUCCESS] Point d'acc√®s activ√© avec succ√®s

‚ó¶ V√©rification de l'√©tat...
[INFO] V√©rification de l'√©tat du point d'acc√®s
  ‚Ü¶ Point d'acc√®s op√©rationnel ‚úì
[SUCCESS] Point d'acc√®s op√©rationnel
  ‚Ü¶ Service DNS actif ‚úì
[INFO] Service dnsmasq actif

========================================================================
√âTAPE 7 : FINALISATION
========================================================================

[INFO] Progression: 95% - Finalisation
‚ó¶ Configuration de d√©marrage automatique...
  ‚Ü¶ Le point d'acc√®s d√©marrera automatiquement ‚úì
[INFO] Configuration de d√©marrage automatique activ√©e

‚ó¶ Mise √† jour du statut du service...
  ‚Ü¶ Statut du service mis √† jour ‚úì
[INFO] Statut du service ap mis √† jour: active

‚ó¶ Informations de connexion :
  ‚Ü¶ Nom du r√©seau : MaxLink-NETWORK
  ‚Ü¶ Mot de passe  : MDPsupersecret007
  ‚Ü¶ Adresse IP    : 192.168.4.1
  ‚Ü¶ Plage DHCP    : 192.168.4.10 - 192.168.4.100

‚ó¶ Acc√®s au dashboard :
  ‚Ü¶ http://192.168.4.1
  ‚Ü¶ http://maxlink.local
  ‚Ü¶ http://dashboard.local
[INFO] Configuration finale:
[INFO]   - SSID: MaxLink-NETWORK
[INFO]   - IP: 192.168.4.1
[INFO]   - DHCP: 192.168.4.10 - 192.168.4.100
[INFO] Progression: 100% - Installation termin√©e

‚ó¶ Installation termin√©e avec succ√®s !

‚ó¶ IMPORTANT : L'orchestrateur doit √™tre install√© pour g√©rer le d√©marrage ordonn√©

‚ó¶ Test rapide de la r√©solution DNS...
  ‚Ü¶ DNS non fonctionnel - Un red√©marrage peut √™tre n√©cessaire ‚ö†
[WARN] Test DNS final √©chou√© - red√©marrage recommand√©

  ‚Ü¶ Red√©marrage diff√©r√© (installation compl√®te en cours)

[INFO] Red√©marrage diff√©r√© - SKIP_REBOOT=true

[SUCCESS] ap_install.sh install√© avec succ√®s

  ‚Ü¶ Pause avant l'√©tape suivante... 10 9 8 7 6 5 4 3 2 1 ‚úì

========================================================================
√âTAPE 3/6 : Serveur Web et Dashboard
========================================================================

‚ó¶ Ex√©cution de nginx_install.sh...

[INFO] Ex√©cution de nginx_install.sh
[INFO] Initialisation du logging pour nginx_install
[INFO] Installation Nginx et Dashboard (Mode Offline)
[INFO] ========== D√âBUT DE L'INSTALLATION NGINX ET DASHBOARD (OFFLINE) ==========
========================================================================
√âTAPE 1 : V√âRIFICATIONS
========================================================================

[INFO] Progression: 5% - V√©rifications initiales...
[INFO] Privil√®ges root confirm√©s
  ‚Ü¶ Privil√®ges root confirm√©s ‚úì

‚ó¶ V√©rification du cache local...
[INFO] V√©rification du cache dashboard
  ‚Ü¶ Dashboard trouv√© dans le cache ‚úì
[INFO] Dashboard valide trouv√© dans le cache
[INFO] Progression: 10% - V√©rifications termin√©es

========================================================================
√âTAPE 2 : INSTALLATION DE NGINX
========================================================================

[INFO] Progression: 20% - Installation de Nginx...
‚ó¶ Installation de Nginx depuis le cache...
[INFO] Installation de Nginx depuis le cache local
[INFO] Installation des paquets de la cat√©gorie: nginx
  ‚Ü¶ Installation de nginx...
[INFO] Installation du paquet depuis le cache: nginx
[SUCCESS] Paquet install√© depuis le cache: nginx
    ‚úì nginx install√©
  ‚Ü¶ Installation de nginx-common...
[INFO] Installation du paquet depuis le cache: nginx-common
[SUCCESS] Paquet install√© depuis le cache: nginx-common
    ‚úì nginx-common install√©
  ‚Ü¶ Nginx install√© depuis le cache ‚úì
[SUCCESS] Nginx install√© avec succ√®s depuis le cache

‚ó¶ Pr√©paration de Nginx...
[INFO] Arr√™t Nginx
[CMD] Ex√©cution: systemctl stop nginx >/dev/null 2>&1
[SUCCESS] Commande r√©ussie (code: 0)
  ‚Ü¶ Service Nginx arr√™t√© ‚úì
[INFO] Progression: 35% - Nginx install√©

========================================================================
√âTAPE 3 : INSTALLATION DU DASHBOARD
========================================================================

[INFO] Progression: 40% - Installation du dashboard...

‚ó¶ Extraction du dashboard depuis le cache...
[INFO] R√©pertoire temporaire: /tmp/maxlink-dashboard-1750073101
  ‚Ü¶ Extraction de l'archive...
[INFO] Extraction archive
[CMD] Ex√©cution: tar -xzf '/var/cache/maxlink/dashboard/dashboard.tar.gz' -C '/tmp/maxlink-dashboard-1750073101'
[SUCCESS] Commande r√©ussie (code: 0)
  ‚Ü¶ Archive extraite ‚úì
[SUCCESS] Archive extraite avec succ√®s
[INFO] Dossier racine de l'archive: /tmp/maxlink-dashboard-1750073101/DashboardV3-main
[INFO] Recherche du dashboard dans: /tmp/maxlink-dashboard-1750073101/DashboardV3-main
  ‚Ü¶ Dossier dashboard trouv√© ‚úì
[INFO] Dossier dashboard trouv√©: /tmp/maxlink-dashboard-1750073101/DashboardV3-main
  ‚Ü¶ Cr√©ation du r√©pertoire destination...
[INFO] R√©pertoire destination cr√©√©: /var/www/dashboard
[INFO] Copie dashboard
[CMD] Ex√©cution: cp -r '/tmp/maxlink-dashboard-1750073101/DashboardV3-main'/* '/var/www/dashboard'/
[SUCCESS] Commande r√©ussie (code: 0)
  ‚Ü¶ Dashboard install√© ‚úì
[SUCCESS] Dashboard install√© avec succ√®s
[INFO] Nettoyage du r√©pertoire temporaire

‚ó¶ Configuration des permissions...
[INFO] Application propri√©taire
[CMD] Ex√©cution: chown -R www-data:www-data '/var/www/dashboard'
[SUCCESS] Commande r√©ussie (code: 0)
[INFO] Permissions standard
[CMD] Ex√©cution: chmod -R 755 '/var/www/dashboard'
[SUCCESS] Commande r√©ussie (code: 0)
  ‚Ü¶ Permissions configur√©es ‚úì
[INFO] Permissions appliqu√©es au dashboard
[INFO] Progression: 60% - Dashboard install√©

========================================================================
√âTAPE 4 : CONFIGURATION DE NGINX
========================================================================

[INFO] Progression: 70% - Configuration de Nginx...
‚ó¶ Cr√©ation de la configuration du site...
[INFO] Cr√©ation de la configuration Nginx
  ‚Ü¶ Configuration cr√©√©e ‚úì
[SUCCESS] Configuration Nginx cr√©√©e

‚ó¶ Activation du site...
[INFO] Suppression site par d√©faut
[CMD] Ex√©cution: rm -f /etc/nginx/sites-enabled/default 2>/dev/null || true
[SUCCESS] Commande r√©ussie (code: 0)
[INFO] Suppression ancien lien
[CMD] Ex√©cution: rm -f /etc/nginx/sites-enabled/maxlink-dashboard 2>/dev/null || true
[SUCCESS] Commande r√©ussie (code: 0)
[INFO] Cr√©ation lien symbolique
[CMD] Ex√©cution: ln -s /etc/nginx/sites-available/maxlink-dashboard /etc/nginx/sites-enabled/
[SUCCESS] Commande r√©ussie (code: 0)
  ‚Ü¶ Site activ√© ‚úì
[INFO] Site Nginx activ√©
[INFO] Test configuration Nginx
[CMD] Ex√©cution: nginx -t >/dev/null 2>&1
[SUCCESS] Commande r√©ussie (code: 0)
  ‚Ü¶ Configuration valid√©e ‚úì
[SUCCESS] Configuration Nginx valide

‚ó¶ D√©marrage de Nginx...
[INFO] Activation au d√©marrage
[CMD] Ex√©cution: systemctl enable nginx >/dev/null 2>&1
[SUCCESS] Commande r√©ussie (code: 0)
[INFO] D√©marrage Nginx
[CMD] Ex√©cution: systemctl start nginx >/dev/null 2>&1
[SUCCESS] Commande r√©ussie (code: 0)
  ‚Ü¶ Nginx d√©marr√© et activ√© ‚úì
[SUCCESS] Nginx d√©marr√© avec succ√®s
[INFO] Progression: 85% - Nginx configur√©

========================================================================
√âTAPE 5 : CONFIGURATION DNS
========================================================================

[INFO] Progression: 90% - Configuration DNS...
[INFO] V√©rification de la configuration AP existante
‚ó¶ Mode AP d√©tect√©, mise √† jour de la configuration DNS...
[INFO] Mode AP d√©tect√©, mise √† jour DNS n√©cessaire
  ‚Ü¶ Configuration DNS d√©j√† pr√©sente ‚úì
[INFO] Configuration DNS d√©j√† pr√©sente

‚ó¶ Mise √† jour du statut du service...
  ‚Ü¶ Statut du service mis √† jour ‚úì
[INFO] Statut du service nginx mis √† jour: active
[INFO] Progression: 100% - Installation termin√©e !

‚ó¶ Installation termin√©e avec succ√®s !
  ‚Ü¶ Dashboard install√© dans : /var/www/dashboard
  ‚Ü¶ Accessible via :
    ‚Ä¢ http://192.168.4.1
    ‚Ä¢ http://maxlink.local
    ‚Ä¢ http://maxlink-dashboard.local
    ‚Ä¢ http://dashboard.local
[INFO] Installation termin√©e avec succ√®s
[INFO] Dashboard accessible √†: http://192.168.4.1 et http://maxlink.local

  ‚Ü¶ Red√©marrage diff√©r√© (installation compl√®te en cours)

[INFO] Red√©marrage diff√©r√© - SKIP_REBOOT=true

[SUCCESS] nginx_install.sh install√© avec succ√®s

  ‚Ü¶ Pause avant l'√©tape suivante... 10 9 8 7 6 5 4 3 2 1 ‚úì

========================================================================
√âTAPE 4/6 : Broker MQTT
========================================================================

‚ó¶ Ex√©cution de mqtt_install.sh...

[INFO] Ex√©cution de mqtt_install.sh
[INFO] Initialisation du logging pour mqtt_install
[INFO] Installation MQTT Broker
[INFO] ========== D√âBUT DE L'INSTALLATION MQTT BROKER ==========

========================================================================
INSTALLATION DU BROKER MQTT (MOSQUITTO)
========================================================================

Configuration : utilisateur 'mosquitto' / mot de passe 'mqtt'

[INFO] Progression: 5% - Initialisation...
[INFO] Privil√®ges root confirm√©s
√âTAPE 1 : PR√âPARATION DU SYST√àME
========================================================================

[INFO] Progression: 10% - Pr√©paration du syst√®me...
‚ó¶ Nettoyage du syst√®me de paquets...
  ‚Ü¶ Syst√®me de paquets pr√™t ‚úì
[INFO] Syst√®me de paquets nettoy√©
[INFO] Progression: 20% - Syst√®me pr√©par√©

========================================================================
√âTAPE 2 : INSTALLATION DES PAQUETS
========================================================================

[INFO] Progression: 30% - Installation de Mosquitto...
‚ó¶ Installation de Mosquitto et d√©pendances...
[INFO] Installation hybride de Mosquitto et d√©pendances
  ‚Ü¶ Recherche dans le cache local...
[INFO] Tentative d'installation depuis le cache
  ‚Ü¶ Install√© depuis le cache ‚úì
[SUCCESS] Mosquitto et d√©pendances install√© depuis le cache

[SUCCESS] Tous les paquets install√©s avec succ√®s
  ‚Ü¶ Mosquitto install√© ‚úì
[INFO] Mosquitto install√© avec succ√®s
[INFO] Progression: 50% - Paquets install√©s

========================================================================
√âTAPE 3 : CONFIGURATION SYST√àME
========================================================================

[INFO] Progression: 60% - Configuration du syst√®me...
‚ó¶ V√©rification de l'utilisateur syst√®me...
  ‚Ü¶ Utilisateur syst√®me existant ‚úì

‚ó¶ Cr√©ation des r√©pertoires...
  ‚Ü¶ R√©pertoires cr√©√©s et permissions appliqu√©es ‚úì
[INFO] R√©pertoires Mosquitto cr√©√©s

‚ó¶ Mise √† jour du cache des biblioth√®ques...
  ‚Ü¶ Cache des biblioth√®ques mis √† jour ‚úì
[INFO] ldconfig ex√©cut√©
[INFO] Progression: 70% - Syst√®me configur√©

========================================================================
√âTAPE 4 : CONFIGURATION DE MOSQUITTO
========================================================================

[INFO] Progression: 75% - Configuration de Mosquitto...
‚ó¶ Cr√©ation de l'utilisateur MQTT...
[INFO] Cr√©ation utilisateur MQTT
[CMD] Ex√©cution: /usr/bin/mosquitto_passwd -b -c '/etc/mosquitto/passwords' 'mosquitto' 'mqtt'
[SUCCESS] Commande r√©ussie (code: 0)
  ‚Ü¶ Utilisateur 'mosquitto' cr√©√© ‚úì
[INFO] Utilisateur MQTT cr√©√©: mosquitto

‚ó¶ Cr√©ation du fichier de configuration avec statistiques...
[INFO] Ancienne configuration sauvegard√©e
  ‚Ü¶ Configuration cr√©√©e avec statistiques activ√©es ‚úì
[SUCCESS] Configuration Mosquitto cr√©√©e avec topics syst√®me

‚ó¶ Configuration des permissions ACL...
  ‚Ü¶ Permissions ACL configur√©es ‚úì
[INFO] Fichier ACL cr√©√©
[INFO] Progression: 85% - Configuration termin√©e

========================================================================
√âTAPE 5 : D√âMARRAGE DU SERVICE
========================================================================

[INFO] Progression: 90% - D√©marrage du service...
‚ó¶ Activation du service au d√©marrage...
[INFO] Activation au d√©marrage
[CMD] Ex√©cution: systemctl enable mosquitto >/dev/null 2>&1
[SUCCESS] Commande r√©ussie (code: 0)
  ‚Ü¶ Service activ√© ‚úì

‚ó¶ D√©marrage de Mosquitto...
[INFO] D√©marrage Mosquitto
[CMD] Ex√©cution: systemctl start mosquitto
[SUCCESS] Commande r√©ussie (code: 0)
  ‚Ü¶ Mosquitto d√©marr√© ‚úì
[SUCCESS] Mosquitto d√©marr√© avec succ√®s
  ‚Ü¶ Service actif et fonctionnel ‚úì
[INFO] Service Mosquitto actif
[INFO] Progression: 95% - Service d√©marr√©

========================================================================
√âTAPE 6 : TESTS DE CONNEXION
========================================================================

[INFO] Progression: 98% - Tests de connexion...
‚ó¶ Test de connexion MQTT (port 1883)...
  ‚Ü¶ Connexion MQTT r√©ussie ‚úì
[SUCCESS] Test de connexion MQTT r√©ussi

‚ó¶ Test du port WebSocket (9001)...
  ‚Ü¶ Port WebSocket non accessible ‚ö†
[WARN] Port WebSocket non accessible imm√©diatement

‚ó¶ Test des topics syst√®me ()...
mosquitto version 2.0.11
  ‚Ü¶ Topics syst√®me accessibles ‚úì
[SUCCESS] Topics syst√®me  accessibles

‚ó¶ Mise √† jour du statut du service...
  ‚Ü¶ Statut du service mis √† jour ‚úì
[INFO] Statut du service mqtt mis √† jour: active
[INFO] Progression: 100% - Installation termin√©e

========================================================================
INSTALLATION TERMIN√âE AVEC SUCC√àS !
========================================================================

‚ó¶ Broker MQTT Mosquitto install√© et configur√©
‚ó¶ Topics syst√®me () activ√©s pour les statistiques

‚ó¶ Informations de connexion :
  ‚Ä¢ Serveur      : localhost (ou IP du Raspberry Pi)
  ‚Ä¢ Port MQTT    : 1883
  ‚Ä¢ Port WebSocket : 9001
  ‚Ä¢ Utilisateur  : mosquitto
  ‚Ä¢ Mot de passe : mqtt

‚ó¶ Commandes utiles :
  ‚Ä¢ √âtat : systemctl status mosquitto
  ‚Ä¢ Logs : journalctl -u mosquitto -f
  ‚Ä¢ Test : mosquitto_sub -h localhost -u mosquitto -P mqtt -t '#' -v

‚ó¶ IMPORTANT : L'orchestrateur doit √™tre install√© pour g√©rer le d√©marrage

[SUCCESS] Installation MQTT Broker termin√©e
[INFO] Configuration: mosquitto/mqtt sur ports 1883 et 9001

  ‚Ü¶ Red√©marrage diff√©r√© (installation compl√®te en cours)

[INFO] Red√©marrage diff√©r√© - SKIP_REBOOT=true

[SUCCESS] mqtt_install.sh install√© avec succ√®s

  ‚Ü¶ Pause avant l'√©tape suivante... 10 9 8 7 6 5 4 3 2 1 ‚úì

========================================================================
√âTAPE 5/6 : Widgets MQTT
========================================================================

‚ó¶ Ex√©cution de mqtt_wgs_install.sh...

[INFO] Ex√©cution de mqtt_wgs_install.sh
[INFO] Initialisation du logging pour mqtt_wgs_install
[INFO] Installation de tous les widgets MQTT
[INFO] ========== D√âBUT DE L'INSTALLATION DES WIDGETS MQTT ==========

========================================================================
INSTALLATION DES WIDGETS MQTT (WGS)
========================================================================

[INFO] Progression: 5% - Initialisation...
‚ó¶ V√©rification du broker MQTT...
  ‚Ü¶ Broker MQTT actif ‚úì
[INFO] Progression: 10% - D√©couverte des widgets...

‚ó¶ Recherche des widgets disponibles...
  ‚Ü¶ 4 widget(s) trouv√©(s) ‚úì

Widgets disponibles :
  ‚Ä¢ mqttstats
  ‚Ä¢ servermonitoring
  ‚Ä¢ uptime
  ‚Ä¢ wifistats
[INFO] Progression: 20% - Installation des d√©pendances...

[INFO] Installation des d√©pendances Python
‚ó¶ V√©rification des paquets Python...
  ‚Ü¶ Installation des paquets manquants...
[INFO] Installation des paquets de la cat√©gorie: python
  ‚Ü¶ Installation de python3-psutil...
[INFO] Installation du paquet depuis le cache: python3-psutil
[SUCCESS] Paquet install√© depuis le cache: python3-psutil
    ‚úì python3-psutil install√©
  ‚Ü¶ Installation de python3-paho-mqtt...
[INFO] Installation du paquet depuis le cache: python3-paho-mqtt
[SUCCESS] Paquet install√© depuis le cache: python3-paho-mqtt
    ‚úì python3-paho-mqtt install√©
  ‚Ü¶ Installation de python3-pip...
[INFO] Installation du paquet depuis le cache: python3-pip
[SUCCESS] Paquet install√© depuis le cache: python3-pip
    ‚úì python3-pip install√©
  ‚Ü¶ Installation de python3-setuptools...
[INFO] Installation du paquet depuis le cache: python3-setuptools
[SUCCESS] Paquet install√© depuis le cache: python3-setuptools
    ‚úì python3-setuptools install√©
  ‚Ü¶ D√©pendances Python install√©es ‚úì
[INFO] Progression: 30% - Installation des widgets...

========================================================================
INSTALLATION DES WIDGETS
========================================================================

Installation du widget: mqttstats
------------------------------------
[SUCCESS] Widget mqttstats valid√©
  ‚Ü¶ Copie du core des widgets...
[INFO] V√©rification des d√©pendances Python pour mqttstats
[INFO] D√©pendances Python v√©rifi√©es (install√©es via le cache)
[INFO] Cr√©ation du service maxlink-widget-mqttstats
[INFO] Copie des fichiers du widget vers /opt/maxlink
[INFO] Service cr√©√© : maxlink-widget-mqttstats.service
[SUCCESS] Service activ√©: maxlink-widget-mqttstats
[SUCCESS] Service d√©marr√©: maxlink-widget-mqttstats
[SUCCESS] Widget mqttstats enregistr√©
  ‚Ü¶ Widget mqttstats install√© ‚úì
  ‚Ü¶ Note : L'orchestrateur g√®re le d√©marrage ordonn√©
[INFO] Progression: 45% - Widget mqttstats trait√©

Installation du widget: servermonitoring
------------------------------------
[SUCCESS] Widget servermonitoring valid√©
[INFO] V√©rification des d√©pendances Python pour servermonitoring
[INFO] D√©pendances Python v√©rifi√©es (install√©es via le cache)
[INFO] Cr√©ation du service maxlink-widget-servermonitoring
[INFO] Copie des fichiers du widget vers /opt/maxlink
[INFO] Service cr√©√© : maxlink-widget-servermonitoring.service
[SUCCESS] Service activ√©: maxlink-widget-servermonitoring
[SUCCESS] Service d√©marr√©: maxlink-widget-servermonitoring
[SUCCESS] Widget servermonitoring enregistr√©
  ‚Ü¶ Widget servermonitoring install√© ‚úì
  ‚Ü¶ Note : L'orchestrateur g√®re le d√©marrage ordonn√©
[INFO] Progression: 60% - Widget servermonitoring trait√©

Installation du widget: uptime
------------------------------------
[SUCCESS] Widget uptime valid√©
[INFO] V√©rification des d√©pendances Python pour uptime
[INFO] Aucune d√©pendance Python pour uptime
  ‚Ü¶ Widget passif (pas de collector)
[SUCCESS] Widget uptime enregistr√©
  ‚Ü¶ Widget uptime install√© ‚úì
[INFO] Progression: 75% - Widget uptime trait√©

Installation du widget: wifistats
------------------------------------
[SUCCESS] Widget wifistats valid√©
[INFO] V√©rification des d√©pendances Python pour wifistats
[INFO] D√©pendances Python v√©rifi√©es (install√©es via le cache)
[INFO] Cr√©ation du service maxlink-widget-wifistats
[INFO] Copie des fichiers du widget vers /opt/maxlink
[INFO] Service cr√©√© : maxlink-widget-wifistats.service
[SUCCESS] Service activ√©: maxlink-widget-wifistats
[SUCCESS] Service d√©marr√©: maxlink-widget-wifistats
[SUCCESS] Widget wifistats enregistr√©
  ‚Ü¶ Widget wifistats install√© ‚úì
  ‚Ü¶ Note : L'orchestrateur g√®re le d√©marrage ordonn√©
[INFO] Progression: 90% - Widget wifistats trait√©
[INFO] Progression: 90% - V√©rification finale...

========================================================================
V√âRIFICATION FINALE
========================================================================

‚ó¶ √âtat des services :
  ‚Ü¶ mqttstats : ‚úì actif
  ‚Ü¶ servermonitoring : ‚úì actif
  ‚Ü¶ uptime : ‚úó inactif
  ‚Ü¶ wifistats : ‚úì actif

‚ó¶ Test de r√©ception MQTT...
  ‚Ü¶ Messages MQTT re√ßus ‚úì

‚ó¶ Mise √† jour du statut du service...
  ‚Ü¶ Statut du service mis √† jour : active ‚úì
[INFO] Statut du service mqtt_wgs mis √† jour: active
[INFO] Progression: 100% - Installation termin√©e

========================================================================
R√âSUM√â
========================================================================

‚ó¶ Widgets trouv√©s    : 4
‚ó¶ Widgets install√©s  : 4
‚ó¶ Widgets √©chou√©s    : 0

‚úì Installation termin√©e avec succ√®s !
[SUCCESS] Tous les widgets install√©s avec succ√®s
Commandes utiles :
  ‚Ä¢ Voir tous les logs    : journalctl -u 'maxlink-widget-*' -f
  ‚Ä¢ Voir tous les topics  : mosquitto_sub -h localhost -u mosquitto -P mqtt -t '#' -v
  ‚Ä¢ √âtat des services     : systemctl status 'maxlink-widget-*'

[INFO] Installation termin√©e - Install√©s: 4/4

  ‚Ü¶ Red√©marrage diff√©r√© (installation compl√®te en cours)

[INFO] Red√©marrage diff√©r√© - SKIP_REBOOT=true

[SUCCESS] mqtt_wgs_install.sh install√© avec succ√®s

  ‚Ü¶ Pause avant l'√©tape suivante... 10 9 8 7 6 5 4 3 2 1 ‚úì

========================================================================
√âTAPE 6/6 : Orchestrateur et finalisation
========================================================================

‚ó¶ Ex√©cution de orchestrator_install.sh...

[INFO] Ex√©cution de orchestrator_install.sh
[INFO] Initialisation du logging pour orchestrator_install
[INFO] Installation de l'orchestrateur MaxLink
[INFO] ========== D√âBUT DE L'INSTALLATION ORCHESTRATEUR ==========

========================================================================
INSTALLATION DE L'ORCHESTRATEUR MAXLINK
========================================================================
[INFO] Privil√®ges root confirm√©s
[INFO] Premi√®re installation d√©tect√©e
[INFO] Progression: 20% - Copie des widgets...

========================================================================
COPIE DES WIDGETS VERS LE SYST√àME
========================================================================

‚ó¶ Copie des widgets vers le syst√®me...
  ‚ö† R√©pertoire widgets source non trouv√© : /media/prod/WERIT/widgets
[WARN] R√©pertoire widgets non trouv√©, installation sans widgets
[INFO] Progression: 40% - Installation des d√©pendances widgets...

========================================================================
INSTALLATION DES D√âPENDANCES WIDGETS
========================================================================
‚ó¶ Installation des modules Python requis...
  ‚Ü¶ V√©rification du module psutil...
    ‚Ä¢ psutil d√©j√† install√© ‚úì
  ‚Ü¶ V√©rification du module paho-mqtt...
    ‚Ä¢ Installation de paho-mqtt...
[INFO] Progression: 60% - Configuration des widgets...

========================================================================
CONFIGURATION DES WIDGETS
========================================================================
‚ó¶ Registre des widgets cr√©√© dans : /var/lib/maxlink/widgets
  ‚Ü¶ Les widgets s'enregistreront automatiquement lors de leur installation
[INFO] Progression: 80% - Installation des scripts syst√®me...

========================================================================
INSTALLATION DES SCRIPTS SYST√àME
========================================================================
‚ó¶ Installation des scripts de v√©rification...
  ‚ö† Script healthcheck non trouv√©
  ‚ö† Script orchestrateur non trouv√©
[INFO] Progression: 90% - Configuration des services systemd...

========================================================================
CONFIGURATION DES SERVICES SYSTEMD
========================================================================
‚ó¶ Installation des services de notification...
‚ó¶ Installation des targets systemd...
‚ó¶ Rechargement de systemd...
‚ó¶ Activation des services...
  ‚Ü¶ Services systemd configur√©s ‚úì
[INFO] Progression: 100% - Installation termin√©e

========================================================================
‚úì INSTALLATION DE L'ORCHESTRATEUR TERMIN√âE
========================================================================

Installation initiale de l'orchestrateur MaxLink termin√©e avec succ√®s !

Composants install√©s :
  ‚Ä¢ Scripts de v√©rification (healthcheck)
  ‚Ä¢ Services systemd de notification
  ‚Ä¢ Targets systemd pour l'orchestration
  ‚Ä¢ Script de gestion : /usr/local/bin/maxlink-orchestrator

Les services seront orchestr√©s automatiquement au prochain d√©marrage.

Commandes disponibles :
  ‚Ä¢ sudo maxlink-orchestrator status    - √âtat du syst√®me
  ‚Ä¢ sudo maxlink-orchestrator check     - V√©rification sant√©
  ‚Ä¢ sudo maxlink-orchestrator logs all  - Voir tous les logs

[SUCCESS] Installation orchestrateur termin√©e

Mode installation compl√®te : red√©marrage g√©r√© par le script parent.

[SUCCESS] orchestrator_install.sh install√© avec succ√®s

========================================================================
INSTALLATION TERMIN√âE
========================================================================

Dur√©e totale : 7m 34s


========================================================================
STATUT DE L'INSTALLATION
========================================================================
  ‚úì update: active
  ‚úì ap: active
  ‚úì nginx: active
  ‚úì mqtt: active
  ‚úì mqtt_wgs: active
  ‚úì orchestrator: active
========================================================================

‚úì Tous les composants ont √©t√© install√©s avec succ√®s !

MaxLink est maintenant op√©rationnel.

Acc√®s au Dashboard :
  ‚Ä¢ http://192.168.4.1
  ‚Ä¢ http://maxlink.local (avec l'AP actif)

[SUCCESS] Installation compl√®te r√©ussie - Tous les composants install√©s
[INFO] Mode installation compl√®te - Red√©marrage g√©r√© par l'interface
/media/prod/WERIT/scripts/install/update_install.sh: line 455: local: can only be used in a function
/media/prod/WERIT/scripts/install/update_install.sh: line 456: [: -lt: unary operator expected
/media/prod/WERIT/scripts/install/ap_install.sh: line 457: dig: command not found
[INFO] D√©couverte des widgets disponibles
[INFO] Widget trouv√©: mqttstats
[INFO] Widget trouv√©: servermonitoring
[INFO] Widget trouv√©: uptime
[INFO] Widget trouv√©: wifistats
error: externally-managed-environment

√ó This environment is externally managed
‚ï∞‚îÄ> To install Python packages system-wide, try apt install
    python3-xyz, where xyz is the package you are trying to
    install.
    
    If you wish to install a non-Debian-packaged Python package,
    create a virtual environment using python3 -m venv path/to/venv.
    Then use path/to/venv/bin/python and path/to/venv/bin/pip. Make
    sure you have python3-full installed.
    
    For more information visit http://rptl.io/venv

note: If you believe this is a mistake, please contact your Python installation or OS distribution provider. You can override this, at the risk of breaking your Python installation or OS, by passing --break-system-packages.
hint: See PEP 668 for the detailed specification.

======================================================================
TERMIN√â: Installation compl√®te
Code de sortie: 0
======================================================================