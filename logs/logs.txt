Console pr√™te - Mode Privil√©gi√©: ACTIF


======================================================================
D√âMARRAGE: Installation compl√®te de MaxLink
Script: /media/prod/USBTOOL/scripts/install/full_install_install.sh
======================================================================

[INFO] Script full_install_install initialis√©
[H[2J[3J
========================================================================
 MAXLINK‚Ñ¢ - INSTALLATION COMPL√àTE V3
 ¬© 2025 WERIT. Tous droits r√©serv√©s.
========================================================================

Installation automatique de tous les composants MaxLink :

  ‚Ä¢ Mise √† jour syst√®me et cache
  ‚Ä¢ Point d'acc√®s WiFi
  ‚Ä¢ Serveur Web et Dashboard
  ‚Ä¢ Broker MQTT
  ‚Ä¢ Widgets MQTT
  ‚Ä¢ Orchestrateur et finalisation

L'installation compl√®te prendra environ 10-15 minutes.

D√©marrage de l'installation...

[INFO] ========== D√âBUT DE L'INSTALLATION COMPL√àTE MAXLINK ==========

========================================================================
√âTAPE 1/6 : Mise √† jour syst√®me et cache
========================================================================

‚ó¶ Ex√©cution de update_install.sh...

[INFO] Ex√©cution de update_install.sh
[INFO] Script update_install initialis√©
[INFO] ========== D√âBUT DE LA MISE √Ä JOUR SYST√àME V11 ==========
========================================================================
√âTAPE 1 : PR√âPARATION DU SYST√àME
========================================================================

‚ó¶ Stabilisation du syst√®me apr√®s d√©marrage...
  ‚Ü¶ Initialisation des services r√©seau...
[INFO] Stabilisation du syst√®me - attente 10s pour OS frais

‚ó¶ D√©sactivation temporaire des mises √† jour automatiques...
[INFO] D√©sactivation des mises √† jour automatiques
  ‚Ü¶ Mises √† jour automatiques suspendues ‚úì
[INFO] Sauvegarde de l'√©tat r√©seau actuel

‚ó¶ V√©rification de l'interface WiFi...
  ‚Ü¶ Interface WiFi d√©tect√©e ‚úì
[INFO] Interface WiFi wlan0 d√©tect√©e
[CMD] Ex√©cution: Activation WiFi
[CMD] Commande: nmcli radio wifi on >/dev/null 2>&1
[CMD] Code de sortie: 0
  ‚Ü¶ WiFi activ√© ‚úì

========================================================================
√âTAPE 2 : CONNEXION R√âSEAU
========================================================================

[INFO] √âtablissement de la connexion r√©seau
‚ó¶ Test de la connexion internet existante...
  ‚Ü¶ Pas de connexion active, tentative de connexion au WiFi...

‚ó¶ Scan des r√©seaux WiFi disponibles...
[INFO] Scan des r√©seaux WiFi
  ‚Ü¶ R√©seau 'Max' d√©tect√© ‚úì
[INFO] R√©seau Max trouv√©

‚ó¶ Connexion au r√©seau WiFi 'Max'...
[INFO] Tentative de connexion √† Max
[2K
Device 'wlan0' successfully activated with '67173b4f-2841-490d-87e9-6bd4eecb9630'.
  ‚Ü¶ Connexion √©tablie, v√©rification...
  ‚Ü¶ Connexion internet confirm√©e ‚úì
[SUCCESS] Connexion √©tablie avec succ√®s

========================================================================
√âTAPE 3 : MISE √Ä JOUR DU SYST√àME
========================================================================

[INFO] Mise √† jour des listes de paquets
‚ó¶ Pr√©paration du syst√®me de paquets...
[INFO] Nettoyage s√©curis√© d'APT
  ‚Ü¶ Syst√®me de paquets pr√™t ‚úì
‚ó¶ Mise √† jour des listes de paquets (tentative 1/3)...
  ‚Ü¶ Liste des paquets mise √† jour ‚úì
[SUCCESS] APT update r√©ussi

‚ó¶ Installation des paquets essentiels...
[INFO] Installation des paquets syst√®me de base
  ‚Ü¶ python3-pip d√©j√† install√© ‚úì
  ‚Ü¶ git d√©j√† install√© ‚úì
  ‚Ü¶ curl d√©j√† install√© ‚úì
  ‚Ü¶ wget d√©j√† install√© ‚úì

‚ó¶ Installation de Pillow pour l'affichage de version...
  ‚Ü¶ Pillow non install√© (overlay indisponible) ‚ö†
[WARN] Installation Pillow √©chou√©e

========================================================================
√âTAPE 4 : CR√âATION DU CACHE DE PAQUETS
========================================================================

‚ó¶ Cr√©ation de la structure du cache...
  ‚Ü¶ Structure cr√©√©e ‚úì
[INFO] Structure de cache cr√©√©e

‚ó¶ T√©l√©chargement des paquets pour le cache...
[INFO] T√©l√©chargement des paquets dans le cache
[INFO] T√©l√©chargement de tous les paquets requis
[INFO] Mise √† jour des listes de paquets APT
[ERROR] Impossible d'acc√©der au r√©pertoire de cache: /var/cache/maxlink/packages
  ‚Ü¶ Certains paquets n'ont pas pu √™tre t√©l√©charg√©s ‚ö†
[WARN] Cache de paquets partiellement cr√©√©

‚ó¶ Cr√©ation de l'index du cache...
  ‚Ü¶ Index cr√©√© ‚úì
[INFO] Index Packages.gz cr√©√©
  ‚Ü¶ M√©tadonn√©es cr√©√©es ‚úì
[INFO] M√©tadonn√©es du cache cr√©√©es

========================================================================
√âTAPE 5 : T√âL√âCHARGEMENT DU DASHBOARD V3
========================================================================

‚ó¶ T√©l√©chargement du dashboard depuis GitHub...
  ‚Ü¶ Branche: V3
[INFO] T√©l√©chargement dashboard depuis GitHub - branche: V3
  ‚Ü¶ Dashboard t√©l√©charg√© ‚úì
[SUCCESS] Dashboard t√©l√©charg√© avec curl
  ‚Ü¶ Archive dashboard corrompue ‚úó
[ERROR] Archive dashboard corrompue

‚ó¶ Nettoyage du syst√®me...
[CMD] Ex√©cution: APT autoremove
[CMD] Commande: apt-get autoremove -y >/dev/null 2>&1
[CMD] Code de sortie: 0
[CMD] Ex√©cution: APT autoclean
[CMD] Commande: apt-get autoclean >/dev/null 2>&1
[CMD] Code de sortie: 0
  ‚Ü¶ Syst√®me nettoy√© ‚úì

========================================================================
√âTAPE 6 : CONFIGURATION DU SYST√àME
========================================================================

‚ó¶ Configuration du ventilateur...
[INFO] Configuration du ventilateur
  ‚Ü¶ Configuration ajout√©e ‚úì
[SUCCESS] Configuration ventilateur ajout√©e

‚ó¶ D√©sactivation du splash screen...
[INFO] D√©sactivation du splash screen
  ‚Ü¶ Mode quiet ajout√© ‚úì
[SUCCESS] cmdline.txt modifi√©
  ‚Ü¶ Rainbow splash d√©sactiv√© ‚úì
[SUCCESS] Rainbow splash d√©sactiv√© dans config.txt
  ‚Ü¶ Services Plymouth d√©sactiv√©s ‚úì
[SUCCESS] Services Plymouth masqu√©s
  ‚Ü¶ Splash screen d√©sactiv√© ‚úì
[INFO] Configuration splash screen termin√©e

‚ó¶ D√©sactivation du Bluetooth...
[INFO] D√©sactivation du Bluetooth
  ‚Ü¶ Bluetooth d√©sactiv√© via rfkill ‚úì
[SUCCESS] Bluetooth d√©sactiv√© avec rfkill
  ‚Ü¶ Service Bluetooth d√©sactiv√© ‚úì
[SUCCESS] Service Bluetooth d√©sactiv√©
  ‚Ü¶ Service hciuart d√©sactiv√© ‚úì
[SUCCESS] Service hciuart d√©sactiv√©
  ‚Ü¶ Bluetooth d√©sactiv√© (r√©versible) ‚úì
    ‚Ä¢ Pour r√©activer: sudo rfkill unblock bluetooth
    ‚Ä¢ Et: sudo systemctl enable --now bluetooth
[INFO] Bluetooth d√©sactiv√© de mani√®re r√©versible

‚ó¶ Personnalisation de l'interface...
[INFO] Installation du fond d'√©cran personnalis√©
  ‚Ü¶ Fond d'√©cran source non trouv√© ‚ö†
[WARN] Fond d'√©cran source non trouv√©: /media/prod/USBTOOL/assets/images/wallpaper.jpg
  ‚Ü¶ Bureau configur√© ‚úì
[SUCCESS] Configuration bureau LXDE appliqu√©e

========================================================================
√âTAPE 7 : FINALISATION
========================================================================

‚ó¶ R√©activation des mises √† jour automatiques...
  ‚Ü¶ Services de mise √† jour r√©activ√©s ‚úì
[INFO] Services de mise √† jour r√©activ√©s

‚ó¶ Restauration de l'√©tat r√©seau...
[INFO] Restauration de l'√©tat r√©seau pr√©c√©dent
[INFO] D√©connexion de la connexion MaxLink temporaire
Connection 'MaxLink' successfully deactivated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/2)
Connection 'MaxLink' (67173b4f-2841-490d-87e9-6bd4eecb9630) successfully deleted.
[INFO] Tentative de r√©activation de: lo
Connection successfully activated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/3)
  ‚Ü¶ √âtat r√©seau restaur√© ‚úì

‚ó¶ Mise √† jour du statut du service...
  ‚Ü¶ Statut du service mis √† jour ‚úì
[INFO] Statut du service update_install mis √† jour: active

‚ó¶ Mise √† jour termin√©e avec succ√®s !
  ‚Ü¶ Version: v3
  ‚Ü¶ Syst√®me √† jour et configur√©
  ‚Ü¶ Cache de paquets cr√©√© pour installation offline
  ‚Ü¶ Dashboard V3 t√©l√©charg√©
  ‚Ü¶ Splash screen d√©sactiv√©
  ‚Ü¶ Bluetooth d√©sactiv√© (r√©versible)
[SUCCESS] Mise √† jour syst√®me termin√©e - Version: v3

‚ó¶ R√©sum√© du cache cr√©√© :
  ‚Ä¢ Taille totale : N/A
  ‚Ä¢ Nombre de paquets : 0
  ‚Ä¢ Dashboard : Non disponible ‚úó

  ‚Ü¶ Red√©marrage diff√©r√© (installation compl√®te en cours)

[INFO] Red√©marrage diff√©r√© - SKIP_REBOOT=true
[INFO] Script update_install termin√© avec le code 0

[SUCCESS] update_install.sh install√© avec succ√®s

  ‚Ü¶ Pause avant l'√©tape suivante... 10 9 8 7 6 5 4 3 2 1 ‚úì

========================================================================
√âTAPE 2/6 : Point d'acc√®s WiFi
========================================================================

‚ó¶ Ex√©cution de ap_install.sh...

[INFO] Ex√©cution de ap_install.sh
[INFO] Script ap_install initialis√©
[INFO] ========== D√âBUT DE L'INSTALLATION AP ==========
========================================================================
√âTAPE 1 : V√âRIFICATIONS
========================================================================

[INFO] Privil√®ges root confirm√©s
‚ó¶ V√©rification de l'interface WiFi...
  ‚Ü¶ Interface wlan0 disponible ‚úì
[INFO] Interface wlan0 disponible

‚ó¶ V√©rification de NetworkManager...
  ‚Ü¶ NetworkManager actif ‚úì
[INFO] NetworkManager actif

========================================================================
√âTAPE 2 : INSTALLATION DES PAQUETS
========================================================================

‚ó¶ Installation de Point d'acc√®s...
[INFO] Installation hybride de Point d'acc√®s
  ‚Ü¶ D√©j√† install√© ‚úì
[INFO] Point d'acc√®s d√©j√† install√©

[SUCCESS] Tous les paquets AP install√©s

========================================================================
√âTAPE 3 : PR√âPARATION DU SYST√àME
========================================================================

‚ó¶ Configuration du resolv.conf...
[INFO] Configuration du resolv.conf
[CMD] Ex√©cution: Protection du resolv.conf
[CMD] Commande: chattr +i /etc/resolv.conf 2>/dev/null || true
[CMD] Code de sortie: 0
  ‚Ü¶ resolv.conf configur√© et prot√©g√© ‚úì
[INFO] resolv.conf configur√© avec succ√®s

‚ó¶ Nettoyage des services DNS conflictuels...
[INFO] D√©sactivation des services DNS conflictuels

‚ó¶ D√©sactivation des connexions WiFi existantes...
[INFO] Nettoyage des connexions WiFi existantes
[CMD] Ex√©cution: D√©connexion interface
[CMD] Commande: nmcli device disconnect wlan0 2>/dev/null || true
[CMD] Code de sortie: 0
[CMD] Ex√©cution: Suppression ancienne config AP
[CMD] Commande: nmcli connection delete 'MaxLink-NETWORK' 2>/dev/null || true
[CMD] Code de sortie: 0
  ‚Ü¶ Connexions nettoy√©es ‚úì

‚ó¶ Configuration de NetworkManager...
[INFO] Configuration de NetworkManager pour dnsmasq
[CMD] Ex√©cution: Sauvegarde config NetworkManager
[CMD] Commande: cp /etc/NetworkManager/NetworkManager.conf /etc/NetworkManager/NetworkManager.conf.original
[CMD] Code de sortie: 0
  ‚Ü¶ NetworkManager configur√© pour dnsmasq ‚úì
[INFO] NetworkManager configur√© avec succ√®s

========================================================================
√âTAPE 4 : CONFIGURATION DU POINT D'ACC√àS
========================================================================

‚ó¶ Cr√©ation du profil Access Point...
  ‚Ü¶ SSID: MaxLink-NETWORK
  ‚Ü¶ IP: 192.168.4.1/24
  ‚Ü¶ Canal: 6 (2.4GHz)
[INFO] Configuration AP - SSID: MaxLink-NETWORK, IP: 192.168.4.1/24, Canal: 6
[CMD] Ex√©cution: Cr√©ation profil AP
[CMD] Commande: nmcli connection add     type wifi     ifname wlan0     con-name 'MaxLink-NETWORK'     autoconnect yes     ssid 'MaxLink-NETWORK'     mode ap     802-11-wireless.band bg     802-11-wireless.channel 6     802-11-wireless-security.key-mgmt wpa-psk 	802-11-wireless-security.proto rsn 	802-11-wireless-security.pairwise ccmp 	802-11-wireless-security.group ccmp     802-11-wireless-security.psk 'MDPsupersecret007'     ipv4.method shared     ipv4.addresses '192.168.4.1/24'     ipv6.method disabled
[OUT] Connection 'MaxLink-NETWORK' (0eb738a2-b9bb-4100-8719-b8776ce8735b) successfully added.
[CMD] Code de sortie: 0
  ‚Ü¶ Profil AP cr√©√© ‚úì
[SUCCESS] Profil AP cr√©√© avec succ√®s

‚ó¶ Configuration DHCP et DNS...
[INFO] Configuration DHCP/DNS pour l'AP
  ‚Ü¶ Configuration DHCP/DNS cr√©√©e ‚úì
[INFO] Configuration dnsmasq cr√©√©e dans /etc/NetworkManager/dnsmasq-shared.d/
  ‚Ü¶ Configuration DNS suppl√©mentaire ajout√©e ‚úì
[INFO] Configuration DNS suppl√©mentaire cr√©√©e

========================================================================
√âTAPE 5 : CONFIGURATION DU PARE-FEU
========================================================================

‚ó¶ Configuration des r√®gles de pare-feu...
[INFO] Configuration des r√®gles iptables

========================================================================
√âTAPE 6 : ACTIVATION DU POINT D'ACC√àS
========================================================================

‚ó¶ D√©marrage du point d'acc√®s...
[INFO] Activation du point d'acc√®s
[CMD] Ex√©cution: Red√©marrage NetworkManager
[CMD] Commande: systemctl restart NetworkManager
[CMD] Code de sortie: 0
[CMD] Ex√©cution: Activation connexion AP
[CMD] Commande: nmcli connection up 'MaxLink-NETWORK'
[OUT] Connection successfully activated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/3)
[CMD] Code de sortie: 0
  ‚Ü¶ Point d'acc√®s activ√© ‚úì
[SUCCESS] Point d'acc√®s activ√© avec succ√®s

‚ó¶ V√©rification de l'√©tat...
[INFO] V√©rification de l'√©tat du point d'acc√®s
  ‚Ü¶ Point d'acc√®s op√©rationnel ‚úì
[SUCCESS] Point d'acc√®s op√©rationnel
  ‚Ü¶ Service DNS actif ‚úì
[INFO] Service dnsmasq actif

========================================================================
√âTAPE 7 : FINALISATION
========================================================================

‚ó¶ Configuration de d√©marrage automatique...
  ‚Ü¶ Le point d'acc√®s d√©marrera automatiquement ‚úì
[INFO] Configuration de d√©marrage automatique activ√©e

‚ó¶ Mise √† jour du statut du service...
  ‚Ü¶ Statut du service mis √† jour ‚úì
[INFO] Statut du service ap mis √† jour: active

‚ó¶ Informations de connexion :
  ‚Ü¶ Nom du r√©seau : MaxLink-NETWORK
  ‚Ü¶ Mot de passe  : MDPsupersecret007
  ‚Ü¶ Adresse IP    : 192.168.4.1
  ‚Ü¶ Plage DHCP    : 192.168.4.10 - 192.168.4.100

‚ó¶ Acc√®s au dashboard :
  ‚Ü¶ http://192.168.4.1
  ‚Ü¶ http://maxlink.local
  ‚Ü¶ http://dashboard.local
[INFO] Configuration finale:
[INFO]   - SSID: MaxLink-NETWORK
[INFO]   - IP: 192.168.4.1
[INFO]   - DHCP: 192.168.4.10 - 192.168.4.100

‚ó¶ Installation termin√©e avec succ√®s !

‚ó¶ IMPORTANT : L'orchestrateur doit √™tre install√© pour g√©rer le d√©marrage ordonn√©

‚ó¶ Test rapide de la r√©solution DNS...
  ‚Ü¶ DNS non fonctionnel - Un red√©marrage peut √™tre n√©cessaire ‚ö†
[WARN] Test DNS final √©chou√© - red√©marrage recommand√©

  ‚Ü¶ Red√©marrage diff√©r√© (installation compl√®te en cours)

[INFO] Red√©marrage diff√©r√© - SKIP_REBOOT=true
[INFO] Script ap_install termin√© avec le code 0

[SUCCESS] ap_install.sh install√© avec succ√®s

  ‚Ü¶ Pause avant l'√©tape suivante... 10 9 8 7 6 5 4 3 2 1 ‚úì

========================================================================
√âTAPE 3/6 : Serveur Web et Dashboard
========================================================================

‚ó¶ Ex√©cution de nginx_install.sh...

[INFO] Ex√©cution de nginx_install.sh
[INFO] Script nginx_install initialis√©
[INFO] ========== D√âBUT DE L'INSTALLATION NGINX ET DASHBOARD (OFFLINE) ==========
========================================================================
√âTAPE 1 : V√âRIFICATIONS
========================================================================

[INFO] Privil√®ges root confirm√©s
  ‚Ü¶ Privil√®ges root confirm√©s ‚úì

‚ó¶ V√©rification du cache local...
[INFO] V√©rification du cache dashboard
  ‚Ü¶ Archive dashboard non trouv√©e dans le cache ‚úó

ERREUR: Le dashboard doit √™tre t√©l√©charg√© avec update_install.sh
Fichier manquant: /var/cache/maxlink/dashboard/dashboard.tar.gz
[ERROR] Archive dashboard manquante: /var/cache/maxlink/dashboard/dashboard.tar.gz
[INFO] Script nginx_install termin√© avec le code 1

  ‚Ü¶ Serveur Web et Dashboard : √âchec de l'installation ‚úó
  ‚Ü¶ ERREUR : Consultez les logs pour plus de d√©tails
[ERROR] nginx_install.sh a √©chou√©

  ‚Ü¶ Poursuite de l'installation malgr√© l'erreur...

  ‚Ü¶ Pause avant l'√©tape suivante... 10 9 8 7 6 5 4 3 2 1 ‚úì

========================================================================
√âTAPE 4/6 : Broker MQTT
========================================================================

‚ó¶ Ex√©cution de mqtt_install.sh...

[INFO] Ex√©cution de mqtt_install.sh
[INFO] Script mqtt_install initialis√©
[INFO] ========== D√âBUT DE L'INSTALLATION MQTT BROKER ==========

========================================================================
INSTALLATION DU BROKER MQTT (MOSQUITTO)
========================================================================

Configuration : utilisateur 'prod' / mot de passe '1234567890'

[INFO] Privil√®ges root confirm√©s
√âTAPE 1 : PR√âPARATION DU SYST√àME
========================================================================

‚ó¶ Nettoyage du syst√®me de paquets...
  ‚Ü¶ Syst√®me de paquets pr√™t ‚úì
[INFO] Syst√®me de paquets nettoy√©

========================================================================
√âTAPE 2 : INSTALLATION DES PAQUETS
========================================================================

‚ó¶ Installation de Mosquitto et d√©pendances...
[INFO] Installation hybride de Mosquitto et d√©pendances
  ‚Ü¶ Recherche dans le cache local...
  ‚Ü¶ T√©l√©chargement n√©cessaire pour: libmosquitto1 libdlt2 mosquitto mosquitto-clients
[INFO] T√©l√©chargement des paquets:  libmosquitto1 libdlt2 mosquitto mosquitto-clients
‚ó¶ T√©l√©chargement des paquets manquants...
[INFO] V√©rification et √©tablissement de la connexion internet
[INFO] Sauvegarde de l'√©tat r√©seau actuel
[INFO] Mode AP actif d√©tect√©
[INFO] D√©j√† connect√© au WiFi Max
‚ó¶ Connexion automatique au r√©seau pour t√©l√©chargement...
[INFO] Connexion automatique requise pour t√©l√©charger les paquets
  ‚Ü¶ D√©sactivation temporaire du mode AP...
[INFO] D√©sactivation temporaire de l'AP
  ‚Ü¶ Connexion au r√©seau "Max"...
[INFO] Tentative de connexion √† Max
  ‚Ü¶ Connexion √©tablie ‚úì
[SUCCESS] Connexion WiFi √©tablie
  ‚Ü¶ Connectivit√© internet confirm√©e ‚úì
[SUCCESS] Connectivit√© internet confirm√©e
  ‚Ü¶ Mise √† jour des listes de paquets...
  ‚Ü¶ Installation des paquets...
  ‚Ü¶ Paquets install√©s ‚úì
[SUCCESS] Paquets install√©s:  libmosquitto1 libdlt2 mosquitto mosquitto-clients
[INFO] Restauration de l'√©tat r√©seau
[INFO] R√©activation du mode AP
  ‚Ü¶ Mosquitto et d√©pendances install√© avec succ√®s ‚úì
[SUCCESS] Mosquitto et d√©pendances install√© compl√®tement

[SUCCESS] Tous les paquets install√©s avec succ√®s
  ‚Ü¶ Mosquitto install√© ‚úì
[INFO] Mosquitto install√© avec succ√®s

========================================================================
√âTAPE 3 : CONFIGURATION SYST√àME
========================================================================

‚ó¶ V√©rification de l'utilisateur syst√®me...
  ‚Ü¶ Utilisateur syst√®me existant ‚úì

‚ó¶ Cr√©ation des r√©pertoires...
  ‚Ü¶ R√©pertoires cr√©√©s et permissions appliqu√©es ‚úì
[INFO] R√©pertoires Mosquitto cr√©√©s

‚ó¶ Mise √† jour du cache des biblioth√®ques...
  ‚Ü¶ Cache des biblioth√®ques mis √† jour ‚úì
[INFO] ldconfig ex√©cut√©

========================================================================
√âTAPE 4 : CONFIGURATION DE MOSQUITTO
========================================================================

‚ó¶ Cr√©ation de l'utilisateur MQTT...
[CMD] Ex√©cution: Cr√©ation utilisateur MQTT
[CMD] Commande: /usr/bin/mosquitto_passwd -b -c '/etc/mosquitto/passwords' 'prod' '1234567890'
[CMD] Code de sortie: 0
  ‚Ü¶ Utilisateur 'prod' cr√©√© ‚úì
[INFO] Utilisateur MQTT cr√©√©: prod

‚ó¶ Cr√©ation du fichier de configuration avec statistiques...
[INFO] Ancienne configuration sauvegard√©e
  ‚Ü¶ Configuration cr√©√©e avec statistiques activ√©es ‚úì
[SUCCESS] Configuration Mosquitto cr√©√©e avec topics syst√®me

‚ó¶ Configuration des permissions ACL...
  ‚Ü¶ Permissions ACL configur√©es ‚úì
[INFO] Fichier ACL cr√©√©

========================================================================
√âTAPE 5 : D√âMARRAGE DU SERVICE
========================================================================

‚ó¶ Activation du service au d√©marrage...
[CMD] Ex√©cution: Activation au d√©marrage
[CMD] Commande: systemctl enable mosquitto >/dev/null 2>&1
[CMD] Code de sortie: 0
  ‚Ü¶ Service activ√© ‚úì

‚ó¶ D√©marrage de Mosquitto...
[CMD] Ex√©cution: D√©marrage Mosquitto
[CMD] Commande: systemctl start mosquitto
[CMD] Code de sortie: 0
  ‚Ü¶ Mosquitto d√©marr√© ‚úì
[SUCCESS] Mosquitto d√©marr√© avec succ√®s
  ‚Ü¶ Service actif et fonctionnel ‚úì
[INFO] Service Mosquitto actif

========================================================================
√âTAPE 6 : TESTS DE CONNEXION
========================================================================

‚ó¶ Test de connexion MQTT (port 1883)...
  ‚Ü¶ Connexion MQTT r√©ussie ‚úì
[SUCCESS] Test de connexion MQTT r√©ussi

‚ó¶ Test du port WebSocket (9001)...
  ‚Ü¶ Port WebSocket non accessible ‚ö†
[WARN] Port WebSocket non accessible imm√©diatement

‚ó¶ Test des topics syst√®me ()...
mosquitto version 2.0.11
  ‚Ü¶ Topics syst√®me accessibles ‚úì
[SUCCESS] Topics syst√®me  accessibles

‚ó¶ Mise √† jour du statut du service...
  ‚Ü¶ Statut du service mis √† jour ‚úì
[INFO] Statut du service mqtt mis √† jour: active

========================================================================
INSTALLATION TERMIN√âE AVEC SUCC√àS !
========================================================================

‚ó¶ Broker MQTT Mosquitto install√© et configur√©
‚ó¶ Topics syst√®me () activ√©s pour les statistiques

‚ó¶ Informations de connexion :
  ‚Ä¢ Serveur      : localhost (ou IP du Raspberry Pi)
  ‚Ä¢ Port MQTT    : 1883
  ‚Ä¢ Port WebSocket : 9001
  ‚Ä¢ Utilisateur  : prod
  ‚Ä¢ Mot de passe : 1234567890

‚ó¶ Commandes utiles :
  ‚Ä¢ √âtat : systemctl status mosquitto
  ‚Ä¢ Logs : journalctl -u mosquitto -f
  ‚Ä¢ Test : mosquitto_sub -h localhost -u prod -P 1234567890 -t '#' -v

‚ó¶ IMPORTANT : L'orchestrateur doit √™tre install√© pour g√©rer le d√©marrage

[SUCCESS] Installation MQTT Broker termin√©e
[INFO] Configuration: prod/1234567890 sur ports 1883 et 9001

  ‚Ü¶ Red√©marrage diff√©r√© (installation compl√®te en cours)

[INFO] Red√©marrage diff√©r√© - SKIP_REBOOT=true
[INFO] Script mqtt_install termin√© avec le code 0

[SUCCESS] mqtt_install.sh install√© avec succ√®s

  ‚Ü¶ Pause avant l'√©tape suivante... 10 9 8 7 6 5 4 3 2 1 ‚úì

========================================================================
√âTAPE 5/6 : Widgets MQTT
========================================================================

‚ó¶ Ex√©cution de mqtt_wgs_install.sh...

[INFO] Ex√©cution de mqtt_wgs_install.sh
[INFO] Script mqtt_wgs_install initialis√©
[INFO] ========== D√âBUT DE L'INSTALLATION DES WIDGETS MQTT ==========

========================================================================
INSTALLATION DES WIDGETS MQTT (WGS)
========================================================================

‚ó¶ V√©rification du broker MQTT...
  ‚Ü¶ Broker MQTT actif ‚úì

‚ó¶ Recherche des widgets disponibles...
  ‚Ü¶ 4 widget(s) trouv√©(s) ‚úì

Widgets disponibles :
  ‚Ä¢ mqttstats
  ‚Ä¢ servermonitoring
  ‚Ä¢ uptime
  ‚Ä¢ wifistats

[INFO] Installation des d√©pendances Python
‚ó¶ V√©rification des paquets Python...
  ‚Ü¶ Installation des paquets manquants...
[INFO] Installation des paquets de la cat√©gorie: python
  ‚Ü¶ Installation de python3-psutil...
[INFO] Installation du paquet depuis le cache: python3-psutil
[ERROR] Paquet non trouv√© dans le cache: python3-psutil
    ‚úó √âchec pour python3-psutil
[ERROR] √âchec d'installation: python3-psutil
  ‚Ü¶ Installation de python3-paho-mqtt...
[INFO] Installation du paquet depuis le cache: python3-paho-mqtt
[ERROR] Paquet non trouv√© dans le cache: python3-paho-mqtt
    ‚úó √âchec pour python3-paho-mqtt
[ERROR] √âchec d'installation: python3-paho-mqtt
  ‚Ü¶ Installation de python3-pip...
[INFO] Installation du paquet depuis le cache: python3-pip
[ERROR] Paquet non trouv√© dans le cache: python3-pip
    ‚úó √âchec pour python3-pip
[ERROR] √âchec d'installation: python3-pip
  ‚Ü¶ Installation de python3-setuptools...
[INFO] Installation du paquet depuis le cache: python3-setuptools
[ERROR] Paquet non trouv√© dans le cache: python3-setuptools
    ‚úó √âchec pour python3-setuptools
[ERROR] √âchec d'installation: python3-setuptools
  ‚Ü¶ Impossible d'installer les d√©pendances ‚úó
  ‚Ü¶ Probl√®me avec les d√©pendances Python ‚ö†
[WARN] Certaines d√©pendances Python manquantes

========================================================================
INSTALLATION DES WIDGETS
========================================================================

Installation du widget: mqttstats
------------------------------------
[SUCCESS] Widget mqttstats valid√©
  ‚Ü¶ Copie du core des widgets...
[INFO] V√©rification des d√©pendances Python pour mqttstats
[INFO] D√©pendances Python v√©rifi√©es (install√©es via le cache)
[INFO] Cr√©ation du service maxlink-widget-mqttstats
[INFO] Copie des fichiers du widget vers /opt/maxlink
[INFO] Service cr√©√© : maxlink-widget-mqttstats.service
[SUCCESS] Service activ√©: maxlink-widget-mqttstats
[SUCCESS] Service d√©marr√©: maxlink-widget-mqttstats
[SUCCESS] Widget mqttstats enregistr√©
  ‚Ü¶ Widget mqttstats install√© ‚úì
  ‚Ü¶ Note : L'orchestrateur g√®re le d√©marrage ordonn√©

Installation du widget: servermonitoring
------------------------------------
[SUCCESS] Widget servermonitoring valid√©
[INFO] V√©rification des d√©pendances Python pour servermonitoring
[INFO] D√©pendances Python v√©rifi√©es (install√©es via le cache)
[INFO] Cr√©ation du service maxlink-widget-servermonitoring
[INFO] Copie des fichiers du widget vers /opt/maxlink
[INFO] Service cr√©√© : maxlink-widget-servermonitoring.service
[SUCCESS] Service activ√©: maxlink-widget-servermonitoring
[SUCCESS] Service d√©marr√©: maxlink-widget-servermonitoring
[SUCCESS] Widget servermonitoring enregistr√©
  ‚Ü¶ Widget servermonitoring install√© ‚úì
  ‚Ü¶ Note : L'orchestrateur g√®re le d√©marrage ordonn√©

Installation du widget: uptime
------------------------------------
[SUCCESS] Widget uptime valid√©
[INFO] V√©rification des d√©pendances Python pour uptime
[INFO] Aucune d√©pendance Python pour uptime
  ‚Ü¶ Widget passif (pas de collector)
[SUCCESS] Widget uptime enregistr√©
  ‚Ü¶ Widget uptime install√© ‚úì

Installation du widget: wifistats
------------------------------------
[SUCCESS] Widget wifistats valid√©
[INFO] V√©rification des d√©pendances Python pour wifistats
[INFO] D√©pendances Python v√©rifi√©es (install√©es via le cache)
[INFO] Cr√©ation du service maxlink-widget-wifistats
[INFO] Copie des fichiers du widget vers /opt/maxlink
[INFO] Service cr√©√© : maxlink-widget-wifistats.service
[SUCCESS] Service activ√©: maxlink-widget-wifistats
[SUCCESS] Service d√©marr√©: maxlink-widget-wifistats
[SUCCESS] Widget wifistats enregistr√©
  ‚Ü¶ Widget wifistats install√© ‚úì
  ‚Ü¶ Note : L'orchestrateur g√®re le d√©marrage ordonn√©

========================================================================
V√âRIFICATION FINALE
========================================================================

‚ó¶ √âtat des services :
  ‚Ü¶ mqttstats : ‚úó inactif
  ‚Ü¶ servermonitoring : ‚úó inactif
  ‚Ü¶ uptime : ‚úó inactif
  ‚Ü¶ wifistats : ‚úó inactif

‚ó¶ Test de r√©ception MQTT...
  ‚Ü¶ Aucun message re√ßu (normal au d√©marrage) ‚ö†

‚ó¶ Mise √† jour du statut du service...
  ‚Ü¶ Statut du service mis √† jour : active ‚úì
[INFO] Statut du service mqtt_wgs mis √† jour: active

========================================================================
R√âSUM√â
========================================================================

‚ó¶ Widgets trouv√©s    : 4
‚ó¶ Widgets install√©s  : 4
‚ó¶ Widgets √©chou√©s    : 0

‚úì Installation termin√©e avec succ√®s !
[SUCCESS] Tous les widgets install√©s avec succ√®s
Commandes utiles :
  ‚Ä¢ Voir tous les logs    : journalctl -u 'maxlink-widget-*' -f
  ‚Ä¢ Voir tous les topics  : mosquitto_sub -h localhost -u prod -P 1234567890 -t '#' -v
  ‚Ä¢ √âtat des services     : systemctl status 'maxlink-widget-*'

[INFO] Installation termin√©e - Install√©s: 4/4

  ‚Ü¶ Red√©marrage diff√©r√© (installation compl√®te en cours)

[INFO] Red√©marrage diff√©r√© - SKIP_REBOOT=true
[INFO] Script mqtt_wgs_install termin√© avec le code 0

[SUCCESS] mqtt_wgs_install.sh install√© avec succ√®s

  ‚Ü¶ Pause avant l'√©tape suivante... 10 9 8 7 6 5 4 3 2 1 ‚úì

========================================================================
√âTAPE 6/6 : Orchestrateur et finalisation
========================================================================

‚ó¶ Ex√©cution de orchestrator_install.sh...

[INFO] Ex√©cution de orchestrator_install.sh
[INFO] Script orchestrator_install initialis√©

========================================================================
ORCHESTRATEUR MAXLINK - INSTALLATION
========================================================================

‚ó¶ Premi√®re installation d√©tect√©e
[INFO] Premi√®re installation de l'orchestrateur

‚ó¶ Copie des widgets vers le syst√®me local...
[INFO] Copie des widgets depuis /media/prod/USBTOOL/scripts/widgets vers /opt/maxlink
  ‚Ü¶ 5 widgets trouv√©s
[INFO] 5 widgets √† copier
  ‚Ü¶ Widgets copi√©s avec succ√®s ‚úì
[SUCCESS] Widgets copi√©s vers /opt/maxlink

========================================================================
CONFIGURATION DES PERMISSIONS SSH POUR L'UTILISATEUR PROD
========================================================================
‚ó¶ L'utilisateur 'prod' existe d√©j√† ‚úì
[INFO] Utilisateur prod trouv√©

‚ó¶ V√©rification de la disponibilit√© des ACL...
  ‚Ü¶ Commandes ACL disponibles ‚úì
[INFO] ACL disponible sur le syst√®me

‚ó¶ Application des permissions ACL sur /var/www/...
  ‚Ü¶ R√©pertoire /var/www cr√©√© ‚úì
[INFO] R√©pertoire /var/www cr√©√©
  ‚Ü¶ Application des ACL pour lecture, √©criture et ex√©cution...
    ‚Ä¢ Permissions actuelles appliqu√©es ‚úì
[SUCCESS] ACL appliqu√©es sur les fichiers existants
  ‚Ü¶ Configuration des ACL par d√©faut pour les nouveaux fichiers...
    ‚Ä¢ Permissions par d√©faut configur√©es ‚úì
[SUCCESS] ACL par d√©faut configur√©es

‚ó¶ V√©rification des permissions appliqu√©es...
  ‚Ü¶ Permissions sur /var/www/ :
user:prod:rwx
default:user:prod:rwx

‚ó¶ Test des permissions...
  ‚Ü¶ Test d'√©criture r√©ussi ‚úì
[SUCCESS] L'utilisateur prod peut √©crire dans /var/www/

========================================================================
R√âSUM√â DES PERMISSIONS
========================================================================
  ‚Ä¢ Utilisateur : prod
  ‚Ä¢ R√©pertoire : /var/www/ et tous ses sous-dossiers
  ‚Ä¢ Permissions : Lecture, √©criture et ex√©cution compl√®tes (rwx)
  ‚Ä¢ ACL par d√©faut : Configur√©es pour les nouveaux fichiers/dossiers

L'utilisateur 'prod' peut maintenant acc√©der via SSH/SFTP avec des
permissions compl√®tes dans /var/www/ sans affecter le fonctionnement
des services web existants.
========================================================================
[INFO] Configuration des permissions SSH pour prod termin√©e

========================================================================
INSTALLATION DE L'INFRASTRUCTURE D'ORCHESTRATION
========================================================================

‚ó¶ Cr√©ation des scripts de v√©rification...
  ‚Ü¶ Scripts de v√©rification cr√©√©s ‚úì
[SUCCESS] Scripts de healthcheck cr√©√©s

‚ó¶ Cr√©ation des services systemd...
  ‚Ü¶ Services systemd cr√©√©s ‚úì
[SUCCESS] Services systemd cr√©√©s

‚ó¶ Cr√©ation des targets systemd...
  ‚Ü¶ Targets systemd cr√©√©s ‚úì
[SUCCESS] Targets systemd cr√©√©s

‚ó¶ Configuration des d√©pendances des services...
  ‚Ü¶ D√©pendances configur√©es ‚úì
[SUCCESS] Overrides systemd configur√©s

‚ó¶ Cr√©ation du script de gestion...
  ‚Ü¶ Script de gestion cr√©√© ‚úì
[SUCCESS] Script de gestion cr√©√©

========================================================================
CONFIGURATION SYSTEMD
========================================================================
‚ó¶ Rechargement de la configuration systemd...
  ‚Ü¶ Configuration recharg√©e ‚úì
[SUCCESS] Systemd daemon-reload effectu√©

========================================================================
ACTIVATION DE L'ORCHESTRATEUR
========================================================================
Activation de l'orchestrateur...
Orchestrateur activ√©.
[SUCCESS] Services de l'orchestrateur activ√©s

========================================================================
INSTALLATION TERMIN√âE
========================================================================

‚úì L'orchestrateur MaxLink a √©t√© install√© avec succ√®s !

L'infrastructure d'orchestration suivante a √©t√© mise en place :
  ‚Ä¢ Scripts de v√©rification de sant√©
  ‚Ä¢ Services systemd pour la supervision
  ‚Ä¢ Targets systemd pour l'organisation des services
  ‚Ä¢ Script de gestion : maxlink-orchestrator
  ‚Ä¢ Permissions SSH compl√®tes pour l'utilisateur 'prod' dans /var/www/

Les widgets ont √©t√© copi√©s vers : /opt/maxlink/widgets/

[SUCCESS] Installation de l'orchestrateur termin√©e
Commandes disponibles :
  ‚Ä¢ sudo maxlink-orchestrator status    - √âtat du syst√®me
  ‚Ä¢ sudo maxlink-orchestrator check     - V√©rification de sant√©
  ‚Ä¢ sudo maxlink-orchestrator logs all  - Voir tous les logs

‚ö† Un red√©marrage est n√©cessaire mais a √©t√© ignor√© (SKIP_REBOOT actif)
  Pensez √† red√©marrer manuellement plus tard.
========================================================================
[INFO] Script orchestrator_install termin√© avec le code 0

[SUCCESS] orchestrator_install.sh install√© avec succ√®s

========================================================================
INSTALLATION TERMIN√âE
========================================================================

Dur√©e totale : 3m 53s


========================================================================
STATUT DE L'INSTALLATION
========================================================================
  ‚úì update: active
  ‚úì ap: active
  ‚úì mqtt: active
  ‚úì mqtt_wgs: active
  ‚úì orchestrator: active
========================================================================

‚ö† Installation termin√©e avec 1 erreur(s)

Certains composants n'ont pas pu √™tre install√©s correctement.
Consultez les logs pour plus de d√©tails :
  ‚Ä¢ Logs syst√®me : /media/prod/USBTOOL/logs/system
  ‚Ä¢ Logs d'installation : /media/prod/USBTOOL/logs/install

Actions possibles :
  ‚Ä¢ Relancer ce script pour r√©essayer les installations √©chou√©es
  ‚Ä¢ Installer manuellement les composants manquants
  ‚Ä¢ V√©rifier l'√©tat avec : sudo /media/prod/USBTOOL/check.sh

[ERROR] Installation termin√©e avec 1 erreurs
L'orchestrateur est install√©, un red√©marrage est recommand√©.

  ‚Ü¶ Red√©marrage du syst√®me dans 30 secondes...