Console pr√™te - Mode Privil√©gi√©: ACTIF


======================================================================
D√âMARRAGE: Installation compl√®te de MaxLink
Script: /media/prod/USBTOOL/scripts/install/full_install_install.sh
======================================================================

[INFO] Script full_install_install initialis√©
[H[2J[3J
========================================================================
 MAXLINK‚Ñ¢ - INSTALLATION COMPL√àTE V3
 ¬© 2025 WERIT. Tous droits r√©serv√©s.
========================================================================

Installation automatique de tous les composants MaxLink :

  ‚Ä¢ Mise √† jour syst√®me et cache
  ‚Ä¢ Point d'acc√®s WiFi
  ‚Ä¢ Serveur Web et Dashboard
  ‚Ä¢ Broker MQTT
  ‚Ä¢ Widgets MQTT
  ‚Ä¢ Orchestrateur et finalisation

L'installation compl√®te prendra environ 10-15 minutes.

D√©marrage de l'installation...

[INFO] ========== D√âBUT DE L'INSTALLATION COMPL√àTE MAXLINK ==========

========================================================================
√âTAPE 1/6 : Mise √† jour syst√®me et cache
========================================================================

‚ó¶ Ex√©cution de update_install.sh...

[INFO] Ex√©cution de update_install.sh
[INFO] Script update_install initialis√©
[INFO] ========== D√âBUT DE LA MISE √Ä JOUR SYST√àME V11 ==========
========================================================================
√âTAPE 1 : PR√âPARATION DU SYST√àME
========================================================================

‚ó¶ Stabilisation du syst√®me apr√®s d√©marrage...
  ‚Ü¶ Initialisation des services r√©seau...
[INFO] Stabilisation du syst√®me - attente 10s pour OS frais

‚ó¶ D√©sactivation temporaire des mises √† jour automatiques...
[INFO] D√©sactivation des mises √† jour automatiques
  ‚Ü¶ Mises √† jour automatiques suspendues ‚úì
[INFO] Sauvegarde de l'√©tat r√©seau actuel
[INFO] Mode AP non actif

‚ó¶ V√©rification de l'interface WiFi...
  ‚Ü¶ Interface WiFi d√©tect√©e ‚úì
[INFO] Interface WiFi wlan0 d√©tect√©e
[CMD] Ex√©cution: Activation WiFi
[CMD] Commande: nmcli radio wifi on >/dev/null 2>&1
[CMD] Code de sortie: 0
  ‚Ü¶ WiFi activ√© ‚úì

========================================================================
√âTAPE 2 : CONNEXION R√âSEAU
========================================================================

[INFO] V√©rification et √©tablissement de la connexion internet
[INFO] Sauvegarde de l'√©tat r√©seau actuel
[INFO] Mode AP non actif
‚ó¶ Connexion automatique au r√©seau pour t√©l√©chargement...
[INFO] Connexion automatique requise pour t√©l√©charger les paquets
  ‚Ü¶ Connexion au r√©seau "Max"...
[INFO] Tentative de connexion √† Max
  ‚Ü¶ Connexion √©tablie ‚úì
[SUCCESS] Connexion WiFi √©tablie
  ‚Ü¶ Connectivit√© internet confirm√©e ‚úì
[SUCCESS] Connectivit√© internet confirm√©e
  ‚Ü¶ Stabilisation de la connexion (5s)...
[INFO] Stabilisation de la connexion - attente 5s

========================================================================
√âTAPE 3 : SYNCHRONISATION HORLOGE
========================================================================

‚ó¶ Synchronisation de l'horloge syst√®me...
[INFO] Synchronisation NTP
[CMD] Ex√©cution: Activation NTP
[CMD] Commande: timedatectl set-ntp true
[CMD] Code de sortie: 0
  ‚Ü¶ Attente de la synchronisation NTP...
[INFO] Attente synchronisation NTP - 15s
  ‚Ü¶ Date/Heure: 18/06/2025 13:34:46
[INFO] Heure synchronis√©e: Wed 18 Jun 13:34:46 CEST 2025

========================================================================
√âTAPE 4 : MISE √Ä JOUR DE S√âCURIT√â
========================================================================

‚ó¶ Nettoyage s√©curis√© du syst√®me de paquets...
[INFO] D√©but du nettoyage APT s√©curis√©
‚ó¶ V√©rification de l'√©tat d'APT...
[INFO] V√©rification de l'√©tat d'APT
  ‚Ü¶ APT est libre ‚úì
[INFO] APT libre imm√©diatement
  ‚Ü¶ Nettoyage des processus zombies...
[INFO] Nettoyage des processus zombies
  ‚Ü¶ V√©rification des verrous orphelins...
[INFO] V√©rification des verrous orphelins
    ‚Ä¢ Suppression du verrou orphelin: /var/lib/dpkg/lock
[INFO] Suppression verrou orphelin: /var/lib/dpkg/lock
    ‚Ä¢ Suppression du verrou orphelin: /var/lib/dpkg/lock-frontend
[INFO] Suppression verrou orphelin: /var/lib/dpkg/lock-frontend
    ‚Ä¢ Suppression du verrou orphelin: /var/lib/apt/lists/lock
[INFO] Suppression verrou orphelin: /var/lib/apt/lists/lock
    ‚Ä¢ Suppression du verrou orphelin: /var/cache/apt/archives/lock
[INFO] Suppression verrou orphelin: /var/cache/apt/archives/lock
  ‚Ü¶ Reconfiguration de dpkg...
[CMD] Ex√©cution: Configuration dpkg
[CMD] Commande: dpkg --configure -a
[CMD] Code de sortie: 0
  ‚Ü¶ Syst√®me de paquets nettoy√© ‚úì
[SUCCESS] Nettoyage APT termin√©
  ‚Ü¶ Stabilisation apr√®s nettoyage (3s)...
[INFO] Stabilisation apr√®s nettoyage - attente 3s
‚ó¶ Mise √† jour de la liste des paquets...
[INFO] D√©but de la mise √† jour APT
  ‚Ü¶ Tentative 1/3...
[INFO] Tentative APT update 1/3
Hit:1 http://archive.raspberrypi.com/debian bookworm InRelease
Hit:2 http://deb.debian.org/debian bookworm InRelease
Hit:3 http://deb.debian.org/debian-security bookworm-security InRelease
Hit:4 http://deb.debian.org/debian bookworm-updates InRelease
Reading package lists...
  ‚Ü¶ Liste des paquets mise √† jour ‚úì
[SUCCESS] APT update r√©ussi

‚ó¶ Installation des mises √† jour de s√©curit√© critiques...
[INFO] Installation des paquets critiques uniquement
[CMD] Ex√©cution: Mise √† jour s√©curit√©
[CMD] Commande: DEBIAN_FRONTEND=noninteractive apt-get install -y --only-upgrade --allow-unauthenticated openssl libssl* sudo systemd apt dpkg libc6 libpam* ca-certificates tzdata
[OUT] Reading package lists...
[OUT] Building dependency tree...
[OUT] Reading state information...
[OUT] openssl is already the newest version (3.0.16-1~deb12u1+rpt1).
[OUT] libssl3 is already the newest version (3.0.16-1~deb12u1+rpt1).
[OUT] Skipping libssl-dev, it is not installed and only upgrades are requested.
[OUT] Skipping libssl-ocaml, it is not installed and only upgrades are requested.
[OUT] Skipping libssl-ocaml-dev, it is not installed and only upgrades are requested.
[OUT] Skipping libssl-doc, it is not installed and only upgrades are requested.
[OUT] Skipping libssl-utils-clojure, it is not installed and only upgrades are requested.
[OUT] Skipping libssl-ocaml:armhf, it is not installed and only upgrades are requested.
[OUT] Skipping libssl-ocaml-dev:armhf, it is not installed and only upgrades are requested.
[OUT] Skipping libssl1.1, it is not installed and only upgrades are requested.
[OUT] Skipping libssl1.1-dbgsym, it is not installed and only upgrades are requested.
[OUT] Skipping libssl3-dbgsym, it is not installed and only upgrades are requested.
[OUT] sudo is already the newest version (1.9.13p3-1+deb12u1).
[OUT] apt is already the newest version (2.6.1).
[OUT] dpkg is already the newest version (1.22.6~bpo12+rpt3).
[OUT] libc6 is already the newest version (2.36-9+rpt2+deb12u10).
[OUT] libpam0g is already the newest version (1.5.2-6+rpt2+deb12u1).
[OUT] Skipping libpam-apparmor, it is not installed and only upgrades are requested.
[OUT] libpam-runtime is already the newest version (1.5.2-6+rpt2+deb12u1).
[OUT] libpam-modules is already the newest version (1.5.2-6+rpt2+deb12u1).
[OUT] Skipping libpam-barada, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-sss, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-gnome-keyring, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-tmpdir, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-krb5, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-ccreds, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-mount, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-mklocaluser, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-python, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-duo, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-fprintd, it is not installed and only upgrades are requested.
[OUT] Skipping libpam0g-dev, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-elogind, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-ldapd, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-abl, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-fscrypt, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-pkcs11, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-google-authenticator, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-kwallet-common, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-kwallet5, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-mount-bin, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-cap, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-cgroup, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-afs-session, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-heimdal, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-alreadyloggedin, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-chroot, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-encfs, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-freerdp2, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-freerdp2-dev, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-net, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-pwdfile, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-radius-auth, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-script, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-ufpidentity, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-x2go, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-x2go-dev, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-pwquality, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-cgfs, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-malcontent, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-oath, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-ocaml, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-ocaml-dev, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-otpw, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-doc, it is not installed and only upgrades are requested.
[OUT] libpam-modules-bin is already the newest version (1.5.2-6+rpt2+deb12u1).
[OUT] Skipping libpam-geoip, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-krb5-migrate-heimdal, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-krb5-migrate-mit, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-mysql, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-p11, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-python-doc, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-shield, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-ssh-agent-auth, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-u2f, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-wrapper, it is not installed and only upgrades are requested.
[OUT] Skipping libpamtest0, it is not installed and only upgrades are requested.
[OUT] Skipping libpamtest0-dev, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-passwdqc, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-poldi, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-winbind, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-shishi, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-slurm, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-slurm-adopt, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-snapper, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-biometric, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-yubico, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-ocaml:armhf, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-ocaml-dev:armhf, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-zfs, it is not installed and only upgrades are requested.
[OUT] libpam-chksshpwd is already the newest version (1.5.2-6+rpt2+deb12u1).
[OUT] Skipping libpam-chksshpwd-dbgsym, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-cracklib, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-cracklib-dbgsym, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-modules-bin-dbgsym, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-modules-dbgsym, it is not installed and only upgrades are requested.
[OUT] Skipping libpam-zfs-dbgsym, it is not installed and only upgrades are requested.
[OUT] Skipping libpam0g-dbgsym, it is not installed and only upgrades are requested.
[OUT] tzdata is already the newest version (2025b-0+deb12u1).
[OUT] The following additional packages will be installed:
[OUT]   libsystemd-shared libsystemd0 libudev1 systemd-sysv systemd-timesyncd udev
[OUT] Suggested packages:
[OUT]   systemd-container systemd-homed systemd-userdbd systemd-boot
[OUT]   systemd-resolved libtss2-esys-3.0.2-0 libtss2-mu0 libtss2-rc0
[OUT] Recommended packages:
[OUT]   libnss-systemd
[OUT] The following packages will be upgraded:
[OUT]   ca-certificates libpam-systemd libsystemd-shared libsystemd0 libudev1
[OUT]   systemd systemd-sysv systemd-timesyncd udev
[OUT] 9 upgraded, 0 newly installed, 0 to remove and 121 not upgraded.
[OUT] Need to get 6,868 kB of archives.
[OUT] After this operation, 205 kB of additional disk space will be used.
[OUT] Get:1 http://deb.debian.org/debian-security bookworm-security/main arm64 systemd-timesyncd arm64 252.38-1~deb12u1 [61.8 kB]
[OUT] Get:2 http://deb.debian.org/debian-security bookworm-security/main arm64 libpam-systemd arm64 252.38-1~deb12u1 [209 kB]
[OUT] Get:3 http://deb.debian.org/debian-security bookworm-security/main arm64 systemd arm64 252.38-1~deb12u1 [2,839 kB]
[OUT] Get:4 http://deb.debian.org/debian-security bookworm-security/main arm64 libsystemd-shared arm64 252.38-1~deb12u1 [1,507 kB]
[OUT] Get:5 http://deb.debian.org/debian-security bookworm-security/main arm64 systemd-sysv arm64 252.38-1~deb12u1 [42.6 kB]
[OUT] Get:6 http://deb.debian.org/debian-security bookworm-security/main arm64 libsystemd0 arm64 252.38-1~deb12u1 [308 kB]
[OUT] Get:7 http://deb.debian.org/debian-security bookworm-security/main arm64 udev arm64 252.38-1~deb12u1 [1,641 kB]
[OUT] Get:8 http://deb.debian.org/debian-security bookworm-security/main arm64 libudev1 arm64 252.38-1~deb12u1 [103 kB]
[OUT] Get:9 http://deb.debian.org/debian bookworm-updates/main arm64 ca-certificates all 20230311+deb12u1 [155 kB]
[OUT] apt-listchanges: Reading changelogs...
[OUT] Preconfiguring packages ...
[OUT] Fetched 6,868 kB in 2s (3,009 kB/s)
[OUT] (Reading database ... 
(Reading database ... 5%
(Reading database ... 10%
(Reading database ... 15%
(Reading database ... 20%
(Reading database ... 25%
(Reading database ... 30%
(Reading database ... 35%
(Reading database ... 40%
(Reading database ... 45%
(Reading database ... 50%
(Reading database ... 55%
(Reading database ... 60%
(Reading database ... 65%
(Reading database ... 70%
(Reading database ... 75%
(Reading database ... 80%
(Reading database ... 85%
(Reading database ... 90%
(Reading database ... 95%
(Reading database ... 100%
(Reading database ... 129085 files and directories currently installed.)
[OUT] Preparing to unpack .../systemd-timesyncd_252.38-1~deb12u1_arm64.deb ...
[OUT] Unpacking systemd-timesyncd (252.38-1~deb12u1) over (252.36-1~deb12u1) ...
[OUT] Preparing to unpack .../libpam-systemd_252.38-1~deb12u1_arm64.deb ...
[OUT] Unpacking libpam-systemd:arm64 (252.38-1~deb12u1) over (252.36-1~deb12u1) ...
[OUT] Preparing to unpack .../systemd_252.38-1~deb12u1_arm64.deb ...
[OUT] Unpacking systemd (252.38-1~deb12u1) over (252.36-1~deb12u1) ...
[OUT] Preparing to unpack .../libsystemd-shared_252.38-1~deb12u1_arm64.deb ...
[OUT] Unpacking libsystemd-shared:arm64 (252.38-1~deb12u1) over (252.36-1~deb12u1) ...
[OUT] Preparing to unpack .../libsystemd0_252.38-1~deb12u1_arm64.deb ...
[OUT] Unpacking libsystemd0:arm64 (252.38-1~deb12u1) over (252.36-1~deb12u1) ...
[OUT] Setting up libsystemd0:arm64 (252.38-1~deb12u1) ...
[OUT] Setting up libsystemd-shared:arm64 (252.38-1~deb12u1) ...
[OUT] Setting up systemd (252.38-1~deb12u1) ...
[OUT] (Reading database ... 
(Reading database ... 5%
(Reading database ... 10%
(Reading database ... 15%
(Reading database ... 20%
(Reading database ... 25%
(Reading database ... 30%
(Reading database ... 35%
(Reading database ... 40%
(Reading database ... 45%
(Reading database ... 50%
(Reading database ... 55%
(Reading database ... 60%
(Reading database ... 65%
(Reading database ... 70%
(Reading database ... 75%
(Reading database ... 80%
(Reading database ... 85%
(Reading database ... 90%
(Reading database ... 95%
(Reading database ... 100%
(Reading database ... 129086 files and directories currently installed.)
[OUT] Preparing to unpack .../systemd-sysv_252.38-1~deb12u1_arm64.deb ...
[OUT] Unpacking systemd-sysv (252.38-1~deb12u1) over (252.36-1~deb12u1) ...
[OUT] Preparing to unpack .../udev_252.38-1~deb12u1_arm64.deb ...
[OUT] Unpacking udev (252.38-1~deb12u1) over (252.36-1~deb12u1) ...
[OUT] Preparing to unpack .../libudev1_252.38-1~deb12u1_arm64.deb ...
[OUT] Unpacking libudev1:arm64 (252.38-1~deb12u1) over (252.36-1~deb12u1) ...
[OUT] Setting up libudev1:arm64 (252.38-1~deb12u1) ...
[OUT] (Reading database ... 
(Reading database ... 5%
(Reading database ... 10%
(Reading database ... 15%
(Reading database ... 20%
(Reading database ... 25%
(Reading database ... 30%
(Reading database ... 35%
(Reading database ... 40%
(Reading database ... 45%
(Reading database ... 50%
(Reading database ... 55%
(Reading database ... 60%
(Reading database ... 65%
(Reading database ... 70%
(Reading database ... 75%
(Reading database ... 80%
(Reading database ... 85%
(Reading database ... 90%
(Reading database ... 95%
(Reading database ... 100%
(Reading database ... 129086 files and directories currently installed.)
[OUT] Preparing to unpack .../ca-certificates_20230311+deb12u1_all.deb ...
[OUT] Unpacking ca-certificates (20230311+deb12u1) over (20230311) ...
[OUT] Setting up systemd-sysv (252.38-1~deb12u1) ...
[OUT] Setting up ca-certificates (20230311+deb12u1) ...
[OUT] Updating certificates in /etc/ssl/certs...
[OUT] rehash: warning: skipping ca-certificates.crt,it does not contain exactly one certificate or CRL
[OUT] 2 added, 0 removed; done.
[OUT] Setting up systemd-timesyncd (252.38-1~deb12u1) ...
[OUT] Setting up udev (252.38-1~deb12u1) ...
[OUT] Setting up libpam-systemd:arm64 (252.38-1~deb12u1) ...
[OUT] Processing triggers for libc-bin (2.36-9+rpt2+deb12u10) ...
[OUT] Processing triggers for man-db (2.11.2-2) ...
[OUT] Processing triggers for dbus (1.14.10-1~deb12u1) ...
[OUT] Processing triggers for initramfs-tools (0.142+rpt3+deb12u3) ...
[OUT] update-initramfs: Generating /boot/initrd.img-6.12.25+rpt-rpi-v8
[OUT] '/boot/initrd.img-6.12.25+rpt-rpi-v8' -> '/boot/firmware/initramfs8'
[OUT] update-initramfs: Generating /boot/initrd.img-6.12.25+rpt-rpi-2712
[OUT] '/boot/initrd.img-6.12.25+rpt-rpi-2712' -> '/boot/firmware/initramfs_2712'
[OUT] Processing triggers for ca-certificates (20230311+deb12u1) ...
[OUT] Updating certificates in /etc/ssl/certs...
[OUT] 0 added, 0 removed; done.
[OUT] Running hooks in /etc/ca-certificates/update.d...
[OUT] done.
[CMD] Code de sortie: 0
  ‚Ü¶ Mises √† jour de s√©curit√© install√©es ‚úì
[SUCCESS] Mises √† jour de s√©curit√© install√©es
  ‚Ü¶ Stabilisation apr√®s mises √† jour (5s)...
[INFO] Stabilisation apr√®s mises √† jour - attente 5s

========================================================================
√âTAPE 5 : CR√âATION DU CACHE DE PAQUETS
========================================================================

‚ó¶ Initialisation du syst√®me de cache...
[INFO] Initialisation du cache de paquets
[INFO] Initialisation du cache des paquets
[SUCCESS] Cache initialis√©: /var/cache/maxlink/packages
  ‚Ü¶ Cache initialis√© ‚úì
[SUCCESS] Cache initialis√© avec succ√®s
  ‚Ü¶ Pr√©paration du t√©l√©chargement (3s)...
[INFO] Pr√©paration du t√©l√©chargement - attente 3s

‚ó¶ T√©l√©chargement de tous les paquets MaxLink...
  ‚Ü¶ Cette op√©ration peut prendre quelques minutes...
[INFO] T√©l√©chargement de tous les paquets requis
[INFO] Mise √† jour des listes de paquets APT
‚ó¶ T√©l√©chargement [1/24]: git
[INFO] T√©l√©chargement du paquet: git
  ‚Ü¶ git t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: git
‚ó¶ T√©l√©chargement [2/24]: curl
[INFO] T√©l√©chargement du paquet: curl
  ‚Ü¶ curl t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: curl
‚ó¶ T√©l√©chargement [3/24]: wget
[INFO] T√©l√©chargement du paquet: wget
  ‚Ü¶ wget t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: wget
‚ó¶ T√©l√©chargement [4/24]: ca-certificates
[INFO] T√©l√©chargement du paquet: ca-certificates
  ‚Ü¶ ca-certificates t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: ca-certificates
‚ó¶ T√©l√©chargement [5/24]: apt-transport-https
[INFO] T√©l√©chargement du paquet: apt-transport-https
  ‚Ü¶ apt-transport-https t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: apt-transport-https
‚ó¶ T√©l√©chargement [6/24]: gnupg
[INFO] T√©l√©chargement du paquet: gnupg
  ‚Ü¶ gnupg t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: gnupg
‚ó¶ T√©l√©chargement [7/24]: lsb-release
[INFO] T√©l√©chargement du paquet: lsb-release
  ‚Ü¶ lsb-release t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: lsb-release
‚ó¶ T√©l√©chargement [8/24]: nginx
[INFO] T√©l√©chargement du paquet: nginx
  ‚Ü¶ nginx t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: nginx
‚ó¶ T√©l√©chargement [9/24]: nginx-common
[INFO] T√©l√©chargement du paquet: nginx-common
  ‚Ü¶ nginx-common t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: nginx-common
‚ó¶ T√©l√©chargement [10/24]: mosquitto
[INFO] T√©l√©chargement du paquet: mosquitto
  ‚Ü¶ mosquitto t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: mosquitto
‚ó¶ T√©l√©chargement [11/24]: mosquitto-clients
[INFO] T√©l√©chargement du paquet: mosquitto-clients
  ‚Ü¶ mosquitto-clients t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: mosquitto-clients
‚ó¶ T√©l√©chargement [12/24]: libmosquitto1
[INFO] T√©l√©chargement du paquet: libmosquitto1
  ‚Ü¶ libmosquitto1 t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: libmosquitto1
‚ó¶ T√©l√©chargement [13/24]: libdlt2
[INFO] T√©l√©chargement du paquet: libdlt2
  ‚Ü¶ libdlt2 t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: libdlt2
‚ó¶ T√©l√©chargement [14/24]: dnsmasq
[INFO] T√©l√©chargement du paquet: dnsmasq
  ‚Ü¶ dnsmasq t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: dnsmasq
‚ó¶ T√©l√©chargement [15/24]: iptables
[INFO] T√©l√©chargement du paquet: iptables
  ‚Ü¶ iptables t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: iptables
‚ó¶ T√©l√©chargement [16/24]: python3-psutil
[INFO] T√©l√©chargement du paquet: python3-psutil
  ‚Ü¶ python3-psutil t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: python3-psutil
‚ó¶ T√©l√©chargement [17/24]: python3-paho-mqtt
[INFO] T√©l√©chargement du paquet: python3-paho-mqtt
  ‚Ü¶ python3-paho-mqtt t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: python3-paho-mqtt
‚ó¶ T√©l√©chargement [18/24]: python3-pip
[INFO] T√©l√©chargement du paquet: python3-pip
  ‚Ü¶ python3-pip t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: python3-pip
‚ó¶ T√©l√©chargement [19/24]: python3-setuptools
[INFO] T√©l√©chargement du paquet: python3-setuptools
  ‚Ü¶ python3-setuptools t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: python3-setuptools
‚ó¶ T√©l√©chargement [20/24]: htop
[INFO] T√©l√©chargement du paquet: htop
  ‚Ü¶ htop t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: htop
‚ó¶ T√©l√©chargement [21/24]: iotop
[INFO] T√©l√©chargement du paquet: iotop
  ‚Ü¶ iotop t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: iotop
‚ó¶ T√©l√©chargement [22/24]: net-tools
[INFO] T√©l√©chargement du paquet: net-tools
  ‚Ü¶ net-tools t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: net-tools
‚ó¶ T√©l√©chargement [23/24]: dnsutils
[INFO] T√©l√©chargement du paquet: dnsutils
  ‚Ü¶ dnsutils t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: dnsutils
‚ó¶ T√©l√©chargement [24/24]: python3-pil
[INFO] T√©l√©chargement du paquet: python3-pil
  ‚Ü¶ python3-pil t√©l√©charg√© ‚úì
[SUCCESS] Paquet t√©l√©charg√©: python3-pil

‚ó¶ T√©l√©chargement termin√©
  ‚Ü¶ Paquets t√©l√©charg√©s: 656
[INFO] Total paquets t√©l√©charg√©s: 656

  ‚Ü¶ Cache de paquets cr√©√© avec succ√®s ‚úì
[SUCCESS] Tous les paquets ont √©t√© t√©l√©charg√©s
=== Statistiques du cache ===
Emplacement : /var/cache/maxlink/packages
Taille      : 342M
Paquets     : 656
√Çge         : 0 jours
==========================

‚ó¶ T√©l√©chargement du dashboard MaxLink V3...
[INFO] D√©but du t√©l√©chargement du dashboard V3
  ‚Ü¶ Tentative 1/3...
[INFO] Tentative t√©l√©chargement dashboard 1/3
    ‚Ä¢ T√©l√©chargement termin√© (curl)
[INFO] T√©l√©chargement curl termin√©
    ‚Ä¢ Taille du fichier: 133 KB
    ‚Ä¢ V√©rification de l'archive...
  ‚Ü¶ Archive dashboard valide ‚úì
[SUCCESS] Archive dashboard valide
  ‚Ü¶ Dashboard t√©l√©charg√© avec succ√®s ‚úì
[SUCCESS] Dashboard t√©l√©charg√© apr√®s 1 tentative(s)

‚ó¶ Nettoyage du syst√®me...
[CMD] Ex√©cution: APT autoremove
[CMD] Commande: apt-get autoremove -y >/dev/null 2>&1
[CMD] Code de sortie: 0
[CMD] Ex√©cution: APT autoclean
[CMD] Commande: apt-get autoclean >/dev/null 2>&1
[CMD] Code de sortie: 0
  ‚Ü¶ Syst√®me nettoy√© ‚úì

========================================================================
√âTAPE 6 : CONFIGURATION DU SYST√àME
========================================================================

‚ó¶ Configuration du ventilateur...
[INFO] Configuration du ventilateur
  ‚Ü¶ Configuration ajout√©e ‚úì
[SUCCESS] Configuration ventilateur ajout√©e

‚ó¶ Personnalisation de l'interface...
[INFO] Installation du fond d'√©cran personnalis√©
[INFO] Ajout de la version MaxLink v3 sur l'image de fond
Erreur: name 'dest_image' is not defined
[SUCCESS] Version ajout√©e sur l'image
  ‚Ü¶ Fond d'√©cran install√© ‚úì
  ‚Ü¶ Bureau configur√© ‚úì
[SUCCESS] Configuration bureau LXDE appliqu√©e

========================================================================
√âTAPE 7 : FINALISATION
========================================================================

‚ó¶ R√©activation des mises √† jour automatiques...
  ‚Ü¶ Services de mise √† jour r√©activ√©s ‚úì
[INFO] Services de mise √† jour r√©activ√©s

‚ó¶ Restauration de l'√©tat r√©seau...
[INFO] Restauration de l'√©tat r√©seau
[INFO] D√©connexion du WiFi Max
  ‚Ü¶ √âtat r√©seau restaur√© ‚úì

‚ó¶ Mise √† jour du statut du service...
Statut update mis √† jour: active
  ‚Ü¶ Statut du service update mis √† jour: active
  ‚Ü¶ Statut du service mis √† jour ‚úì
[INFO] Statut du service update mis √† jour: active

‚ó¶ Mise √† jour termin√©e avec succ√®s !
  ‚Ü¶ Version: v3
  ‚Ü¶ Syst√®me √† jour et configur√©
  ‚Ü¶ Cache de paquets cr√©√© pour installation offline
  ‚Ü¶ Dashboard V3 t√©l√©charg√©
[SUCCESS] Mise √† jour syst√®me termin√©e - Version: v3

‚ó¶ R√©sum√© du cache cr√©√© :
=== Statistiques du cache ===
Emplacement : /var/cache/maxlink/packages
Taille      : 342M
Paquets     : 656
√Çge         : 0 jours
==========================

  ‚Ü¶ Red√©marrage diff√©r√© (installation compl√®te en cours)

[INFO] Red√©marrage diff√©r√© - SKIP_REBOOT=true
[INFO] Script update_install termin√© avec le code 0

[SUCCESS] update_install.sh install√© avec succ√®s

  ‚Ü¶ Pause avant l'√©tape suivante... 10 9 8 7 6 5 4 3 2 1 ‚úì

========================================================================
√âTAPE 2/6 : Point d'acc√®s WiFi
========================================================================

‚ó¶ Ex√©cution de ap_install.sh...

[INFO] Ex√©cution de ap_install.sh
[INFO] Script ap_install initialis√©
[INFO] ========== D√âBUT DE L'INSTALLATION AP ==========
========================================================================
√âTAPE 1 : V√âRIFICATIONS
========================================================================

[INFO] Privil√®ges root confirm√©s
‚ó¶ V√©rification de l'interface WiFi...
  ‚Ü¶ Interface wlan0 disponible ‚úì
[INFO] Interface wlan0 disponible

‚ó¶ V√©rification de NetworkManager...
  ‚Ü¶ NetworkManager actif ‚úì
[INFO] NetworkManager actif

========================================================================
√âTAPE 2 : INSTALLATION DES PAQUETS
========================================================================

‚ó¶ Installation de Point d'acc√®s...
[INFO] Installation hybride de Point d'acc√®s
  ‚Ü¶ D√©j√† install√© ‚úì
[INFO] Point d'acc√®s d√©j√† install√©

[SUCCESS] Tous les paquets AP install√©s

========================================================================
√âTAPE 3 : PR√âPARATION DU SYST√àME
========================================================================

‚ó¶ Configuration du resolv.conf...
[INFO] Configuration du resolv.conf
[CMD] Ex√©cution: Protection du resolv.conf
[CMD] Commande: chattr +i /etc/resolv.conf 2>/dev/null || true
[CMD] Code de sortie: 0
  ‚Ü¶ resolv.conf configur√© et prot√©g√© ‚úì
[INFO] resolv.conf configur√© avec succ√®s

‚ó¶ Nettoyage des services DNS conflictuels...
[INFO] D√©sactivation des services DNS conflictuels

‚ó¶ D√©sactivation des connexions WiFi existantes...
[INFO] Nettoyage des connexions WiFi existantes
[CMD] Ex√©cution: D√©connexion interface
[CMD] Commande: nmcli device disconnect wlan0 2>/dev/null || true
[CMD] Code de sortie: 0
[CMD] Ex√©cution: Suppression ancienne config AP
[CMD] Commande: nmcli connection delete 'MaxLink-NETWORK' 2>/dev/null || true
[CMD] Code de sortie: 0
  ‚Ü¶ Connexions nettoy√©es ‚úì

‚ó¶ Configuration de NetworkManager...
[INFO] Configuration de NetworkManager pour dnsmasq
[CMD] Ex√©cution: Sauvegarde config NetworkManager
[CMD] Commande: cp /etc/NetworkManager/NetworkManager.conf /etc/NetworkManager/NetworkManager.conf.original
[CMD] Code de sortie: 0
  ‚Ü¶ NetworkManager configur√© pour dnsmasq ‚úì
[INFO] NetworkManager configur√© avec succ√®s

========================================================================
√âTAPE 4 : CONFIGURATION DU POINT D'ACC√àS
========================================================================

‚ó¶ Cr√©ation du profil Access Point...
  ‚Ü¶ SSID: MaxLink-NETWORK
  ‚Ü¶ IP: 192.168.4.1/24
  ‚Ü¶ Canal: 6 (2.4GHz)
[INFO] Configuration AP - SSID: MaxLink-NETWORK, IP: 192.168.4.1/24, Canal: 6
[CMD] Ex√©cution: Cr√©ation profil AP
[CMD] Commande: nmcli connection add     type wifi     ifname wlan0     con-name 'MaxLink-NETWORK'     autoconnect yes     ssid 'MaxLink-NETWORK'     mode ap     802-11-wireless.band bg     802-11-wireless.channel 6     802-11-wireless-security.key-mgmt wpa-psk 	802-11-wireless-security.proto rsn 	802-11-wireless-security.pairwise ccmp 	802-11-wireless-security.group ccmp     802-11-wireless-security.psk 'MDPsupersecret007'     ipv4.method shared     ipv4.addresses '192.168.4.1/24'     ipv6.method disabled
[OUT] Connection 'MaxLink-NETWORK' (aac51f01-e05f-40e1-a5ad-7ad83ee97ba7) successfully added.
[CMD] Code de sortie: 0
  ‚Ü¶ Profil AP cr√©√© ‚úì
[SUCCESS] Profil AP cr√©√© avec succ√®s

‚ó¶ Configuration DHCP et DNS...
[INFO] Configuration DHCP/DNS pour l'AP
  ‚Ü¶ Configuration DHCP/DNS cr√©√©e ‚úì
[INFO] Configuration dnsmasq cr√©√©e dans /etc/NetworkManager/dnsmasq-shared.d/
  ‚Ü¶ Configuration DNS suppl√©mentaire ajout√©e ‚úì
[INFO] Configuration DNS suppl√©mentaire cr√©√©e

========================================================================
√âTAPE 5 : CONFIGURATION DU PARE-FEU
========================================================================

‚ó¶ Configuration des r√®gles de pare-feu...
[INFO] Configuration des r√®gles iptables

========================================================================
√âTAPE 6 : ACTIVATION DU POINT D'ACC√àS
========================================================================

‚ó¶ D√©marrage du point d'acc√®s...
[INFO] Activation du point d'acc√®s
[CMD] Ex√©cution: Red√©marrage NetworkManager
[CMD] Commande: systemctl restart NetworkManager
[CMD] Code de sortie: 0
[CMD] Ex√©cution: Activation connexion AP
[CMD] Commande: nmcli connection up 'MaxLink-NETWORK'
[OUT] Connection successfully activated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/3)
[CMD] Code de sortie: 0
  ‚Ü¶ Point d'acc√®s activ√© ‚úì
[SUCCESS] Point d'acc√®s activ√© avec succ√®s

‚ó¶ V√©rification de l'√©tat...
[INFO] V√©rification de l'√©tat du point d'acc√®s
  ‚Ü¶ Point d'acc√®s op√©rationnel ‚úì
[SUCCESS] Point d'acc√®s op√©rationnel
  ‚Ü¶ Service DNS actif ‚úì
[INFO] Service dnsmasq actif

========================================================================
√âTAPE 7 : FINALISATION
========================================================================

‚ó¶ Configuration de d√©marrage automatique...
  ‚Ü¶ Le point d'acc√®s d√©marrera automatiquement ‚úì
[INFO] Configuration de d√©marrage automatique activ√©e

‚ó¶ Mise √† jour du statut du service...
Statut ap mis √† jour: active
  ‚Ü¶ Statut du service ap mis √† jour: active
  ‚Ü¶ Statut du service mis √† jour ‚úì
[INFO] Statut du service ap mis √† jour: active

‚ó¶ Informations de connexion :
  ‚Ü¶ Nom du r√©seau : MaxLink-NETWORK
  ‚Ü¶ Mot de passe  : MDPsupersecret007
  ‚Ü¶ Adresse IP    : 192.168.4.1
  ‚Ü¶ Plage DHCP    : 192.168.4.10 - 192.168.4.100

‚ó¶ Acc√®s au dashboard :
  ‚Ü¶ http://192.168.4.1
  ‚Ü¶ http://maxlink-dashboard.local
  ‚Ü¶ http://dashboard.local
[INFO] Configuration finale:
[INFO]   - SSID: MaxLink-NETWORK
[INFO]   - IP: 192.168.4.1
[INFO]   - DHCP: 192.168.4.10 - 192.168.4.100

‚ó¶ Installation termin√©e avec succ√®s !

‚ó¶ IMPORTANT : L'orchestrateur doit √™tre install√© pour g√©rer le d√©marrage ordonn√©

‚ó¶ Test rapide de la r√©solution DNS...
  ‚Ü¶ DNS non fonctionnel - Un red√©marrage peut √™tre n√©cessaire ‚ö†
[WARN] Test DNS final √©chou√© - red√©marrage recommand√©

  ‚Ü¶ Red√©marrage diff√©r√© (installation compl√®te en cours)

[INFO] Red√©marrage diff√©r√© - SKIP_REBOOT=true
[INFO] Script ap_install termin√© avec le code 0

[SUCCESS] ap_install.sh install√© avec succ√®s

  ‚Ü¶ Pause avant l'√©tape suivante... 10 9 8 7 6 5 4 3 2 1 ‚úì

========================================================================
√âTAPE 3/6 : Serveur Web et Dashboard
========================================================================

‚ó¶ Ex√©cution de nginx_install.sh...

[INFO] Ex√©cution de nginx_install.sh
[INFO] Script nginx_install initialis√©
[INFO] ========== D√âBUT DE L'INSTALLATION NGINX ET DASHBOARD (OFFLINE) ==========
========================================================================
√âTAPE 1 : V√âRIFICATIONS
========================================================================

[INFO] Privil√®ges root confirm√©s
  ‚Ü¶ Privil√®ges root confirm√©s ‚úì

‚ó¶ V√©rification du cache local...
[INFO] V√©rification du cache dashboard
  ‚Ü¶ Dashboard trouv√© dans le cache ‚úì
[INFO] Dashboard valide trouv√© dans le cache

========================================================================
√âTAPE 2 : INSTALLATION DE NGINX
========================================================================

‚ó¶ Installation de Nginx depuis le cache...
[INFO] Installation de Nginx depuis le cache local
[INFO] Installation des paquets de la cat√©gorie: nginx
  ‚Ü¶ Installation de nginx...
[INFO] Installation du paquet depuis le cache: nginx
[SUCCESS] Paquet install√© depuis le cache: nginx
    ‚úì nginx install√©
  ‚Ü¶ Installation de nginx-common...
[INFO] Installation du paquet depuis le cache: nginx-common
[SUCCESS] Paquet install√© depuis le cache: nginx-common
    ‚úì nginx-common install√©
  ‚Ü¶ Nginx install√© depuis le cache ‚úì
[SUCCESS] Nginx install√© avec succ√®s depuis le cache

‚ó¶ Pr√©paration de Nginx...
[CMD] Ex√©cution: Arr√™t Nginx
[CMD] Commande: systemctl stop nginx >/dev/null 2>&1
[CMD] Code de sortie: 0
  ‚Ü¶ Service Nginx arr√™t√© ‚úì

========================================================================
√âTAPE 3 : INSTALLATION DU DASHBOARD
========================================================================


‚ó¶ Extraction du dashboard depuis le cache...
[INFO] R√©pertoire temporaire: /tmp/maxlink-dashboard-1750246751
  ‚Ü¶ Extraction de l'archive...
[CMD] Ex√©cution: Extraction archive
[CMD] Commande: tar -xzf '/var/cache/maxlink/dashboard/dashboard.tar.gz' -C '/tmp/maxlink-dashboard-1750246751'
[CMD] Code de sortie: 0
  ‚Ü¶ Archive extraite ‚úì
[SUCCESS] Archive extraite avec succ√®s
[INFO] Dossier racine de l'archive: /tmp/maxlink-dashboard-1750246751/DashboardV3-main
[INFO] Recherche du dashboard dans: /tmp/maxlink-dashboard-1750246751/DashboardV3-main
  ‚Ü¶ Dossier dashboard trouv√© ‚úì
[INFO] Dossier dashboard trouv√©: /tmp/maxlink-dashboard-1750246751/DashboardV3-main
  ‚Ü¶ Cr√©ation du r√©pertoire destination...
[INFO] R√©pertoire destination cr√©√©: /var/www/maxlink-dashboard
[CMD] Ex√©cution: Copie dashboard
[CMD] Commande: cp -r '/tmp/maxlink-dashboard-1750246751/DashboardV3-main'/* '/var/www/maxlink-dashboard'/
[CMD] Code de sortie: 0
  ‚Ü¶ Dashboard install√© ‚úì
[SUCCESS] Dashboard install√© avec succ√®s
[INFO] Nettoyage du r√©pertoire temporaire

‚ó¶ Configuration des permissions...
[CMD] Ex√©cution: Application propri√©taire
[CMD] Commande: chown -R www-data:www-data '/var/www/maxlink-dashboard'
[CMD] Code de sortie: 0
[CMD] Ex√©cution: Permissions standard
[CMD] Commande: chmod -R 755 '/var/www/maxlink-dashboard'
[CMD] Code de sortie: 0
  ‚Ü¶ Permissions configur√©es ‚úì
[INFO] Permissions appliqu√©es au dashboard

========================================================================
√âTAPE 4 : CONFIGURATION DE NGINX
========================================================================

‚ó¶ Cr√©ation de la configuration du site...
[INFO] Cr√©ation de la configuration Nginx
  ‚Ü¶ Configuration cr√©√©e ‚úì
[SUCCESS] Configuration Nginx cr√©√©e

‚ó¶ Activation du site...
[CMD] Ex√©cution: Suppression site par d√©faut
[CMD] Commande: rm -f /etc/nginx/sites-enabled/default 2>/dev/null || true
[CMD] Code de sortie: 0
[CMD] Ex√©cution: Suppression ancien lien
[CMD] Commande: rm -f /etc/nginx/sites-enabled/maxlink-dashboard 2>/dev/null || true
[CMD] Code de sortie: 0
[CMD] Ex√©cution: Cr√©ation lien symbolique
[CMD] Commande: ln -s /etc/nginx/sites-available/maxlink-dashboard /etc/nginx/sites-enabled/
[CMD] Code de sortie: 0
  ‚Ü¶ Site activ√© ‚úì
[INFO] Site Nginx activ√©
[CMD] Ex√©cution: Test configuration Nginx
[CMD] Commande: nginx -t >/dev/null 2>&1
[CMD] Code de sortie: 0
  ‚Ü¶ Configuration valid√©e ‚úì
[SUCCESS] Configuration Nginx valide

‚ó¶ D√©marrage de Nginx...
[CMD] Ex√©cution: Activation au d√©marrage
[CMD] Commande: systemctl enable nginx >/dev/null 2>&1
[CMD] Code de sortie: 0
[CMD] Ex√©cution: D√©marrage Nginx
[CMD] Commande: systemctl start nginx >/dev/null 2>&1
[CMD] Code de sortie: 0
  ‚Ü¶ Nginx d√©marr√© et activ√© ‚úì
[SUCCESS] Nginx d√©marr√© avec succ√®s

========================================================================
√âTAPE 5 : CONFIGURATION DNS
========================================================================

[INFO] V√©rification de la configuration AP existante
‚ó¶ Mode AP d√©tect√©, mise √† jour de la configuration DNS...
[INFO] Mode AP d√©tect√©, mise √† jour DNS n√©cessaire
  ‚Ü¶ Configuration DNS d√©j√† pr√©sente ‚úì
[INFO] Configuration DNS d√©j√† pr√©sente

‚ó¶ Mise √† jour du statut du service...
Statut nginx mis √† jour: active
  ‚Ü¶ Statut du service nginx mis √† jour: active
  ‚Ü¶ Statut du service mis √† jour ‚úì
[INFO] Statut du service nginx mis √† jour: active

‚ó¶ Installation termin√©e avec succ√®s !
  ‚Ü¶ Dashboard install√© dans : /var/www/maxlink-dashboard
  ‚Ü¶ Accessible via :
    ‚Ä¢ http://192.168.4.1
    ‚Ä¢ http://maxlink-dashboard.local
    ‚Ä¢ http://maxlink-dashboard.local
    ‚Ä¢ http://dashboard.local
[INFO] Installation termin√©e avec succ√®s
[INFO] Dashboard accessible √†: http://192.168.4.1 et http://maxlink-dashboard.local

  ‚Ü¶ Red√©marrage diff√©r√© (installation compl√®te en cours)

[INFO] Red√©marrage diff√©r√© - SKIP_REBOOT=true
[INFO] Script nginx_install termin√© avec le code 0

[SUCCESS] nginx_install.sh install√© avec succ√®s

  ‚Ü¶ Pause avant l'√©tape suivante... 10 9 8 7 6 5 4 3 2 1 ‚úì

========================================================================
√âTAPE 4/6 : Broker MQTT
========================================================================

‚ó¶ Ex√©cution de mqtt_install.sh...

[INFO] Ex√©cution de mqtt_install.sh
[INFO] Script mqtt_install initialis√©
[INFO] ========== D√âBUT DE L'INSTALLATION MQTT BROKER ==========

========================================================================
INSTALLATION DU BROKER MQTT (MOSQUITTO)
========================================================================

Configuration : utilisateur 'mosquitto' / mot de passe 'mqtt'

[INFO] Privil√®ges root confirm√©s
√âTAPE 1 : PR√âPARATION DU SYST√àME
========================================================================

‚ó¶ Nettoyage du syst√®me de paquets...
  ‚Ü¶ Syst√®me de paquets pr√™t ‚úì
[INFO] Syst√®me de paquets nettoy√©

========================================================================
√âTAPE 2 : INSTALLATION DES PAQUETS
========================================================================

‚ó¶ Installation de Mosquitto et d√©pendances...
[INFO] Installation hybride de Mosquitto et d√©pendances
  ‚Ü¶ Recherche dans le cache local...
[INFO] Tentative d'installation depuis le cache
  ‚Ü¶ Install√© depuis le cache ‚úì
[SUCCESS] Mosquitto et d√©pendances install√© depuis le cache

[SUCCESS] Tous les paquets install√©s avec succ√®s
  ‚Ü¶ Mosquitto install√© ‚úì
[INFO] Mosquitto install√© avec succ√®s

========================================================================
√âTAPE 3 : CONFIGURATION SYST√àME
========================================================================

‚ó¶ V√©rification de l'utilisateur syst√®me...
  ‚Ü¶ Utilisateur syst√®me existant ‚úì

‚ó¶ Cr√©ation des r√©pertoires...
  ‚Ü¶ R√©pertoires cr√©√©s et permissions appliqu√©es ‚úì
[INFO] R√©pertoires Mosquitto cr√©√©s

‚ó¶ Mise √† jour du cache des biblioth√®ques...
  ‚Ü¶ Cache des biblioth√®ques mis √† jour ‚úì
[INFO] ldconfig ex√©cut√©

========================================================================
√âTAPE 4 : CONFIGURATION DE MOSQUITTO
========================================================================

‚ó¶ Cr√©ation de l'utilisateur MQTT...
[CMD] Ex√©cution: Cr√©ation utilisateur MQTT
[CMD] Commande: /usr/bin/mosquitto_passwd -b -c '/etc/mosquitto/passwords' 'mosquitto' 'mqtt'
[CMD] Code de sortie: 0
  ‚Ü¶ Utilisateur 'mosquitto' cr√©√© ‚úì
[INFO] Utilisateur MQTT cr√©√©: mosquitto

‚ó¶ Cr√©ation du fichier de configuration avec statistiques...
[INFO] Ancienne configuration sauvegard√©e
  ‚Ü¶ Configuration cr√©√©e avec statistiques activ√©es ‚úì
[SUCCESS] Configuration Mosquitto cr√©√©e avec topics syst√®me

‚ó¶ Configuration des permissions ACL...
  ‚Ü¶ Permissions ACL configur√©es ‚úì
[INFO] Fichier ACL cr√©√©

========================================================================
√âTAPE 5 : D√âMARRAGE DU SERVICE
========================================================================

‚ó¶ Activation du service au d√©marrage...
[CMD] Ex√©cution: Activation au d√©marrage
[CMD] Commande: systemctl enable mosquitto >/dev/null 2>&1
[CMD] Code de sortie: 0
  ‚Ü¶ Service activ√© ‚úì

‚ó¶ D√©marrage de Mosquitto...
[CMD] Ex√©cution: D√©marrage Mosquitto
[CMD] Commande: systemctl start mosquitto
[CMD] Code de sortie: 0
  ‚Ü¶ Mosquitto d√©marr√© ‚úì
[SUCCESS] Mosquitto d√©marr√© avec succ√®s
  ‚Ü¶ Service actif et fonctionnel ‚úì
[INFO] Service Mosquitto actif

========================================================================
√âTAPE 6 : TESTS DE CONNEXION
========================================================================

‚ó¶ Test de connexion MQTT (port 1883)...
  ‚Ü¶ Connexion MQTT r√©ussie ‚úì
[SUCCESS] Test de connexion MQTT r√©ussi

‚ó¶ Test du port WebSocket (9001)...
  ‚Ü¶ Port WebSocket non accessible ‚ö†
[WARN] Port WebSocket non accessible imm√©diatement

‚ó¶ Test des topics syst√®me ()...
mosquitto version 2.0.11
  ‚Ü¶ Topics syst√®me accessibles ‚úì
[SUCCESS] Topics syst√®me  accessibles

‚ó¶ Mise √† jour du statut du service...
Statut mqtt mis √† jour: active
  ‚Ü¶ Statut du service mqtt mis √† jour: active
  ‚Ü¶ Statut du service mis √† jour ‚úì
[INFO] Statut du service mqtt mis √† jour: active

========================================================================
INSTALLATION TERMIN√âE AVEC SUCC√àS !
========================================================================

‚ó¶ Broker MQTT Mosquitto install√© et configur√©
‚ó¶ Topics syst√®me () activ√©s pour les statistiques

‚ó¶ Informations de connexion :
  ‚Ä¢ Serveur      : localhost (ou IP du Raspberry Pi)
  ‚Ä¢ Port MQTT    : 1883
  ‚Ä¢ Port WebSocket : 9001
  ‚Ä¢ Utilisateur  : mosquitto
  ‚Ä¢ Mot de passe : mqtt

‚ó¶ Commandes utiles :
  ‚Ä¢ √âtat : systemctl status mosquitto
  ‚Ä¢ Logs : journalctl -u mosquitto -f
  ‚Ä¢ Test : mosquitto_sub -h localhost -u mosquitto -P mqtt -t '#' -v

‚ó¶ IMPORTANT : L'orchestrateur doit √™tre install√© pour g√©rer le d√©marrage

[SUCCESS] Installation MQTT Broker termin√©e
[INFO] Configuration: mosquitto/mqtt sur ports 1883 et 9001

  ‚Ü¶ Red√©marrage diff√©r√© (installation compl√®te en cours)

[INFO] Red√©marrage diff√©r√© - SKIP_REBOOT=true
[INFO] Script mqtt_install termin√© avec le code 0

[SUCCESS] mqtt_install.sh install√© avec succ√®s

  ‚Ü¶ Pause avant l'√©tape suivante... 10 9 8 7 6 5 4 3 2 1 ‚úì

========================================================================
√âTAPE 5/6 : Widgets MQTT
========================================================================

‚ó¶ Ex√©cution de mqtt_wgs_install.sh...

[INFO] Ex√©cution de mqtt_wgs_install.sh
[INFO] Script mqtt_wgs_install initialis√©
[INFO] ========== D√âBUT DE L'INSTALLATION DES WIDGETS MQTT ==========

========================================================================
INSTALLATION DES WIDGETS MQTT (WGS)
========================================================================

‚ó¶ V√©rification du broker MQTT...
  ‚Ü¶ Broker MQTT actif ‚úì

‚ó¶ Recherche des widgets disponibles...
  ‚Ü¶ 5 widget(s) trouv√©(s) ‚úì

Widgets disponibles :
  ‚Ä¢ mqttstats
  ‚Ä¢ servermonitoring
  ‚Ä¢ timesync
  ‚Ä¢ uptime
  ‚Ä¢ wifistats

[INFO] Installation des d√©pendances Python
‚ó¶ V√©rification des paquets Python...
  ‚Ü¶ Installation des paquets manquants...
[INFO] Installation des paquets de la cat√©gorie: python
  ‚Ü¶ Installation de python3-psutil...
[INFO] Installation du paquet depuis le cache: python3-psutil
[SUCCESS] Paquet install√© depuis le cache: python3-psutil
    ‚úì python3-psutil install√©
  ‚Ü¶ Installation de python3-paho-mqtt...
[INFO] Installation du paquet depuis le cache: python3-paho-mqtt
[SUCCESS] Paquet install√© depuis le cache: python3-paho-mqtt
    ‚úì python3-paho-mqtt install√©
  ‚Ü¶ Installation de python3-pip...
[INFO] Installation du paquet depuis le cache: python3-pip
[SUCCESS] Paquet install√© depuis le cache: python3-pip
    ‚úì python3-pip install√©
  ‚Ü¶ Installation de python3-setuptools...
[INFO] Installation du paquet depuis le cache: python3-setuptools
[SUCCESS] Paquet install√© depuis le cache: python3-setuptools
    ‚úì python3-setuptools install√©
  ‚Ü¶ D√©pendances Python install√©es ‚úì

========================================================================
INSTALLATION DES WIDGETS
========================================================================

Installation du widget: mqttstats
------------------------------------
[SUCCESS] Widget mqttstats valid√©
  ‚Ü¶ Copie du core des widgets...
[INFO] V√©rification des d√©pendances Python pour mqttstats
[INFO] D√©pendances Python v√©rifi√©es (install√©es via le cache)
[INFO] Cr√©ation du service maxlink-widget-mqttstats
[INFO] Copie des fichiers du widget vers /opt/maxlink
[INFO] Service cr√©√© : maxlink-widget-mqttstats.service
[SUCCESS] Service activ√©: maxlink-widget-mqttstats
[SUCCESS] Service d√©marr√©: maxlink-widget-mqttstats
[SUCCESS] Widget mqttstats enregistr√©
  ‚Ü¶ Widget mqttstats install√© ‚úì
  ‚Ü¶ Note : L'orchestrateur g√®re le d√©marrage ordonn√©

Installation du widget: servermonitoring
------------------------------------
[SUCCESS] Widget servermonitoring valid√©
[INFO] V√©rification des d√©pendances Python pour servermonitoring
[INFO] D√©pendances Python v√©rifi√©es (install√©es via le cache)
[INFO] Cr√©ation du service maxlink-widget-servermonitoring
[INFO] Copie des fichiers du widget vers /opt/maxlink
[INFO] Service cr√©√© : maxlink-widget-servermonitoring.service
[SUCCESS] Service activ√©: maxlink-widget-servermonitoring
[SUCCESS] Service d√©marr√©: maxlink-widget-servermonitoring
[SUCCESS] Widget servermonitoring enregistr√©
  ‚Ü¶ Widget servermonitoring install√© ‚úì
  ‚Ü¶ Note : L'orchestrateur g√®re le d√©marrage ordonn√©

Installation du widget: timesync
------------------------------------
[SUCCESS] Widget timesync valid√©
[INFO] V√©rification des d√©pendances Python pour timesync
[INFO] D√©pendances Python v√©rifi√©es (install√©es via le cache)
[INFO] Cr√©ation du service maxlink-widget-timesync
[INFO] Copie des fichiers du widget vers /opt/maxlink
[INFO] Service cr√©√© : maxlink-widget-timesync.service
[SUCCESS] Service activ√©: maxlink-widget-timesync
[SUCCESS] Service d√©marr√©: maxlink-widget-timesync
[SUCCESS] Widget timesync enregistr√©
  ‚Ü¶ Widget timesync install√© ‚úì
  ‚Ü¶ Note : L'orchestrateur g√®re le d√©marrage ordonn√©

Installation du widget: uptime
------------------------------------
[SUCCESS] Widget uptime valid√©
[INFO] V√©rification des d√©pendances Python pour uptime
[INFO] Aucune d√©pendance Python pour uptime
  ‚Ü¶ Widget passif (pas de collector)
[SUCCESS] Widget uptime enregistr√©
  ‚Ü¶ Widget uptime install√© ‚úì

Installation du widget: wifistats
------------------------------------
[SUCCESS] Widget wifistats valid√©
[INFO] V√©rification des d√©pendances Python pour wifistats
[INFO] D√©pendances Python v√©rifi√©es (install√©es via le cache)
[INFO] Cr√©ation du service maxlink-widget-wifistats
[INFO] Copie des fichiers du widget vers /opt/maxlink
[INFO] Service cr√©√© : maxlink-widget-wifistats.service
[SUCCESS] Service activ√©: maxlink-widget-wifistats
[SUCCESS] Service d√©marr√©: maxlink-widget-wifistats
[SUCCESS] Widget wifistats enregistr√©
  ‚Ü¶ Widget wifistats install√© ‚úì
  ‚Ü¶ Note : L'orchestrateur g√®re le d√©marrage ordonn√©

========================================================================
V√âRIFICATION FINALE
========================================================================

‚ó¶ √âtat des services :
  ‚Ü¶ mqttstats : ‚úì actif
  ‚Ü¶ servermonitoring : ‚úì actif
  ‚Ü¶ timesync : ‚úó inactif
  ‚Ü¶ uptime : ‚úó inactif
  ‚Ü¶ wifistats : ‚úì actif

‚ó¶ Test de r√©ception MQTT...
  ‚Ü¶ Messages MQTT re√ßus ‚úì

‚ó¶ Mise √† jour du statut du service...
Statut mqtt_wgs mis √† jour: active
  ‚Ü¶ Statut du service mqtt_wgs mis √† jour: active
  ‚Ü¶ Statut du service mis √† jour : active ‚úì
[INFO] Statut du service mqtt_wgs mis √† jour: active

========================================================================
R√âSUM√â
========================================================================

‚ó¶ Widgets trouv√©s    : 5
‚ó¶ Widgets install√©s  : 5
‚ó¶ Widgets √©chou√©s    : 0

‚úì Installation termin√©e avec succ√®s !
[SUCCESS] Tous les widgets install√©s avec succ√®s
Commandes utiles :
  ‚Ä¢ Voir tous les logs    : journalctl -u 'maxlink-widget-*' -f
  ‚Ä¢ Voir tous les topics  : mosquitto_sub -h localhost -u mosquitto -P mqtt -t '#' -v
  ‚Ä¢ √âtat des services     : systemctl status 'maxlink-widget-*'

[INFO] Installation termin√©e - Install√©s: 5/5

  ‚Ü¶ Red√©marrage diff√©r√© (installation compl√®te en cours)

[INFO] Red√©marrage diff√©r√© - SKIP_REBOOT=true
[INFO] Script mqtt_wgs_install termin√© avec le code 0

[SUCCESS] mqtt_wgs_install.sh install√© avec succ√®s

  ‚Ü¶ Pause avant l'√©tape suivante... 10 9 8 7 6 5 4 3 2 1 ‚úì

========================================================================
√âTAPE 6/6 : Orchestrateur et finalisation
========================================================================

‚ó¶ Ex√©cution de orchestrator_install.sh...

[INFO] Ex√©cution de orchestrator_install.sh
[INFO] Script orchestrator_install initialis√©

========================================================================
ORCHESTRATEUR MAXLINK - INSTALLATION
========================================================================

‚ó¶ Premi√®re installation d√©tect√©e
[INFO] Premi√®re installation de l'orchestrateur

‚ó¶ Copie des widgets vers le syst√®me local...
[INFO] Copie des widgets depuis /media/prod/USBTOOL/scripts/widgets vers /opt/maxlink
  ‚Ü¶ 6 widgets trouv√©s
[INFO] 6 widgets √† copier
  ‚Ü¶ Widgets copi√©s avec succ√®s ‚úì
[SUCCESS] Widgets copi√©s vers /opt/maxlink

========================================================================
CONFIGURATION DES PERMISSIONS SSH POUR L'UTILISATEUR PROD
========================================================================
‚ó¶ L'utilisateur 'prod' existe d√©j√† ‚úì
[INFO] Utilisateur prod trouv√©

‚ó¶ V√©rification de la disponibilit√© des ACL...
  ‚Ü¶ Commandes ACL disponibles ‚úì
[INFO] ACL disponible sur le syst√®me

‚ó¶ Application des permissions ACL sur /var/www/...
  ‚Ü¶ Application des ACL pour lecture, √©criture et ex√©cution...
    ‚Ä¢ Permissions actuelles appliqu√©es ‚úì
[SUCCESS] ACL appliqu√©es sur les fichiers existants
  ‚Ü¶ Configuration des ACL par d√©faut pour les nouveaux fichiers...
    ‚Ä¢ Permissions par d√©faut configur√©es ‚úì
[SUCCESS] ACL par d√©faut configur√©es

‚ó¶ V√©rification des permissions appliqu√©es...
  ‚Ü¶ Permissions sur /var/www/ :
user:prod:rwx
default:user:prod:rwx

‚ó¶ Test des permissions...
  ‚Ü¶ Test d'√©criture r√©ussi ‚úì
[SUCCESS] L'utilisateur prod peut √©crire dans /var/www/

========================================================================
R√âSUM√â DES PERMISSIONS
========================================================================
  ‚Ä¢ Utilisateur : prod
  ‚Ä¢ R√©pertoire : /var/www/ et tous ses sous-dossiers
  ‚Ä¢ Permissions : Lecture, √©criture et ex√©cution compl√®tes (rwx)
  ‚Ä¢ ACL par d√©faut : Configur√©es pour les nouveaux fichiers/dossiers

L'utilisateur 'prod' peut maintenant acc√©der via SSH/SFTP avec des
permissions compl√®tes dans /var/www/ sans affecter le fonctionnement
des services web existants.
========================================================================
[INFO] Configuration des permissions SSH pour prod termin√©e

========================================================================
INSTALLATION DE L'INFRASTRUCTURE D'ORCHESTRATION
========================================================================

‚ó¶ Cr√©ation des scripts de v√©rification...
  ‚Ü¶ Scripts de v√©rification cr√©√©s ‚úì
[SUCCESS] Scripts de healthcheck cr√©√©s

‚ó¶ Cr√©ation des services systemd...
  ‚Ü¶ Services systemd cr√©√©s ‚úì
[SUCCESS] Services systemd cr√©√©s

‚ó¶ Cr√©ation des targets systemd...
  ‚Ü¶ Targets systemd cr√©√©s ‚úì
[SUCCESS] Targets systemd cr√©√©s

‚ó¶ Configuration des d√©pendances des services...
  ‚Ü¶ D√©pendances configur√©es ‚úì
[SUCCESS] Overrides systemd configur√©s

‚ó¶ Cr√©ation du script de gestion...
  ‚Ü¶ Script de gestion cr√©√© ‚úì
[SUCCESS] Script de gestion cr√©√©

========================================================================
CONFIGURATION SYSTEMD
========================================================================
‚ó¶ Rechargement de la configuration systemd...
  ‚Ü¶ Configuration recharg√©e ‚úì
[SUCCESS] Systemd daemon-reload effectu√©

========================================================================
ACTIVATION DE L'ORCHESTRATEUR
========================================================================
Activation de l'orchestrateur...
Orchestrateur activ√©.
[SUCCESS] Services de l'orchestrateur activ√©s

========================================================================
INSTALLATION TERMIN√âE
========================================================================

‚úì L'orchestrateur MaxLink a √©t√© install√© avec succ√®s !

L'infrastructure d'orchestration suivante a √©t√© mise en place :
  ‚Ä¢ Scripts de v√©rification de sant√©
  ‚Ä¢ Services systemd pour la supervision
  ‚Ä¢ Targets systemd pour l'organisation des services
  ‚Ä¢ Script de gestion : maxlink-orchestrator
  ‚Ä¢ Permissions SSH compl√®tes pour l'utilisateur 'prod' dans /var/www/

Les widgets ont √©t√© copi√©s vers : /opt/maxlink/widgets/

[SUCCESS] Installation de l'orchestrateur termin√©e
Commandes disponibles :
  ‚Ä¢ sudo maxlink-orchestrator status    - √âtat du syst√®me
  ‚Ä¢ sudo maxlink-orchestrator check     - V√©rification de sant√©
  ‚Ä¢ sudo maxlink-orchestrator logs all  - Voir tous les logs

‚ö† Un red√©marrage est n√©cessaire mais a √©t√© ignor√© (SKIP_REBOOT actif)
  Pensez √† red√©marrer manuellement plus tard.
========================================================================
[INFO] Script orchestrator_install termin√© avec le code 0

[SUCCESS] orchestrator_install.sh install√© avec succ√®s

========================================================================
INSTALLATION TERMIN√âE
========================================================================

Dur√©e totale : 6m 52s


========================================================================
STATUT DE L'INSTALLATION
========================================================================
  ‚úì update: active
  ‚úì ap: active
  ‚úì nginx: active
  ‚úì mqtt: active
  ‚úì mqtt_wgs: active
  ‚úì orchestrator: active
========================================================================

‚úì Tous les composants ont √©t√© install√©s avec succ√®s !

MaxLink est maintenant op√©rationnel. Les fonctionnalit√©s suivantes sont disponibles :
  ‚Ä¢ Point d'acc√®s WiFi : MaxLink-NETWORK
  ‚Ä¢ Dashboard Web : http://192.168.4.1 ou http://maxlink-dashboard.local
  ‚Ä¢ Broker MQTT : mosquitto@localhost:1883
  ‚Ä¢ Widgets de monitoring actifs
  ‚Ä¢ Orchestrateur pour la gestion des services

Commandes utiles :
  ‚Ä¢ √âtat du syst√®me : sudo /usr/local/bin/maxlink-orchestrator status
  ‚Ä¢ V√©rification : sudo /usr/local/bin/maxlink-orchestrator check
  ‚Ä¢ Diagnostic : sudo /media/prod/USBTOOL/diag.sh

[SUCCESS] Installation compl√®te r√©ussie - 0 erreur

Un red√©marrage est n√©cessaire pour finaliser l'installation.

  ‚Ü¶ Red√©marrage du syst√®me dans 30 secondes...